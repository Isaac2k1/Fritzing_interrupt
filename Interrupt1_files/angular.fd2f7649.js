function redirectUri(){var a="https",b=window.location.host;return"webide.arduino.cc:8080"===b&&(a="http"),a+"://"+b+"/login.html"}var ideapp=angular.module("ideapp",["ngSanitize","ngCookies","ngAnimate","ui.ace","ngCookies","pascalprecht.translate","mgo-mousetrap","ui.utils","ui.router","angularMoment","lodash","importProcedure","menu","tooltip","alert","toolbar","usrProfile","select","Apiv2","autosave","LocalStorageModule","serial","autoscroll","truncate","ngStorage","svgIcons","svgIllustrations","angular-bind-html-compile","angulartics","angulartics.google.analytics","angulartics.facebook.pixel","ngTagsInput","ngclipboard","arduino.auth","ng-ip-address","arduino.coachmarks"]);ideapp.controller("mainCtrl",["$scope","views","skin","SerialPortManager","$window","modal","$location","config","$state","AuthService","Os",function(a,b,c,d,e,f,g,h,i,j,k){e.ArduinoCreate={version:"2.1.2"};var l=g.search();a.deviceSetup=h.intelInstance,l.embed&&(a.embed=!0),a.views=b,a.skin=c,angular.element(e).bind("beforeunload",function(){d.close()}),a.goToPage=function(a){e.location=i.href(a,{},{absolute:!0})},a.goToGettingStarted=function(){if(k.isChromeOs())e.location.href=g.absUrl().replace(g.path(),"/getting-started/plugin?page=2");else{var a=g.absUrl().replace("https","http").replace(g.path(),"/getting-started/plugin?page=2");j.logout(a)}f.close()}}]),ideapp.controller("TitleCtrl",["$scope","PageTitle",function(a,b){a.Page=b}]);var opts={authURI:"https://auth.arduino.cc/login",logoutURI:"https://auth.arduino.cc/logout",redirectURI:redirectUri(),clientID:"create",scopes:["profile:core","profile:contact","profile:public","create:users","create:sketches","create:libraries","create:compile","iot:devices"]},oauth=new Oauth2(opts);ideapp.service("UserService",["UserServiceFactory",function(a){return new a("core,public,contact",1e5)}]),ideapp.run(["$rootScope","AuthService","UserService",function(a,b,c){c.onProfile(function(c,d){a.bootstrapped&&d&&b.login()})}]),angular.element(function(){angular.bootstrap(document,["ideapp"])}),ideapp.constant("settings",{enableContextMenu:!0,newsFeedUrl:"//blog.arduino.cc/category/featured/feed/?json=1&callback=JSON_CALLBACK",boardsBlackList:["BT","NG","Atmel atmega168pb Xplained mini","Atmel atmega328pb Xplained mini","Atmel atmega328p Xplained mini","Edison","Fio","Galileo","Gemma"],archBlackList:["arduino:sam:arduino_due_x_dbg","arduino:samd:arduino_zero_edbg","arduino:avr:robotMotor","arduino:samd:mzero_pro_bl","arduino:samd:tian_cons"],boardsFqbnWhitelist:void 0}),ideapp.config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]),ideapp.config(["$logProvider",function(a){a.debugEnabled(!0)}]),ideapp.config(["$translateProvider","settings",function(a,b){a.useStaticFilesLoader({prefix:"languages/",suffix:".json"}),a.preferredLanguage("en-US"),a.useSanitizeValueStrategy("sanitizeParameters")}]),ideapp.run(["$window","settings",function(a,b){a.moment.lang("en")}]),ideapp.config(["tetherTooltipProvider",function(a){a.options({template:'<div ng-bind-html="content.main | translateAsHtml"></div>'})}]),ideapp.config(["localStorageServiceProvider",function(a){a.setPrefix("create"),a.setNotify(!1,!1)}]),ideapp.constant("config",{appName:"create",create:{endpoint:"//api.arduino.cc/create"},builder:{endpoint:"//api-builder.arduino.cc/builder/v1"},devices:{endpoint:"//api.arduino.cc/devices"},alive:{endpoint:"//api-builder.arduino.cc/builder/alive"},chromeExtensionIds:["dcgicpihgkmccjigalccipmjlnjopdfe","elmgohdonjdampbcgefphnlchgocpaij"],forceChromeAppDaemon:!1}),ideapp.run(["$rootScope","$state","$location","AuthService","$urlRouter","$urlMatcherFactory","$window","modal",function(a,b,c,d,e,f,g,h){a.navigating=!1,a.$on("$locationChangeSuccess",function(a){var b=f.compile("/editor/:uid/:id"),g=b.exec(c.url());g&&(a.preventDefault(),d.token().then(function(){e.sync()}).catch(function(){c.url(c.url()+"/preview"),e.sync()}))}),e.listen(),a.$on("$stateChangeStart",function(b,c,d){return h.hide(),c.data&&c.data.before&&c.data.before()?b.preventDefault():(a.toState=c,a.toParams=d,void(a.navigating=!0))}),a.$on("$stateChangeSuccess",function(d,e){a.navigating=!1,c.search("code",null),c.search("state",null),e.data&&e.data.redirectTo&&b.go(e.data.redirectTo,e.data.redirectParams),"http"===c.protocol()&&"getting-started-plugin"!==e.name&&c.host().indexOf("webide")===-1&&(g.location.href=c.absUrl().replace("http","https"))}),a.$on("$stateChangeError",function(c,e,f,g,h,i){return console.debug(c,e),i&&i.redirectTo?void b.go(i.redirectTo,i.redirectParams):(i&&(a.bootstrappedNoLogin=!0,console.error(i,i.message)),i&&i.message&&"ANONYMOUS"===i.message?("getting-started-up2"===e.name&&localStorage.setItem("create.gateway-up2",!0),void d.login(b.href(e.name,{},{absolute:!0}))):i&&i.message&&"ERROR_ACCESS_DENIED"===i.message?void b.go("redeem",{},{reload:!0}):i&&"BROWSER_NOT_SUPPORTED"===i.message?void b.go("nobrowser"):i&&"SKIPREDEEM"===i.message?void b.go("home"):i&&"MISSING_SKETCH"===i.message?void b.go("missing-sketch"):(a.error=i,void b.go("error")))})}]),ideapp.config(["$stateProvider",function(a){function b(a,c){var d=_.find(a,c);return d||_.each(a,function(a){if(a.files){var e=b(a.files,c);e&&(d=e)}}),d}a.state("main",{resolve:{isAuthenticated:["$q","AuthService",function(a,b){return b.token().then(function(){return a.resolve(!0)}).catch(function(){return a.resolve(!1)})}]},template:'<div ui-view class="fullHeight"></div>'}).state("home",{parent:"main",url:"/",onEnter:["isAuthenticated","$rootScope",function(a,b){a?this.data.redirectTo="logged.home":b.bootstrappedNoLogin=!0}],data:{}}).state("logged",{parent:"main",data:{},resolve:{user:["$q","isAuthenticated","CreateUserService",function(a,b,c){return b?c.getUserInfo().catch(function(){return a.reject({message:"ERROR_ACCESS_DENIED"})}):a.reject({message:"ANONYMOUS"})}],things:["devices",function(a){return a.connect()}],preferences:["user","editor","preferences","sanity","$rootScope","skin",function(a,b,c,d,e,f){return d.loadReadme(),c.init().then(function(a){b.setContext(d.consolidateConfiguration({},{user:a})),f.set(a.skin),e.bootstrapped=!0})}]},template:'<div ui-view class="fullHeight"></div>',abstract:!0}).state("logged.home",{parent:"main",onEnter:["isAuthenticated","$rootScope",function(a,b){a?b.bootstrapped=!0:b.bootstrappedNoLogin=!0}]}).state("editor",{url:"/editor",parent:"logged",data:{},onEnter:["user","config",function(a,b){return localStorage.getItem("create.gateway-flow")?(localStorage.removeItem("create.gateway-flow"),localStorage.setItem("create.plugin-installed",!0),this.data.redirectTo="getting-started-device"):localStorage.getItem("create.gateway-up2")?(localStorage.removeItem("create.gateway-up2"),localStorage.setItem("create.plugin-installed",!0),this.data.redirectTo="getting-started-up2"):void(b.intelInstance&&a.email.indexOf("arduino.cc")===-1&&a.email.indexOf("intel.com")===-1&&a.email.indexOf("bcmi-labs.cc")===-1&&a.email.indexOf("thugdesign.com")===-1&&a.email.indexOf("aaeon.eu")===-1?this.data.redirectTo="logged.home":(this.data.redirectTo="editor.user",this.data.redirectParams={uid:a.id}))}]}).state("editor.user",{url:"/editor/:uid",parent:"logged",templateUrl:"views/editor/editor.html",controller:"editorCtrl",data:{},resolve:{isSupportedBrowser:["deviceInfo",function(a){var b=a.browser.getBrowser();if("chrome"!==b&&"firefox"!==b&&"safari"!==b&&"edge"!==b)throw new Error("BROWSER_NOT_SUPPORTED")}],daemon:["daemon","boards","boardMetadata","SerialPortManager",function(a,b,c,d){a.connect(),a.onPortsUpdate(b.update.bind(b)),b.onBoardSelected(c.set,d.updatePort)}],sketchbook:["sketches","user",function(a,b){return a.fetch(b.id)}],_sketch:["sketchbook","sketches",function(a,b){return b.findFirst()}]},onEnter:["user","_sketch",function(a,b){this.data.redirectTo="editor.user.sketch",this.data.redirectParams={uid:a.id,id:b.id}}]}).state("editor.user.sketch",{url:"^/editor/:uid/:id",data:{},params:{uid:null,id:null},resolve:{_sketch:["sketchbook","sketches","$stateParams",function(a,b,c){var d=b.findById(c.id);return d&&!d.owner&&(d.owner=c.uid),d}]},onEnter:["_sketch","user","editor","$stateParams",function(a,b,c,d){return b.id!==d.uid?(this.data.redirectTo="editor.public",void(this.data.redirectParams={uid:d.uid,id:d.id})):void(a?(this.data.redirectTo="editor.user.sketch.file",this.data.redirectParams={uid:a.owner,id:a.id,filename:a.ino.name}):(this.data.redirectTo="editor.user",this.data.redirectParams={uid:d.uid}))}]}).state("editor.user.sketch.file",{params:{uid:null,id:null,filename:null},onEnter:["$state","sketches","editor","$stateParams",function(a,b,c,d){var e=b.findById(d.id);if(e){var f;f=d.filename?b.findFile(e.id,d.filename):e.ino,c.setCurrentProject(e),c.setCurrentFile(f,e)}}]}).state("editor.public",{url:"/editor/:uid/:id/preview",parent:"main",templateUrl:"views/publicsketch/publicsketch.html",controller:"publicSketchCtrl",resolve:{authenticated:["isAuthenticated","UserService","$rootScope",function(a,b,c){return a?b.profile().then(function(){c.bootstrapped=!0}):void(c.bootstrappedNoLogin=!0)}],user:["isAuthenticated","CreateUserService",function(a,b){if(a)return b.getUserInfo()}],_sketch:["authenticated","sketches","$stateParams","$q",function(a,b,c,d){return b.get(c.uid,c.id).catch(function(){return d.reject(new Error("MISSING_SKETCH"))})}]},onEnter:["_sketch","editor",function(a,b){b.setCurrentProject(a)}]}).state("example",{parent:"main",resolve:{authenticated:["isAuthenticated","UserService","$rootScope",function(a,b,c){return a?b.profile().then(function(){c.bootstrapped=!0}):void(c.bootstrappedNoLogin=!0)}],user:["isAuthenticated","CreateUserService",function(a,b){if(a)return b.getUserInfo()}]},template:'<div ui-view class="fullHeight"></div>',abstract:!0}).state("example.library",{url:"/example/library/:libraryName/:examplePath/:exampleName/preview",parent:"example",templateUrl:"views/publicsketch/publicsketch.html",controller:"publicSketchCtrl",resolve:{_example:["authenticated","libraries","$stateParams","$q",function(a,c,d,e){return c.loadWithExamples({id:d.libraryName},"libraries#show").then(function(a){var c=d.examplePath.replace(/\\/g,"/"),e=b(a.examples,{path:c,name:d.exampleName});return e}).catch(function(){return e.reject(new Error("MISSING_SKETCH"))})}]},onEnter:["_example","editor",function(a,b){b.setCurrentProject(a)}]}).state("example.custom",{url:"/example/custom/:libraryID/:exampleName/preview",parent:"example",templateUrl:"views/publicsketch/publicsketch.html",controller:"publicSketchCtrl",resolve:{_example:["authenticated","libraries","$stateParams","$q",function(a,c,d,e){return c.loadWithExamples({id:d.libraryID},"customLibraries#show").then(function(a){var c=b(a.examples,{name:d.exampleName});return c}).catch(function(){return e.reject(new Error("MISSING_SKETCH"))})}]},onEnter:["_example","editor",function(a,b){b.setCurrentProject(a)}]}).state("example.builtin",{url:"/example/builtin/:examplePath/:exampleName/preview",parent:"example",templateUrl:"views/publicsketch/publicsketch.html",controller:"publicSketchCtrl",resolve:{_example:["authenticated","examples","$stateParams","$q",function(a,c,d,e){return c.fetch().then(function(a){var c=d.examplePath.replace(/\\/g,"/"),e=b(a.tree.files,{path:c,name:d.exampleName});return e}).catch(function(){return e.reject(new Error("MISSING_SKETCH"))})}]},onEnter:["_example","editor",function(a,b){b.setCurrentProject(a)}]}).state("redeem",{parent:"main",url:"/redeem",controller:"redeemCtrl",templateUrl:"views/redeem/redeem.html",resolve:{user:["isAuthenticated","UserService",function(a,b){return b.profile()}]}}).state("getting-started",{parent:"main",data:{},url:"/getting-started",templateUrl:"views/gettingstarted/gettingstarted.html",resolve:{user:["$q","isAuthenticated","CreateUserService","config",function(a,b,c,d){return!b&&d.intelInstance?a.reject({message:"ANONYMOUS"}):d.intelInstance?c.getUserInfo().catch(function(){return a.reject({message:"ERROR_ACCESS_DENIED"})}):void 0}]},onEnter:["isAuthenticated","$rootScope","user","config",function(a,b,c,d){a?b.bootstrapped=!0:b.bootstrappedNoLogin=!0,d.intelInstance&&c.email.indexOf("arduino.cc")===-1&&c.email.indexOf("intel.com")===-1&&c.email.indexOf("bcmi-labs.cc")===-1&&c.email.indexOf("thugdesign.com")===-1&&c.email.indexOf("aaeon.eu")===-1&&(this.data.redirectTo="logged.home")}]}).state("getting-started-plugin",{parent:"main",url:"/getting-started/plugin",templateUrl:"views/gettingstarted/plugin/gettingstarted.html"}).state("getting-started-device",{parent:"logged",url:"/getting-started/device",controller:"gettingStartedDeviceCtrl",templateUrl:"views/gettingstarted/device/gettingstarted.html"}).state("getting-started-up2",{parent:"logged",url:"/getting-started/up2",controller:"gettingStartedUP2Ctrl",templateUrl:"views/gettingstarted/up2/gettingstarted.html"}).state("devices",{parent:"logged",data:{},url:"/devices",templateUrl:"views/devices/devices.html",controller:"devicesCtrl",onEnter:["user","config",function(a,b){(!b.intelInstance||b.intelInstance&&a.email.indexOf("arduino.cc")===-1&&a.email.indexOf("intel.com")===-1&&a.email.indexOf("bcmi-labs.cc")===-1&&a.email.indexOf("thugdesign.com")===-1&&a.email.indexOf("aaeon.eu")===-1)&&(this.data.redirectTo="logged.home")}]}).state("devices.selected",{parent:"logged",url:"/devices/:deviceID",templateUrl:"views/devices/devices.html",controller:"devicesCtrl"}).state("terms-and-conditions",{url:"/terms-and-conditions",templateUrl:"views/terms-and-conditions/terms-and-conditions.html",controller:["PageTitle",function(a){a.setTitle("Terms & Conditions")}]}).state("missing-sketch",{url:"/missing-sketch",templateUrl:"views/missing-sketch/missing-sketch.html"}).state("setup-done",{controller:"setupDoneCtrl",resolve:{httpsok:["daemon","$q","$timeout",function(a,b,c){var d=b.defer();if(a.findService){var e,f=!1,g=0,h=function(){f||(30===g?(c.cancel(e),d.resolve(!1)):(g++,e=c(h,500)))};h(),a.findService("https",8989,100).then(function(){f=!0,d.resolve(!0)})}else d.resolve(!0);return d.promise}]},url:"/setup-done",templateUrl:"views/gettingstarted/plugin/setupdone.html"}).state("nobrowser",{url:"/nobrowser",templateUrl:"views/nobrowser/nobrowser.html"}).state("error",{templateUrl:"views/error/error.html",controller:["$window","$interval",function(a,b){b(function(){a.location.reload()},3e4)}]}).state("chromeapp-waiting-list",{parent:"main",controller:"chromeappWlCtrl",resolve:{user:["isAuthenticated","UserService",function(a,b){if(a)return b.profile()}]},url:"/chromeapp-waiting-list",templateUrl:"views/betatesting/chromeapp-waiting-list.html"})}]),ideapp.config(["$urlRouterProvider","$locationProvider","tagsInputConfigProvider",function(a,b,c){a.otherwise("/"),a.deferIntercept(),b.html5Mode({enabled:!0,requireBase:!0}),c.setDefaults("tagsInput",{minLength:1,maxLength:30,displayProperty:"name",replaceSpacesWithDashes:!1,addOnSpace:!0}).setTextAutosizeThreshold(30)}]),function(){"use strict";function a(a,b){function c(c,d,e){return b.trustAsHtml(a("translate")(c,d,e))}return c}angular.module("ideapp").filter("translateAsHtml",a),a.$inject=["$filter","$sce"]}(),function(){"use strict";function a(){function a(a){return a.split(".")}function b(a,b){var c=a;return _.forEach(b,function(a){c&&(c=c[a])}),c}return function(c,d,e){var f=a(d);return _.filter(c,function(a){return b(a,f)==e})}}angular.module("ideapp").filter("findProperty",a)}(),function(){"use strict";angular.module("ideapp").filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():""}})}(),angular.module("alert",["pascalprecht.translate"]),function(){var a=angular.module("alert");a.directive("alert",["$sessionStorage",function(a){return{restrict:"E",templateUrl:"modules/alert/template.html",scope:{dismissable:"&?"},transclude:!0,link:function(b,c,d){c.addClass("alertDirective");var e=btoa(c);a[e]&&c.addClass("ng-hide"),b.dismissable=!angular.isDefined(b.dismissable())||b.dismissable(),b.dismiss=function(){c.slideUp(),a[e]=!0}}}}])}(),ideapp.directive("filelistBind",["sanity","$filter","$rootScope","modal","$q",function(a,b,c,d,e){return{link:function(c,f,g){f.bind("change",function(f){c.$apply(function(){if(f.target.files.length>0){d.show("wait",{title:b("translate")("WAIT_IMPORTING_ZIP")});for(var h=[],i=0;i<f.target.files.length;i++){var j=f.target.files[i],k=a.getFileType(j),l="binary"===g.filelistBind||a.isTypeBinary(k),m=e.defer();h.push(m.promise);var n=new FileReader;n.onload=function(a,b,d){return function(e){c.$apply(function(){var c=e.target.result;if(b){var f="base64,";c=c.substr(c.indexOf(f)+f.length)}a.resolve({name:d.name,content:c,type:k,size:d.size})})}}(m,l,j),l?n.readAsDataURL(j):n.readAsText(j)}e.all(h).then(function(a){a.length>1?c[g.name]=a:c[g.name]=a[0]})}})})}}}]),ideapp.directive("uploadfile",["messages","editor","modal","$filter","settings","CreateUserService",function(a,b,c,d,e,f){return{restrict:"A",templateUrl:"modules/fileUpload/template.html",replace:!1,transclude:!0,scope:{target:"="},link:function(e,g,h){var i=g.find("#uploadFile");g.bind("click",function(a){"uploadFile"!==a.target.id&&i&&i.trigger("click")}),e.$watch(function(){return e.uploadedFile},function(g){var h=f.userStats();if(angular.isUndefined(g))return void c.hide();Array.isArray(g)||(g=[g]);for(var j=_.some(g,function(a){var b=a.name;return _.findWhere(e.target.files,{name:b})}),k=0,l=0;l<g.length;l++)k+=g[l].size;if(k>h.availableSpace){var m=h.availableSpaceMB+" MB";0===h.availableSpaceMB&&(m=h.availableSpaceKB+" KB"),c.show("warning",{title:d("translate")("APOLOGIES_FILE_TOO_LARGE",{limit:m}),body:d("translate")("FILESYSTEM_FILE_TOO_LARGE",{limit:m}),type:"alert",cancel:!1,callback:function(){c.hide()}})}else j?c.show("warning",{title:d("translate")("ERROR_WHILE_IMPORT_FILE"),body:d("translate")("ERROR_DUPLICATE_FILE_ON_IMPORT"),type:"alert",cancel:!1,callback:function(){c.hide()}}):(h.availableSpaceMB<1&&c.show("usedSpace",{}),_.each(g,function(c){var d=c.name;a.add("M_FILE_IMPORT",{import_file_name:d},a.SUCCESS),b.addFileToTarget(d,c.content,c.type,e.target)}));i.val("")}),e.$on("$destroy",function(){g.unbind("click")})}}}]),ideapp.directive("uploadsketchbook",["$filter","$timeout","modal","deviceInfo","CreateUserService",function(a,b,c,d,e){return{restrict:"A",link:function(f,g,h){g.bind("click",function(){var f=e.userStats().spaceUsedPercMin;100===f||e.userStats().sketches>=e.userStats().limitSketches?c.show("usedSpace",{}):c.show("warning",{title:a("translate")("IMPORT_SKETCH_INFO"),body:'<div style="margin-bottom:8px">'+a("translate")("IMPORT_SKETCH_INFO_SUB")+"</div>"+a("translate")("IMPORT_SKETCH_INFO_TEXT")+"<br><br>"+a("translate")("IMPORT_SKETCH_INFO_NOTE"),button:"IMPORT",skip:"SKIP_IMPORT_WHOLE_SKETCHBOOK",cancel:!0,callback:function(){c.hide();var a=angular.element("#"+h.uploadsketchbook);a&&(a.val(""),"edge"===d.browser.getBrowser()?b(function(){a.trigger("click")},10):a.trigger("click"))}})})}}}]),angular.module("Apiv2",[]),function(){var a=angular.module("Apiv2");a.service("apiv2",["SerialApi",function(a){var b=function(){};return this.serial=a,b(),this}])}(),function(){var a=angular.module("Apiv2");a.factory("SerialApi",["daemon",function(a){function b(){}var c=function(b,c){return a.perform(b,c)},d=function(b,c){return a.onSerialData(c)};return b.onOutput=function(a){return d("serial_monitor_output",a)},b.open=function(a){return c("req_serial_monitor_open",a)},b.close=function(a){return c("req_serial_monitor_close",a)},b.write=function(a){return c("req_serial_monitor_write",a)},b}])}(),angular.module("autosave",[]),function(){var a=angular.module("autosave");a.directive("autosave",function(){var a={},b=function(b,c){a[b]&&clearTimeout(a[b]),a[b]=setTimeout(function(){c()},900)};return{require:"ngModel",restrict:"A",scope:!1,link:function(a,c,d){if(!d.autosave)throw"Autosave attribute value is needed";a.$watch(d.ngModel,function(c,e){c==e||_.isUndefined(e)||b(d.ngModel,function(){a[d.autosave]()})})}}})}(),angular.module("autoscroll",[]),function(){"use strict";function a(){return{restrict:"A",scope:!1,link:function(a,b,c){a.$watch(function(){return b[0].value},function(a,d){a!==d&&"false"!==c.autoscroll&&$(b).slimScroll({alwaysVisible:!0,scrollTo:b[0].scrollHeight})})}}}angular.module("autoscroll").directive("autoscroll",a)}(),function(){angular.module("importProcedure",[])}(),function(){"use strict";var a=angular.module("importProcedure");a.factory("importerTools",["settings","importer","sketches","modal","messages","$filter","$q","CreateUserService",function(a,b,c,d,e,f,g,h){var i={};return i.basicModal=function(a,b){return g(function(c,e){d.show("warning",{title:a,body:b,type:"alert",cancel:!1,callback:function(){d.hide(),c()}})})},i.checkImportFile=function(a,b){var c=a.split("."),d=c[c.length-1];return b.indexOf(d)!==-1&&d},i.checkFileRepeat=function(a){var b=a.substring(0,a.lastIndexOf(".")),d=[];c.tree.files.forEach(function(a){"folder"!==a.type&&d.push(a.name.toLowerCase())});var e=b.toLowerCase();return d.indexOf(e)>=0},i.basicCheck=function(a,b){var c,e=g.defer(),j=h.userStats(),k=i.checkImportFile(a.name,b);if(!k){var l=a.name;return i.basicModal(f("translate")("WARNING_WRONG_FILETYPE_TITLE",{filename:l}),f("translate")("WARNING_WRONG_FILETYPE_TEXT",{filename:l})).then(function(){e.reject()}),e.promise}c="zip"===k?"sketchbook":"file",e.resolve({type:c});var m=j.availableSpaceMB+" MB";if(0===j.availableSpaceMB&&(m=j.availableSpaceKB+" KB"),"sketchbook"===c){if(j.availableSpaceMB<1)return d.show("usedSpace",{}),e.promise;if(a.size>j.availableSpace)return i.basicModal(f("translate")("APOLOGIES_SKETCHBOOK_TOO_LARGE",{limit:m}),f("translate")("FILESYSTEM_SKETCHBOOK_TOO_LARGE",{limit:m})).then(function(){e.reject()}),e.promise}else if("file"===c){if(j.availableSpaceMB<1)return d.show("usedSpace",{}),e.promise;if(a.size>j.availableSpace)return i.basicModal(f("translate")("APOLOGIES_FILE_TOO_LARGE",{limit:m}),f("translate")("FILESYSTEM_FILE_TOO_LARGE",{limit:m})).then(function(){e.reject()}),e.promise;if(i.checkFileRepeat(a.name))return i.basicModal(f("translate")("ERROR_WHILE_IMPORT_SKETCH"),f("translate")("ERROR_DUPLICATE_SKETCH_ON_IMPORT",{name:a.name})).then(function(){e.reject()}),e.promise}return e.promise},i.sharedReport=function(a,b,c){return g(function(e,g){if(0!==a.success.length||0!==a.errors.length)d.hide(),d.show("importResult",{body:a,type:a.errors.length?"alert":"",type_content:b,cancel:!1,callback:function(){d.hide(),e()}});else if(c)e();else{var h,j;switch(b){case"sketch":h=f("translate")("ERROR_WHILE_IMPORT_SKETCH"),j=f("translate")("ERROR_ZIP_WITH_NO_SKETCH");break;case"library":h=f("translate")("ERROR_WHILE_IMPORT_LIBRARY"),j=f("translate")("NO_LIBRARY_IN_ZIP")}i.basicModal(h,j).then(function(){e()})}})},i.handleAPIError=function(a,b){return g(function(c,d){if("SIZE_LIMIT_REACHED"===a){var e=h.userStats(),g=e.availableSpaceMB+" MB";return 0===e.availableSpaceMB&&(g=e.availableSpaceKB+" KB"),void i.basicModal(f("translate")("APOLOGIES_FILE_TOO_LARGE",{limit:g}),f("translate")("FILESYSTEM_FILE_TOO_LARGE",{limit:g})).then(function(){c()})}var j,k;switch(b){case"sketch":j=f("translate")("ERROR_WHILE_IMPORT_SKETCH"),k=f("translate")("ERROR_WHILE_IMPORT_SKETCH_UNKNOWN");break;case"library":j=f("translate")("ERROR_WHILE_IMPORT_LIBRARY"),k=f("translate")("ERROR_WHILE_IMPORT_LIBRARY_UNKNOWN")}i.basicModal(j,k).then(function(){c()})})},i}])}(),function(){"use strict";var a=angular.module("importProcedure");a.factory("sketchBookImporter",["settings","importer","sketchImporter","libraryImporter","importerTools","modal","messages","$filter","$q","$timeout","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k){var l={};return l.import=function(a){e.basicCheck(a,["ino","pde","zip"]).then(function(g){return"file"===g.type?void c.importTextFile(a):void b.sketchBook(a).then(function(a){f.close();var b=k.$on("modalClosed",function(){b();var e=!0;0===a.sketch.errors.length&&0===a.sketch.success.length&&0===a.library.errors.length&&0===a.library.success.length&&(e=!1),c.handleResponse(a.sketch,e).then(function(){j(function(){d.handleNewResponse(a.library,e)},300)})})}).catch(function(a){e.handleAPIError(a,"sketch")})}).catch(function(a){console.log(a)})},l}])}(),function(){"use strict";var a=angular.module("importProcedure");a.factory("libraryImporter",["importer","importerTools","modal","messages","$filter","$q","$timeout","$rootScope",function(a,b,c,d,e,f,g,h){var i={};return i.report={errors:[],success:[]},i.updateLibrariesFromResponses=function(a){var b=_.map(a,function(a){return a.config.data});return i.importWithPayloads(b,!0)},i.handleNewResponse=function(a,d){return i.report={errors:[],success:[]},i.handleResponse(a,d).then(function(){var a=h.$on("modalClosed",function(){a(),b.sharedReport(i.report,"library",d)});c.close()})},i.handleResponse=function(a,b){var h=f.defer();_.forEach(a.success,function(a){d.add("M_LIBRARY_IMPORT",{name:a.data.name},d.SUCCESS)}),_.merge(i.report.success,a.success);var j=[];return _.forEach(a.errors,function(a){409==a.status?j.push(a):i.report.errors.push(a)}),j.length?(c.hide(),c.show("library-import",{callback:function(){g(function(){c.show("wait",{title:e("translate")("WAIT_IMPORTING_ZIP")})},100),i.updateLibrariesFromResponses(j).then(function(){h.resolve()})},callback_close:function(){_.merge(i.report.errors,j),h.resolve()}})):h.resolve(),h.promise},i.importWithPayloads=function(c,d){var e=f.defer();return a.libraryFromPayloads(c,d).then(function(a){i.handleResponse(a).then(function(){e.resolve()})}).catch(function(a){b.handleAPIError(a,"library").then(function(){e.resolve()})}),e.promise},i.importWithZip=function(c){var d=f.defer();return a.libraries(c).then(function(a){i.handleNewResponse(a).then(function(){d.resolve()})}).catch(function(a){b.handleAPIError(a,"library").then(function(){d.resolve()})}),d.promise},i.import=function(a){return i.report={errors:[],success:[]},f(function(b,c){i.importWithZip(a).then(b)})},i}])}(),function(){"use strict";var a=angular.module("importProcedure");a.factory("sketchImporter",["settings","sketches","importer","importerTools","modal","messages","$filter","$q",function(a,b,c,d,e,f,g,h){var i={};return i.importTextFile=function(a){var c=a.name,d=c.substring(0,c.lastIndexOf("."));f.add("M_SKETCH_IMPORT",{importSketchName:a.name},f.SUCCESS),b.addTemporarySketch(d,a.content),e.hide()},i.handleResponse=function(a,b){var c=h.defer();return d.sharedReport(a,"sketch",b).then(function(){c.resolve()}),f.add("M_SKETCHBOOK_IMPORT_SUCCESS",{number:a.success.length},f.SUCCESS),c.promise},i}])}(),angular.module("menu",[]),function(){var a=angular.module("menu");a.directive("mainMenu",["mainMenu","deviceInfo",function(a,b){return{restrict:"E",templateUrl:"modules/menu/template.html",scope:{},link:function(c,d){d.addClass("main-menu"),c.menuItems=a.items(),"middle"===b.screen.dimensionType()&&(a.present=null)}}}])}(),function(){var a=angular.module("menu");a.service("mainMenu",["MenuBuilder",function(a){return new a}])}(),function(){var a=angular.module("menu");a.factory("MenuBuilder",["MenuItem","_",function(a,b){function c(a){a=angular.isDefined(a)?a:{},this.self_toggable=angular.isDefined(a.self_toggable)?a.self_toggable:void 0,this._items=[]}return c.prototype={present:null,addItem:function(c,d,e,f){var g,h;h=b.find(this._items,function(a){return a.id===c}),h||(g=new a(c,d,e,f,this.self_toggable),this._items.push(g))},items:function(){return this._items}},c}])}(),function(){var a=angular.module("menu");a.factory("MenuItem",["toggler",function(a){function b(a,b,c,d,e){this.id=a,this.path=b,this.label=c,this.letter=angular.isDefined(d)?d:"a",this.self_toggable=!angular.isDefined(e)||e}return b.prototype={current:function(){return a.currentOpen()===this.id},getClass:function(){return a.currentOpen()===this.id?"selected":""},select:function(){a.open(this.id)},close:function(){a.close()},toggle:function(){return this.self_toggable?a.toggle(this.id):!this.self_toggable&&!this.current()&&a.toggle(this.id)}},b}])}(),angular.module("select",["lodash"]),function(){var a=angular.module("select");a.directive("arSelect",["_",function(a){return{restrict:"E",templateUrl:"modules/select/template.html",scope:{data:"=",scrollable:"&",isdisabled:"&"},link:function(b,c){c.addClass("select"),b.disabled=b.isdisabled;var d=function(){var a=this;return"undefined"!=typeof a.action&&null!==a.action||(a.action=function(){return!0}),"undefined"!=typeof a.disabled&&null!==a.disabled||(a.disabled=!1),"undefined"!=typeof a.selected&&null!==a.selected||(a.selected=!1),a},e=function(){var a=this,b=!1;return"function"==typeof a.selected?b=a.selected():"boolean"==typeof a.selected&&(b=a.selected),a.isSelected=b,b===!0?a:null};b.data.items=a(b.data.items).invoke(d).value();var f=a(b.data.items).invoke(e).compact().first();b.$watch("data",function(c,g){b.data.items=a(c.items).invoke(d).value(),f=a(b.data.items).invoke(e).compact().first()},!0),b.getCurrentItemLabel=function(){var a;return a=f?f.label:"undefined"!=typeof b.data.label?b.data.label:"Select an option"},b.getCurrentItemTooltip=function(){var a=null;return f&&f.tooltip&&(a=f.tooltip),a},b.select=function(c,d,g){return g&&g.stopPropagation(),!c.disabled&&void(c.action(d)&&(f=c,a(b.data.items).invoke(e)))};var g=c.find(".open-dropdown"),h=c.find(".select-content");b.isOpen=!1,h.addClass("ng-hide");var i=function(a){$(c).find(".ar-select-overlay").hide(),b.isOpen=!1,a.addClass("ng-hide")},j=function(a){$(c).find(".ar-select-overlay").show(),b.isOpen=!0,a.css("width",c.outerWidth()+"px"),a.removeClass("ng-hide")},k=function(){b.isOpen?i(h):j(h)};g.on("click",k),h.on("click",k),$(c).find(".ar-select-overlay").on("click",function(){i(h)})}}}])}(),function(){angular.module("serial",[])}(),function(){"use strict";var a=angular.module("serial");a.factory("NetworkComPort",["Thing","devices","$q",function(a,b,c){function d(c,d){this.com_name=c,this.thing=new a(c,b.client),this.onOutput=d}var e;return d.prototype.open=function(){var a=c.defer(),b=this;return e=this.thing.subscribe("/stdout",function(a){b.onOutput(a)}),a.resolve(),a.promise},d.prototype.close=function(){var a=c.defer();return e&&e.remove(),this.thing.unsubscribe("/stdout",function(){a.resolve()}),a.promise},d.prototype.send=function(a){var b=c.defer();return this.thing.send("/stdin",a,function(){b.resolve()}),b.promise},d}])}(),function(){"use strict";var a=angular.module("serial");a.factory("SerialComPort",["SerialPort",function(a){function b(b,c){a.call(this),this.type="serial",this.com_name=b,this.baudrate=c,this.isOpening=!1,this.openPromise=null}return b.prototype=Object.create(a.prototype),b.prototype.open=function(){var b,c=this;return this.isOpening?b=this.openPromise:(this.isOpening=!0,b=a.prototype.open.call(this),b.finally(function(){c.isOpening=!1,c.openPromise=null}),this.openPromise=b),b},b.prototype.close=function(){this.isOpening=!1;var b=a.prototype.close.call(this);return b},b}])}(),function(){"use strict";var a=angular.module("serial");a.factory("SerialPort",["apiv2",function(a){function b(){}return b.prototype.close=function(){return a.serial.close(this).then(function(){return!0})},b.prototype.open=function(){return a.serial.open(this).then(function(){return!0})},b.prototype.onOutput=function(b){return a.serial.onOutput(b)},b.prototype.send=function(b){this.data=b;var c=this;return a.serial.write(this).then(function(){delete c.data})},b}])}(),function(){"use strict";var a=angular.module("serial");a.service("SerialPortManager",["SerialComPort","NetworkComPort","$q","apiv2","boards","$timeout","toggler",function(a,b,c,d,e,f,g){var h=null,i="\n",j=9600,k={},l=!0,m=!1,n=function(a){var b=a||e.selected;return e.isPortOpen(b)},o=function(a){h&&void 0!==k[h.com_name]&&(k[h.com_name]+=a,k[h.com_name]=k[h.com_name].substr(-35e3))},p=function(c){var d=c.network?"network":"serial";if("cloud"===c.type)c=new b(c.com_name,o);else{if("serial"!==d)throw"SerialPort type not supported";c=new a(c.com_name,j)}return c};return d.serial.onOutput(function(a){
o(a.data)}),this.disconnect=function(){this.close().then(function(){l=!1})},this.connect=function(){this.open().then(function(){l=!0})},this.updatePort=function(a){if(k[a.com_name]="",a&&a.com_name&&("serial"===a.type||"cloud"===a.type)){var b=p(a);h=b}else h=""},this.setUploadStatus=function(a){m=a},this.getUploadStatus=function(){return m},this.getFreezeStatus=function(){return!!(e.isDisconnected(e.selected)||m||l&&!n())},this.getUserStatus=function(){return l},this.close=function(){var a=(c.defer(),[]);console.log("[serial monitor] - try close");for(var b=0;b<e.connected.length;b++){var d=e.connected[b];if(n(d.val)&&d.val.com_name&&("serial"===d.val.type||"cloud"===d.val.type)){var f=p(d.val);a.push(f.close())}}return l=!0,c.all(a)},this.currentPort=function(){return h},this.open=function(a){var b=c.defer();return"serialSidebar"!==g.currentOpen()||!h||n()&&"cloud"!==e.selected.type||a&&(!a||m)?b.reject():(console.log("[serial monitor] - try open"),k[h.com_name]="",h.open().then(function(){b.resolve(h),l=!0},function(a){b.reject(a)})),b.promise},this.output=function(){return h&&!this.getFreezeStatus()&&k[h.com_name]?k[h.com_name]:""},this.send=function(a){return h?void h.send(a+i):c.when(!1)},this.setLineEnding=function(a){i=a},this.setBaudrate=function(a){j=a;var b=this;h&&"serial"===h.type&&(h.baudrate=a,b.close().then(function(){f(function(){b.open()},3e3)}))},this}])}(),function(){"use strict";angular.module("svgIcons",[])}(),function(a){"use strict";function b(a){function b(b,c,d){var e=a.compile(d.name);c.find("use")[0].setAttributeNS("http://www.w3.org/1999/xlink","href",e)}var c={link:b,restrict:"E",replace:!0,template:'<div class="svg-icon"><div class="cover"></div><svg xmlns:xlink="http://www.w3.org/1999/xlink">\n  <use/>\n</svg></div>'};return c}angular.module("svgIcons").directive("svgIcon",b),b.$inject=["svgIconHandler"]}(angular.element),function(){"use strict";function a(){var a={url:"assetz/icons.svg"};return this.options=function(b){b=b||{},a=angular.extend(a,b)},this.$get=["$sce",function(b){return{compile:function(c){var d=a.url+"#icon-"+c;return b.trustAsUrl(d).toString()}}}],this}angular.module("svgIcons").provider("svgIconHandler",a)}(),function(){"use strict";angular.module("svgIllustrations",[])}(),function(a){"use strict";function b(a){function b(b,c,d){var e=a.compile(d.name);c.find("use")[0].setAttributeNS("http://www.w3.org/1999/xlink","href",e)}var c={link:b,restrict:"E",replace:!0,template:'<div class="svg-icon"><div class="cover"></div><svg>\n  <use/>\n</svg></div>'};return c}angular.module("svgIllustrations").directive("svgIllustration",b),b.$inject=["svgIllustrationHandler"]}(angular.element),function(){"use strict";function a(){var a={url:"assetz/illustrations.svg"};return this.options=function(b){b=b||{},a=angular.extend(a,b)},this.$get=["$sce",function(b){return{compile:function(c){var d=a.url+"#illustration-"+c;return b.trustAsUrl(d).toString()}}}],this}angular.module("svgIllustrations").provider("svgIllustrationHandler",a)}(),angular.module("timezone",[]),function(a){var b=function(){"use strict";var a="s",c=function(a){var b=-a.getTimezoneOffset();return null!==b?b:0},d=function(a,b,c){var d=new Date;return void 0!==a&&d.setFullYear(a),d.setDate(c),d.setMonth(b),d},e=function(a){return c(d(a,0,2))},f=function(a){return c(d(a,5,2))},g=function(a){var b=a.getMonth()>7?f(a.getFullYear()):e(a.getFullYear()),d=c(a);return b-d!==0},h=function(){var b=e(),c=f(),d=e()-f();return d<0?b+",1":d>0?c+",1,"+a:b+",0"},i=function(){var a=h();return new b.TimeZone(b.olson.timezones[a])};return{determine:i,date_is_dst:g}}();b.TimeZone=function(a){"use strict";var c=null,d=function(){return c},e=function(){for(var a=b.olson.ambiguity_list[c],d=a.length,e=0,f=a[0];e<d;e+=1)if(f=a[e],b.date_is_dst(b.olson.dst_start_dates[f]))return void(c=f)},f=function(){return"undefined"!=typeof b.olson.ambiguity_list[c]};return c=a,f()&&e(),{name:d}},b.olson={},b.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Santiago","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"Etc/GMT+2","-120,1":"Etc/GMT+2","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"Etc/UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Tarawa","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},b.olson.dst_start_dates=function(){"use strict";var a=new Date(2010,6,15,1,0,0,0);return{"America/Denver":new Date(2011,2,13,3,0,0,0),"America/Mazatlan":new Date(2011,3,3,3,0,0,0),"America/Chicago":new Date(2011,2,13,3,0,0,0),"America/Mexico_City":new Date(2011,3,3,3,0,0,0),"America/Asuncion":new Date(2012,9,7,3,0,0,0),"America/Santiago":new Date(2012,9,3,3,0,0,0),"America/Campo_Grande":new Date(2012,9,21,5,0,0,0),"America/Montevideo":new Date(2011,9,2,3,0,0,0),"America/Sao_Paulo":new Date(2011,9,16,5,0,0,0),"America/Los_Angeles":new Date(2011,2,13,8,0,0,0),"America/Santa_Isabel":new Date(2011,3,5,8,0,0,0),"America/Havana":new Date(2012,2,10,2,0,0,0),"America/New_York":new Date(2012,2,10,7,0,0,0),"Asia/Beirut":new Date(2011,2,27,1,0,0,0),"Europe/Helsinki":new Date(2011,2,27,4,0,0,0),"Europe/Istanbul":new Date(2011,2,28,5,0,0,0),"Asia/Damascus":new Date(2011,3,1,2,0,0,0),"Asia/Jerusalem":new Date(2011,3,1,6,0,0,0),"Asia/Gaza":new Date(2009,2,28,0,30,0,0),"Africa/Cairo":new Date(2009,3,25,0,30,0,0),"Pacific/Auckland":new Date(2011,8,26,7,0,0,0),"Pacific/Fiji":new Date(2010,11,29,23,0,0,0),"America/Halifax":new Date(2011,2,13,6,0,0,0),"America/Goose_Bay":new Date(2011,2,13,2,1,0,0),"America/Miquelon":new Date(2011,2,13,5,0,0,0),"America/Godthab":new Date(2011,2,27,1,0,0,0),"Europe/Moscow":a,"Asia/Yekaterinburg":a,"Asia/Omsk":a,"Asia/Krasnoyarsk":a,"Asia/Irkutsk":a,"Asia/Yakutsk":a,"Asia/Vladivostok":a,"Asia/Kamchatka":a,"Europe/Minsk":a,"Australia/Perth":new Date(2008,10,1,1,0,0,0)}}(),b.olson.ambiguity_list={"America/Denver":["America/Denver","America/Mazatlan"],"America/Chicago":["America/Chicago","America/Mexico_City"],"America/Santiago":["America/Santiago","America/Asuncion","America/Campo_Grande"],"America/Montevideo":["America/Montevideo","America/Sao_Paulo"],"Asia/Beirut":["Asia/Beirut","Europe/Helsinki","Europe/Istanbul","Asia/Damascus","Asia/Jerusalem","Asia/Gaza"],"Pacific/Auckland":["Pacific/Auckland","Pacific/Fiji"],"America/Los_Angeles":["America/Los_Angeles","America/Santa_Isabel"],"America/New_York":["America/Havana","America/New_York"],"America/Halifax":["America/Goose_Bay","America/Halifax"],"America/Godthab":["America/Miquelon","America/Godthab"],"Asia/Dubai":["Europe/Moscow"],"Asia/Dhaka":["Asia/Yekaterinburg"],"Asia/Jakarta":["Asia/Omsk"],"Asia/Shanghai":["Asia/Krasnoyarsk","Australia/Perth"],"Asia/Tokyo":["Asia/Irkutsk"],"Australia/Brisbane":["Asia/Yakutsk"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Tarawa":["Asia/Kamchatka"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"],"Asia/Baghdad":["Europe/Minsk"]},"undefined"!=typeof exports?exports.jstz=b:a.jstz=b}(this),function(){"use strict";angular.module("timezone").value("jstz",window.jstz)}(),function(){var a=angular.module("timezone");a.service("TimezoneSrv",["$http","$q","jstz",function(a,b,c){var d,e="modules/timezone/timezones.json",f=function(){};this.getTimezones=function(){var a=b.defer();return a.resolve(g()),a.promise},this.getUserTimezone=function(){var a=b.defer();return a.resolve(h()),a.promise};var g=function(){return a.get(e).then(function(a){return a.data.timezones},function(a){return console.log("Could not retrieve timezones"),null})},h=function(){if(d)return d;var a=c.determine();return d=a.name()};return f(),this}])}(),angular.module("toolbar",["Apiv2"]),function(){var a=angular.module("toolbar");a.directive("toolbarHeader",["$timeout","editor","apiv2","messages",function(a,b,c,d){return{restrict:"E",templateUrl:"modules/toolbar/header.html",scope:{title:"=toolbarTitle",titleClbk:"&"},link:function(a,b){b.addClass("toolbar-header")},controller:["$scope","$element",function(a,b){a.titleClick=function(){a.titleClbk()}}]}}])}(),angular.module("usrProfile",[]),function(){var a=angular.module("usrProfile");a.directive("userProfile",function(){return{restrict:"E",templateUrl:"modules/userProfile/userProfile.html",controller:["$scope","$element","UserService",function(a,b,c){c.profile().then(function(b){a.userPicUrl=b.public.avatar||"noavatar"})}]}}).directive("errSrc",function(){return{restrict:"A",link:function(a,b,c){b.bind("error",function(){$(this).hide(),$(".default-usr-pic").show()})}}}).controller("logoutCtrl",["$scope","$location","AuthService",function(a,b,c){a.logout=function(){var a=b.absUrl();a.indexOf("/preview")===-1?c.logout():c.logout(a)}}])}(),angular.module("tooltip",[]),function(){"use strict";angular.module("tooltip").value("Tooltip",window.Tooltip)}(),function(){var a=angular.module("tooltip"),b=angular.extend;a.provider("tetherTooltip",function(){var a={tetherTooltip:{position:"top center",openOn:"hover",classes:"tooltip-theme-arrows",constrainToWindow:!0,constrainToScrollParent:!1},template:"<span>{{content}}</span>"},c={};this.options=function(a){b(c,a)},this.$get=["$compile","skin","Tooltip",function(d,e,f){return function(g,h,i){var j=b({},a,c);i.position=angular.isDefined(i.position)?i.position:"bottom center";var k=d(j.template)(i)[0],l=b(j.tetherTooltip,i,{target:g,content:k,classes:e.current()+" "+h}),m=new f(l);return i.$on("$destroy",function(){m.destroy()}),i.$watch(function(){return e.current()},function(a,b){if(a!==b){var c=m.options;m.destroy(),c.classes=e.current()+" "+h,m=new f(c)}}),m}}]})}(),function(){var a=angular.module("tooltip");a.directive("tooltip",["tetherTooltip",function(a){return{restrict:"A",scope:{content:"=tooltip",position:"@?tooltipPosition"},link:function(b,c,d){if(b.content){c.addClass("tooltip");var e=d.tooltipClass||"",f=function(){var d=a(c[0],e,b);c.bind("click",function(){try{d.close()}catch(a){console.log(d)}}),c.parents(".scrollable").bind("scroll",function(){try{d.close()}catch(a){console.log(d)}})};void 0!==d.onEllipsis?c.bind("mouseenter",function(){this.offsetWidth<this.scrollWidth&&f()}):f()}}}}])}(),function(){"use strict";angular.module("arduino.coachmarks",[])}(),function(){"use strict";function a(a){function b(){this.coachmarksOverlay=null}b.prototype.register=function(a){this.coachmarksOverlay=a},b.prototype.open=function(b){a.open("sketchbookSidebar"),this.coachmarksOverlay.open(b)};var c=new b;return c}angular.module("arduino.coachmarks").service("Coachmarks",a),a.$inject=["toggler"]}(),function(){"use strict";function a(a,b,c,d,e){function f(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",a),c.setAttribute("class",b),j.$svg[0].appendChild(c)}function g(a,b){var c=[],d=$(a).offset(),e=$(a).outerWidth(),g=$(a).outerHeight();$(a).css("box-shadow")&&"none"!==$(a).css("box-shadow")&&(g+=4),c.push("M "+[d.left,d.top].join(",")),c.push("v "+g),c.push("h "+e),c.push("v "+-g),c.push("Z"),c=c.join(" "),f(c,"transparent-overlay"),b.push(c)}function h(){var b=a.innerWidth,c=a.innerHeight,e=["M 0,0"];return b<=750?($("#homeContainer").removeClass("coachmarks-first-step-open"),void j.close()):(e.push("h "+b),e.push("v "+c),e.push("h "+-b),e.push("Z"),angular.forEach(j.steps,function(a){angular.forEach(a,function(a){a.$target=angular.element(a.target),a.step===j.currentStep?(a.openPanel&&d.currentOpen()!==a.openPanel&&(d.open(a.openPanel),$("div#"+a.openPanel).parent(".sidebar").removeClass("ng-hide")),a.$target.each(function(){var b=this;g(b,e),0===a.step&&$("#homeContainer").addClass("coachmarks-first-step-open"),a.open()})):(0===a.step&&$("#homeContainer").removeClass("coachmarks-first-step-open"),a.close())})}),j.$svg.empty(),void f(e.join(" "),"visible-overlay"))}var i,j=this;j.steps={},j.currentStep=-1,j.isOpen=!1;var k,l;j.$onInit=function(){j.$svg=b.find("svg"),c.register(j)},j.$onDestroy=function(){angular.element(a).off("resize",h),$("#serialSidebar .overlay").removeClass("hidden")},j.register=function(a){j.steps[a.step]=j.steps[a.step]||[],j.steps[a.step].push(a)},j.open=function(b){i=b,angular.element(a).on("resize",h),j.currentStep=0,k=$("#serialSidebar.freezed").length,l=_.remove(e.items,{type:e.CONNECTION_LOST}),k&&$("#serialSidebar.subSidebarContainer").removeClass("freezed"),h(),j.isOpen=!0},j.close=function(){angular.element(a).off("resize",h),j.currentStep=-1,j.isOpen=!1,k&&$("#serialSidebar.subSidebarContainer").addClass("freezed"),0!==l.length&&e.add("PLUGIN_DISCONNECTED",{},e.CONNECTION_LOST,-1,!0),"function"==typeof i&&i(),d.open("sketchbookSidebar")},j.next=function(){j.hasNext()&&(j.currentStep++,h())},j.hasNext=function(){return j.currentStep<Object.keys(j.steps).length-1},j.selectStep=function(a){j.currentStep=a,h()}}angular.module("arduino.coachmarks").component("coachmarksOverlay",{controller:a,templateUrl:"modules/coachmarks/coachmarks-overlay.html",transclude:!0}),a.$inject=["$window","$element","Coachmarks","toggler","messages"]}(),function(){"use strict";function a(a,d){function e(){var d=f.$target.offset(),e=f.$target.outerWidth(),g=f.$target.outerHeight();if(f.$target.css("box-shadow")&&"none"!==f.$target.css("box-shadow")&&(g+=4),f.$target.length>1){var h=$(f.$target[0]).offset().left,i=$(f.$target[f.$target.length-1]).offset().left+$(f.$target[f.$target.length-1]).outerWidth();e=i-h}var j={top:c+g+d.top};switch(f.position){case b.LEFT:j.left=d.left+e/2;break;case b.RIGHT:j.right=a.innerWidth-d.left-e/2;break;default:j.left=d.left+e/2-f.$content.outerWidth()/2}switch(f.blockPosition){case b.LEFT:j.top=d.top+g/2-f.$content.outerHeight()/2,j.right=d.right+e+c;break;case b.RIGHT:j.top=d.top+g/2-f.$content.outerHeight()/2,j.left=d.left+e+c}f.position&&f.$content.css(j)}var f=this;f.$onInit=function(){d.children().addClass(f.position||b.CENTER).addClass("step-"+f.step),f.blockPosition&&d.children().addClass(f.blockPosition+"-side"),f.$content=d.find(".coachmark-content"),f.coachmarksOverlay.register(f)},f.open=function(){e(),f.isOpen=!0},f.close=function(){f.isOpen=!1}}var b={LEFT:"left",RIGHT:"right",CENTER:"center"},c=10;angular.module("arduino.coachmarks").component("coachmark",{bindings:{step:"<",target:"@",position:"@?",blockPosition:"@?",openPanel:"@?"},require:{coachmarksOverlay:"^coachmarksOverlay"},controller:a,templateUrl:"modules/coachmarks/coachmark.html",transclude:!0}),a.$inject=["$window","$element"]}(),ideapp.factory("ace",["$rootScope","$window","$timeout","skin",function(a,b,c,d){ace.require("ace/ext/language_tools");var e={};e.error_marker=null;var f,g={};e.setTheme=function(a){e.ace_ref.setTheme("ace/theme/arduino_"+a)},e.setFontSize=function(b){a.$evalAsync(function(){e.ace_ref.setFontSize(b+"px")})},e.getTheme=function(){return"arduino_"+d.current()};var h="";e.fillClipBoard=function(a){h=a},e.getClipBoard=function(){return h},e.init=function(c,g){e.ace_ref=c,e.ace_session=e.ace_ref.getSession(),e.undo_manager=e.ace_session.getUndoManager(),e.mode=e.ace_session.getMode(),e.ace_ref.setShowPrintMargin(!1),e.ace_session.selection.on("changeSelection",e.selectionChange),e.ace_ref.renderer.setScrollMargin(8,8,0,0),e.ace_ref.setOptions({highlightActiveLine:!1,tabSize:2,useSoftTabs:!0}),e.ace_ref.$blockScrolling=1/0;var h=b.ace.require("hoverlink").HoverLink;e.ace_ref.hoverLink=new h(e.ace_ref),e.ace_ref.hoverLink.on("open",function(a){b.open(a.value)}),e.setFontSize(d.currentFontSize()),g&&(f=g.path),e.ace_ref.commands.removeCommands(["touppercase","showSettingsMenu"]),e.ace_ref.commands.bindKey("Ctrl-D",null),e.ace_ref.commands.bindKey("Command-D",null),e.ace_ref.commands.addCommand({name:"findreplace",bindKey:{win:"Ctrl-Shift-F",mac:"Command-Shift-F"},exec:function(){e.ace_ref.execCommand("replace")}}),e.ace_ref.commands.addCommand({name:"custremoveline",bindKey:{win:"Ctrl-X",mac:"Command-X"},exec:function(){var a=e.ace_ref.getSelection();return!!a.isEmpty()&&void e.ace_ref.execCommand("removeline")}}),i(),$(window).resize(i),a.$emit("aceInstanceReady"),e.inited=!0},e.selectionChange=function(){e.ace_ref},e.onChangingContent=function(){g[f]={undo:JSON.stringify(e.undo_manager.$undoStack),redo:JSON.stringify(e.undo_manager.$redoStack),counter:e.undo_manager.dirtyCounter}},e.onContentChanged=function(a){if(!a)return void console.log("onContentChanged no file");var b=a.path;e.undo_manager.reset(),g[b]&&(e.undo_manager.$undoStack=JSON.parse(g[b].undo),e.undo_manager.$redoStack=JSON.parse(g[b].redo),e.undo_manager.dirtyCounter=g[b].counter),f=b},e.hasSelection=function(){var a=e.ace_ref.getSelection();return!a.isEmpty()},e.hasUndo=function(){return e.undo_manager.hasUndo()},e.undo=function(){c(function(){e.undo_manager.undo()})},e.hasRedo=function(){return e.undo_manager.hasRedo()},e.redo=function(){c(function(){e.undo_manager.redo()})},e.selectAll=function(){e.ace_session.selection.selectAll()},e.clearSelection=function(){e.ace_session.selection.clearSelection()},e.toggleComment=function(){e.ace_ref.toggleBlockComment()},e.openFind=function(){e.ace_ref.execCommand("find")},e.openFindAndReplace=function(){e.ace_ref.execCommand("replace")},e.increaseIndent=function(){e.ace_ref.blockIndent()},e.decreaseIndent=function(){e.ace_ref.blockOutdent()},e.clearErrors=function(){c(function(){null!==e.error_marker&&c(function(){e.ace_session.removeMarker(e.error_marker),e.error_marker=null})})},e.highlightError=function(a){var d=b.ace.require("ace/range").Range,f=new d(a-1,0,a,0);c(function(){e.error_marker=e.ace_session.addMarker(f,"ace_error","line_full")})};a.$on("endSplitter",function(){c(function(){i()})}),a.$on("fullScreenChanged",function(){c(function(){i()})}),a.$on("verboseChanged",function(){c(function(){i()})});var i=function(){var b=angular.element("#mainContent");b.css("max-height","none"),angular.element(".ace_editor").css("height",0);var c=angular.element("#editor").height(),d=angular.element("#mainContent").height();d||(d=angular.element("#publicSketch").height());var f=angular.element("#tabBar").height(),g=angular.element("#toolBar").height(),h=angular.element("#notify").height(),i=d-(f+g+h);i<c&&(c=i),angular.element(".ace_editor").css("height",c),e.ace_ref&&e.ace_ref.resize(),a.$emit("aceResized"),d=b.height(),b.css("max-height",d)};return e}]),ideapp.service("APIAlive",["$http","config",function(a,b){function c(){return a.get(d)}var d=b.alive.endpoint;return{checkIfAlive:c}}]),ideapp.service("boards",["$filter","$q","messages","builderAPI","modal","localStorageService","settings","devices","Thing",function(a,b,c,d,e,f,g,h,i){function j(a,b){for(var c in a){if(b&&b.val&&b.val.com_name===a[c].Name)return a[c];if(a[c].val&&a[c].val.com_name===b.Name)return a[c];if(a[c].val&&a[c].val.com_name===b.com_name&&a[c].val.fqbn===b.fqbn)return a[c]}}function k(a,b){for(var c in a)if(b.name===a[c].val.name&&b.second_label===a[c].second_label)return a[c]}function l(a,b){for(var c in a)if(a[c].vid===b.vid&&a[c].pid===b.pid)return c}function m(a){return!g.boardsFqbnWhitelist||g.boardsFqbnWhitelist.indexOf(a)!==-1}function n(c,f){var g={vid:f.VendorID,pid:f.ProductID},h="Board",i="",k="",n={},o=l(q.unsupportedMapping,g),p=q.unsupportedMapping[o];return d.do("boards_v2#byVidPid",{params:g}).then(function(a){return n=a.data,h=a.data.name,i=a.data.fqbn,k=a.data.architecture,h}).finally(function(){if(j(c,f)||i&&!m(i))return b.reject();n.com_name=f.Name,n.network=!1,n.type="serial";var d,h,l=q.getBoardName(n),o=l.info,r="default";if(p){if(l.name=p.name,o="Board as "+a("translate")(l.name)+" at "+n.com_name,d=a("translate")(l.name),i=p.fqbn,h=p.upload)for(var s=0;s<h.length;s++)h[s].package=p.package;r=p.flavour}else{if(h=n.upload)for(var t=0;t<h.length;t++)h[t].package=n.package;n.default_flavour&&(r=n.default_flavour)}var u;return u=f.NetworkPort?"network":"serial",c.push({label:o,tooltip:o,second_label:d,info:l.info,val:{name:l.name,com_name:f.Name,fqbn:i,arch:k,network:f.NetworkPort,type:u,upload:h,flavour:r},action:function(a){return this.val.fqbn&&!a?(q.select(this.val),!0):void e.show("target",{hardwarePorts:q.hardwarePorts,port_selected:this.val.com_name,vid:g.vid,pid:g.pid})},selected:function(){return q.selected&&q.selected.com_name===this.val.com_name&&q.selected.fqbn===this.val.fqbn}}),l.name})}function o(a,c){var d;d=c.NetworkPort?"network":"serial";var e={com_name:c.Name,name:c.ProductID,network:c.NetworkPort,type:d,fqbn:c.VendorID},f=q.getBoardName(e);return a.push({label:f.info,tooltip:f.info,info:f.info,val:{name:c.ProductID,com_name:c.Name,network:c.NetworkPort,type:d,fqbn:"arduino:avr:yun"},action:function(){return q.select(this.val),!0},selected:function(){return q.selected&&q.selected.com_name===this.val.com_name}}),b.resolve(f.name)}function p(a,c){for(var d=0;d<a.length;d++)if(a[d].val.com_name===c.id)return b.reject();var e=new i(c.id,h.client);a.push({label:c.name+" via Cloud",tooltip:c.name+" via Cloud",val:{fqbn:"arduino:mraa:intel_x86_64",name:c.name,com_name:c.id,type:"cloud",isOpen:!0,thing:e},action:function(){return q.select(this.val),!0},selected:function(){return q.selected&&q.selected.com_name===this.val.com_name}})}var q={connected:[],selected:null,updateMetaCallback:null,updateSerialCallback:null,unsupportedMapping:f.get("unsupportedMapping")||[],hardwarePorts:[],chromeOsSupported:[],chromeOsOnlyCompile:[],archBoardList:[],initHardwarePorts:function(){h.list().then(function(a){_.each(a,function(a){p(this.connected,a)}.bind(this))}.bind(this));var a=[];return d.do("boards_v2#list").then(function(b){for(var c=b.data.items,d=0;d<c.length;d++){for(var e=c[d].name,f=0;f<g.boardsBlackList.length;f++)e.indexOf(g.boardsBlackList[f])!==-1&&(c[d].private=!0);g.boardsFqbnWhitelist&&g.boardsFqbnWhitelist.length&&g.boardsFqbnWhitelist.indexOf(c[d].fqbn)===-1&&(c[d].chromeOsPartialSupport=!0),c[d].name&&a.push(c[d])}this.hardwarePorts=_.reject(a,{private:!0}),this.chromeOsSupported=_.reject(angular.copy(q.hardwarePorts),{chromeOsPartialSupport:!0}),this.chromeOsOnlyCompile=_.reject(angular.copy(q.hardwarePorts),{chromeOsPartialSupport:void 0});var h=angular.copy(q.hardwarePorts);this.archBoardList=_.remove(h,function(a){return g.archBlackList.indexOf(a.fqbn)===-1})}.bind(this))},update:function(a){_.each(a,function(a){if(!j(this.connected,a)&&a.VendorID.indexOf("Y\\195\\186n Shield")===-1){var b;b=a.NetworkPort?o(this.connected,a):n(this.connected,a),b.then(function(a){c.add("NEW_BOARD_ADDED",{board_name:a})}).catch(function(a){a&&a.data&&"NotFound"===a.data.name&&c.add("NEW_BOARD_ADDED",{board_name:"Board"})})}}.bind(this)),_.each(this.connected,function(b){var d=j(a,b);if(d&&(b.val.isOpen=d.IsOpen),!j(a,b)&&b&&"cloud"!==b.val.type){_.remove(this.connected,function(a){return b.val.com_name===a.val.com_name});var e=k(this.connected,b);return e&&this.select(e.val),void c.add("NEW_BOARD_REMOVED",{board_name:b.val.name})}}.bind(this))},isDisconnected:function(a){return!a||!j(this.connected,a)},searchSameName:function(a){return k(this.connected,{name:a.name})},select:function(a,b){this.selected=a,b||"function"!=typeof this.updateMetaCallback||this.updateMetaCallback(a),"function"==typeof this.updateSerialCallback&&this.updateSerialCallback(a)},resetSelect:function(){this.selected=null},getBoardName:function(b){var c=b.name;return b.processors&&(b=b.processors[0]),b.fqbn&&b.fqbn.indexOf("yunmini")!==-1?c="network"===b.type?"Arduino Yn Mini, "+c:"Arduino Yn Mini":b.fqbn&&b.fqbn.indexOf("yun")!==-1&&(c="network"===b.type?"Arduino Yn, "+c:"Arduino Yn"),"arduino:avr:mega"===b.fqbn&&(c="Arduino/Genuino Mega 2560"),"serial"!==b.type||b.fqbn||(c="Board"),{name:a("translate")(c),info:c+" at "+b.com_name,port:b.com_name}},getBoardLabelForArchFilter:function(a){a||(a=q.selected);var b="";return a.fqbn&&a.fqbn.indexOf("yunmini")!==-1?b="Yn Mini":a.fqbn&&a.fqbn.indexOf("yun")!==-1?b="Yn":(b=q.getBoardName(a),b=b.name.replace("Arduino/Genuino ",""),b=b.replace("Arduino ",""),b=b.replace(" (Native USB Port)",""),b=b.replace(" (Programming Port)",""),b=b.replace("Robot Motor","Robot"),b=b.replace("Robot Control","Robot")),b},onBoardSelected:function(a,b){this.updateMetaCallback=a,this.updateSerialCallback=b},saveUnsupported:function(b){var c=_.findWhere(this.connected,function(a){return b.com_name===a.val.com_name});c.label="Board as "+a("translate")(b.name),c.second_label=a("translate")(b.name);var d=l(q.unsupportedMapping,{vid:b.vid,pid:b.pid});d?q.unsupportedMapping[d].name!==b.name&&(q.unsupportedMapping[d]=b):this.unsupportedMapping.push(b),f.set("unsupportedMapping",this.unsupportedMapping),this.replaceBoard(b.com_name,b,!0),this.select(b,!0)},replaceBoard:function(a,b,c){var d=_(this.connected).findIndex(function(b){return b.val.com_name===a}),e=angular.copy(this.connected);b.network=!1,b.type="serial";var f=this.getBoardName(b);c||(e[d].label=f.name,e[d].info=f.info),e[d].val=b,this.connected=e},isPortOpen:function(a){var b=j(this.connected,a);return!!b&&b.val.isOpen}};return q}]),ideapp.factory("bulkAction",function(){function a(a){var b="sketch"===a.type?"SKETCH":"FILE";return b}function b(a){f({sketchID:a.id}),e(a)}function c(a){var c=_.last(a.name.split(".")),g=d(j,{id:a.sketchID});"ino"===c?b(g):(f({id:a.sketchID}),e(a))}function d(a,b){var c=_.find(a,b);if(_.isUndefined(c))for(var e in a)if(c=_.isUndefined(a[e].files)?null:d(a[e].files,b))break;return c}function e(b,c){var d,e=a(b);switch(e){case"SKETCH":d={id:b.id};break;case"FILE":d={sketchID:b.sketchID,name:b.name}}switch(c){case"on":g(b,d);break;case"off":f(d);break;default:_.some(i,d)?f(d):g(b,d)}}function f(a){_.remove(i,a)}function g(a,b){i.push(a)}var h={},i=[];h.selection=i;var j;return h.isSelected=function(b){var c,d=a(b);switch(d){case"SKETCH":c={id:b.id};break;case"FILE":c=function(a){return a.id==b.sketchID||a.sketchID==b.sketchID&&a.name==b.name}}return _.some(i,c)},h.toggleItem=function(d,e){var f=a(d);switch(j=e,f){case"SKETCH":b(d);break;case"FILE":c(d)}},h.deselectAll=function(){i.length=0},h.getLastSelection=function(){return i[i.length-1]},h}),angular.module("arduino.auth",[]).config(["$httpProvider",function(a){function b(a,b){return{request:function(c){return b.token().then(function(a){return a&&a.token&&(c.headers.Authorization="Bearer "+a.token),c}).catch(function(){return a.resolve(c)})},responseError:function(c){return 401===c.status&&b.login(),a.reject(c)}}}b.$inject=["$q","AuthService"],a.interceptors.push(b)}]).service("AuthService",["$window",function(a){return a.oauth}]).factory("UserServiceFactory",["$http","$interval","$q",function(a,b,c){return function(d,e){function f(){h=a.get(j+"users/byID/me?scopes="+d).then(function(a){return g=a.data,k=null,g}).catch(function(a){return g=null,k=a,c.reject(a)}),h.finally(function(){for(var a in i)"function"==typeof i[a]&&i[a](g,k)})}d||(d="core, public");var g,h,i=[],j="https://auth.arduino.cc/v1/",k="NotInitialized";return f(),b(f,e),{profile:function(){return h?h:g?c.resolve(g):c.reject(k)},onProfile:function(a){this.profile().finally(function(){i.push(a),a(g,k)})}}}}]),ideapp.service("compiler",["$filter","$q","ace","builderAPI","devices","editor","messages","networkUploader","progress","sanity","serialUploader","sketches","verbose","Thing","daemon",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(b,c,d){m.reset(c),i.interrupting=!1,i.reset(c,a("translate")(b)+" "+d)}function q(a){for(var b={verbose:f.current.configuration.user.verbose,fqbn:a.metadata.cpu.fqbn,sketch:{name:a.name,ino:{name:a.ino.name,data:a.ino.data},metadata:{included_libs:a.metadata.included_libs},files:[]}},c=0;c<a.files.length;c++){var d=a.files[c];"code"!==d.type||d.primary||b.sketch.files.push({name:d.name,data:d.data})}if(a.metadata.included_libs&&(b.sketch.metadata.included_libs=a.metadata.included_libs),a.metadata.secrets&&0!==a.metadata.secrets.length){var e={mimetype:"text/x-c++src; charset=utf-8",content:'#include "arduino_secrets.h"\n'+a.ino.content};j.processFileData(e),b.sketch.ino.data=e.data,e.content="";for(var g=0;g<a.metadata.secrets.length;g++){var h=a.metadata.secrets[g];e.content+="#define "+h.name+' "'+h.value+'"\n'}j.processFileData(e),b.sketch.files.push({name:"arduino_secrets.h",data:e.data})}return b}function r(e){if(!e.metadata||0===Object.keys(e.metadata).length||!e.metadata.cpu||!e.metadata.cpu.fqbn){var h=a("translate")("ERROR_SELECT_TARGET");return i.end(e.id||e.path,h,"error"),b.reject(h)}var k=!1,n=!1;if(e.metadata.secrets&&0!==e.metadata.secrets.length){if(_.each(e.metadata.secrets,function(a){return a.name.length>36?(n=!0,!1):a.value?void 0:(k=!0,!1)}),k){var o=a("translate")("ERROR_SECRET_EMPTY");return i.end(e.id||e.path,o,"error"),b.reject(o)}if(n){var p=a("translate")("ERROR_SECRET_KEY_TOO_LONG");return i.end(e.id||e.path,p,"error"),b.reject(p)}}g.add("M_VERIFY_SKETCH",{sketch_name:e.name},g.SUCCESS);var r,s=f.current.configuration.user.save_on_build;if(s&&"sketch"===e.type)r=l.save(e);else{j.processFileData(e.ino);for(var t=0;t<e.files.length;t++)j.processFileData(e.files[t]);r=b.resolve(e)}var u=!1;return r.then(function(){if("sketch"===e.type||"example"===e.type)return l.load(e)}).then(function(){var a=q(e);if(u=_.findWhere(a.sketch.files,{name:"arduino_secrets.h"}),!i.interrupting&&i.inProgress)return d.do("compilations#start",{},a)}).then(function(a){if(!i.interrupting&&i.inProgress){if(m.addOutput({id:e.id||e.path,output_type:"out",output:a.data.stdout}),a.data.stderr){m.addOutput({id:e.id||e.path,output_type:"err",output:a.data.stderr});var d=m.getFirstError(e.id||e.path,u);if(d&&d.file){var f=_.findWhere(e.files,{name:d.file});f&&(f.error=!0)}if(c.highlightError(d.row),a.data.stderr.indexOf("error")!==-1)return b.reject(d.message)}if(a.data.stdout.indexOf("[error]")!==-1){var d=m.getFirstError(e.id||e.path,u);return b.reject(d.message)}return a}return b.reject("interrupted")}).catch(function(a){if(!i.interrupting&&i.inProgress){var d=m.getFirstError(e.id||e.path);return i.end(e.id||e.path,d.message,"error"),c.highlightError(d.row),b.reject(d.message?d.message:a)}return b.reject("interrupted")})}return{verify:function(c){var d,e,g=f.current.configuration.user.save_on_build;return g&&"sketch"===c.type?(d="SAVE_VERIFYING",e="SAVE_VERIFYING_DONE"):(d="VERIFYING",e="VERIFYING_DONE"),p(d,c.id||c.path,c.name),r(c).then(function(b){if("interrupted"!==b)return i.end(c.id||c.path,a("translate")(e)+" "+c.name,"success"),b}).catch(function(d){return d&&d.status&&(500===d.status||d.status===-1)?(console.error(d),i.end(c.id||c.path,a("translate")("COMPILATION_FAILED_ERROR"),"error")):d&&d.status&&412===d.status?i.end(c.id||c.path,a("translate")("MAXIMUM_NUMBER_OF_COMPILATIONS"),"error"):(i.end(c.id||c.path,d,"error"),
b.reject(d))})},upload:function(c){if(!c)return b.reject();var d,j,l=f.current.configuration.user.save_on_build;if(l?(d="SAVE_COMPILING",j="SAVE_COMPILING_DONE"):(d="COMPILING",j="COMPILING_DONE"),p(d,c.id||c.path,c.name),!c.metadata||!c.metadata.cpu||!c.metadata.cpu.type)return i.end(c.id||c.path,a("translate")("ERROR_NO_TARGET"),"error"),b.reject();var o;return"serial"===c.metadata.cpu.type&&(o=k),"network"===c.metadata.cpu.type&&(o=h),"cloud"===c.metadata.cpu.type&&(o=new n(c.metadata.cpu.com_name,e.client)),o?o.ready(c.metadata.cpu).then(function(){return b.all([r(c),o.setup(c.metadata.cpu)])}).then(function(b){i.update(c,a("translate")(j),"success"),f.currentProject.uploading=!0;var d=b[0].data;return o.upload(d,c.id,c.name,c.metadata.cpu,function(a){m.addOutput({id:f.currentProject.id||f.currentProject.path,output_type:"out",output:a})})}).then(function(){return f.currentProject.uploading=!1,i.end(c.id||c.path,a("translate")(j)+" "+c.name,"success"),!0}).catch(function(b){var d=b;f.currentProject.uploading=!1;var e=a("translate")(d);console.debug(b),"PLUGIN_DISCONNECTED"===b&&(g.add("PLUGIN_DISCONNECTED",{},g.CONNECTION_LOST,-1,!0),e=a("translate")("PLUGIN_DISCONNECTED_MSG"));var h=m.getFirstError(c.id||c.path);"ERROR: Arduino Connector not running on the target board"===h.message&&(e=a("translate")("ARDUINO_CONNECTOR_MISSING")),i.end(c.id||c.path,e,"error")}):(i.end(c.id||c.path,a("translate")("RESELECT_BOARD_ERROR"),"error"),b.reject())},killCurrent:function(){var b=f.currentProject.id||f.currentProject.path,c=i.items[b];i.interrupting=!0,f.currentProject.uploading&&(o.stopUpload(),f.currentProject.uploading=!1),m.reset(c.path),i.end(c.path,a("translate")("ABORTED"),"regular")}}}]),ideapp.service("serialUploader",["$q","$window","boards","daemon","SerialPortManager","editor","$timeout","Os","modal","$filter",function(a,b,c,d,e,f,g,h,i,j){return{ready:function(b){if(d.disconnected())return a.reject("PLUGIN_DISCONNECTED");if(c.isDisconnected(b))return _.findWhere(c.chromeOsOnlyCompile,{fqbn:b.fqbn})?a.reject("ERROR_CHROME_OS_TARGET"):a.reject("ERROR_NO_TARGET");for(var e,f=0;f<b.upload.length;f++)b.upload[f].flavour===b.flavour&&(e=b.upload[f].tool);return e?a.resolve():a.reject("RESELECT_BOARD_ERROR")},setup:function(b){var c=[];e.setUploadStatus(!0),c.push(e.close().catch(function(){return a.resolve()}));var f;for(f=0;f<b.upload.length&&b.upload[f].flavour!==b.flavour;f++);var g=d.perform("req_downloadtool",b.upload[f],function(a){h.isWin()&&"Installing drivers"===a&&i.show("generic",{title:j("translate")("INSTALLING_DRIVERS"),text:j("translate")("WINDOWS_INSTALLING_DRIVERS_WARNING")+'<div class="windows-install-drivers-screen"><img src="assetz/images/getting_started/windows_installing_drivers.png" alt="windows asking to install drivers"></div>'})});return"Intel:arc32:arduino_101"===b.fqbn&&(g=g.then(function(){d.perform("req_downloadtool",{tool:"dfu-util",tool_version:"0.9.0-arduino1",package:"arduino"})})),c.push(g),a.all(c)},upload:function(h,i,j,k,l){var m;for(m=0;m<k.upload.length&&k.upload[m].flavour!==k.flavour;m++);var n=k.upload[m].ext.substring(1);n&&h[n]||(console.debug("we received a faulty ext property, defaulting to .bin"),n="bin");var o={name:j+"."+n,data:h[n]},p={port:k.com_name,board:k.fqbn,network:!1},q={files:[o],commandline:k.upload[m]?k.upload[m].commandline:null,signature:k.upload[m]&&k.upload[m].options?k.upload[m].options.signature:null,options:k.upload[m].options};"arduino:samd:arduino_zero_edbg"!==p.board&&"arduino:samd:mzero_pro_bl_dbg"!==p.board||(q.extrafiles=[{filename:"arduino_zero.cfg",hex:b.btoa(b.unescape(b.encodeURIComponent("source [find interface/cmsis-dap.cfg]\r\n# chip name\r\nset CHIPNAME at91samd21g18\r\nset ENDIAN little\r\n# choose a port here\r\nset telnet_port 0\r\n\r\nsource [find target/at91samdXX.cfg]")))}]);var r=a.defer();return d.upload(p,q,function(a){if(a.done)if(f.currentProject.uploading=!1,e.setUploadStatus(!1),a.err)r.reject(a.err);else{var b=0,d=function(){c.isDisconnected(k)?b<11&&g(function(){d()},1e3):e.open(),b++};g(function(){d()},3e3),r.resolve()}else l(a.msg)}),r.promise}}}]),ideapp.service("networkUploader",["$q","$window","boards","daemon","localStorageService","modal","progress",function(a,b,c,d,e,f,g){function h(a,b,c,g){f.show("boardPassword",{cancel:!0,callback:function(h){b.auth_pass=h,e.set(a.name,h),d.upload(b,c,g),f.hide()},undo:function(){f.hide(),g({done:!0,err:"ABORTED_UPLOAD"})}})}return{ready:function(b){return d.disconnected()?a.reject("PLUGIN_DISCONNECTED"):c.isDisconnected(b)?_.findWhere(c.chromeOsOnlyCompile,{fqbn:b.fqbn})?a.reject("ERROR_CHROME_OS_TARGET"):a.reject("ERROR_NO_TARGET"):a.resolve()},setup:function(){return g.resetSecondTry(),a.resolve()},upload:function(b,c,f,i,j){var k="hex",l={name:f+"."+k,data:b[k]},m={port:i.com_name,board:i.fqbn,network:!0,auth_pass:e.get(i.name)},n={files:[l],options:{}},o=a.defer();return d.upload(m,n,function(a){a.done?(a.err&&"ABORTED_UPLOAD"===a.err&&o.reject(a.err),a.err&&!g.secondTryWithPasswordDone()?(g.tryWithPassword(),h(i,m,n,this[0])):a.err&&g.secondTryWithPasswordDone()?o.reject("WRONG_BOARD_PASSWORD"):o.resolve()):j(a.msg)}),o.promise}}}]),ideapp.factory("contextMenu",["$rootScope","$document",function(a,b){var c={};return c.visible=!1,c.preRender=!1,c.x=0,c.y=0,c.definition=[],c.show=function(a,b,d,e,f){return c.hide(),c.currFileRef&&c.currFileRef===e?void(c.currFileRef=null):(this.definition=d,this.visible=!0,this.visible&&$(".scrollable").addClass("scroll-disable"),this.x=a,this.y=b,void(e&&(c.currFileRef=e,c.currFileRef.ctx_menu=!0)))},c.hide=function(a){c.visible&&(c.visible=!1,c.currFileRef&&(c.currFileRef.ctx_menu=!1,a&&(c.currFileRef=null))),$(".scrollable").removeClass("scroll-disable")},b.on("click",function(b){b.button||(a.$$phase?c.hide(!0):a.$apply(function(){c.hide(!0)}))}),c}]),ideapp.service("daemon",["config","daemonAgent","daemonChromeApp","Os",function(a,b,c,d){var e=d.isChromeOs()||a.forceChromeAppDaemon;return e?c:b}]),ideapp.service("daemonAgent",["$http","$q","$interval","$location","$timeout","$window","deviceInfo","messages","$filter",function(a,b,c,d,e,f,g,h,i){function j(a,b){for(var c=a.split("."),d=b.split("."),e=0;e<3;e++){var f=Number(c[e]),g=Number(d[e]);if(f>g)return 1;if(g>f)return-1;if(!isNaN(f)&&isNaN(g))return 1;if(isNaN(f)&&!isNaN(g))return-1}return 0}function k(c,d,e){e.data&&(e=e.data);var f=b.defer();return e.version&&(j(e.version,A)>=0||e.version.indexOf("dev")!==-1)?b.resolve(e):(console.error("plugin version incompatible"),a.post(c+"://"+x+":"+d+"/update").then(function(a){return f.reject(a)}).catch(function(a){return f.reject(a)}),f.promise)}function l(c,d,f){var g=b.defer();return a.get(c+"://"+x+":"+d+"/info",{timeout:I}).then(function(a){k(c,d,a).then(function(){_.remove(h.items,{type:h.CONNECTION_LOST}),_.remove(h.items,{type:h.CONNECTION_LOST_MOBILE}),G=0,g.resolve(a.data)}).catch(function(){g.resolve(l(c,d,f))})}).catch(function(a){d++,G++,G%60===0&&(I*=2),d>z?(d=y,G>60&&(f=2500),e(function(){g.resolve(l(c,d,f))},f)):(20===G&&(h.add("PLUGIN_DISCONNECTED",{},h.CONNECTION_LOST,-1,!0),h.add("PLUGIN_DISCONNECTED_MOBILE",{},h.CONNECTION_LOST_MOBILE,-1,!0)),e(function(){g.resolve(l(c,d,f))},I))}),g.promise}function m(a,b){if(E&&E[a]&&E[a].length)for(var c in E[a])E[a][c](b)}function n(a){var b;try{b=angular.fromJson(a)}catch(a){return}return b&&b.Ports?o(b):b&&b.Cmd?p(b):b&&b.Error?void(b.Error.indexOf("could not find")!==-1&&F.close&&(F.close.reject(b.Error),F.close=null)):b&&b.Flash?q(b):b.Err?m("program",{done:!1,err:b.Err+"\n"}):b&&b.ProgrammerStatus?r(b):b&&b.DownloadStatus?s(b):b.D?m("serial",{data:b.D}):void 0}function o(a){a.Network?C=a.Ports:D=a.Ports,m("ports",_.flatten([C,D]))}function p(a){"Open"===a.Cmd?F.open&&F.open.resolve(!0):"OpenFail"===a.Cmd?F.open&&F.open.reject(a.Desc):"Close"===a.Cmd?F.close&&(F.close.resolve(!0),F.close=null):"CloseFail"===a.Cmd&&F.close&&(F.close.reject(a.Desc),F.close=null)}function q(a){B&&(B=!1,m("program",{done:!0,msg:a.Flash+"\n"}))}function r(a){B&&("Starting"===a.ProgrammerStatus?m("program",{done:!1,msg:"Programming with: "+a.Cmd+"\n"}):"Busy"===a.ProgrammerStatus?m("program",{done:!1,msg:a.Msg+"\n"}):"Error"===a.ProgrammerStatus?(B=!1,m("program",{done:!0,err:a.Msg+"\n"})):"Killed"===a.ProgrammerStatus?(B=!1,m("program",{done:!1,msg:"terminated by user\n"}),m("program",{done:!0,msg:"terminated by user\n"})):"Error 404 Not Found"===a.ProgrammerStatus&&(B=!1,m("program",{done:!0,err:a.Msg+"\n"})))}function s(a){"Pending"===a.DownloadStatus?m("download",a.Msg):"Success"===a.DownloadStatus?F.download&&F.download.resolve(a.Msg):F.download&&F.download.reject(a.Msg)}function t(){var a=this;if(!a.connected()){var f=b.defer();f.resolve(l(d.protocol(),8991,J)),f.promise.then(function(b){var f="wss";"http"===d.protocol()&&(f="ws");var g=b[f];v=io(g,{reconnection:!1,forceNew:!0}),e(function(){v.disconnected&&(h.add("PLUGIN_DISCONNECTED",{},h.CONNECTION_LOST,-1,!0),h.add("PLUGIN_DISCONNECTED_MOBILE",{},h.CONNECTION_LOST_MOBILE,-1,!0))},I),H=!0,v.on("connect",function(){v.emit("command","downloadtool windows-drivers latest arduino keep"),_.remove(h.items,{type:h.CONNECTION_LOST}),_.remove(h.items,{type:h.CONNECTION_LOST_MOBILE}),w||(w=c(function(){v.emit("command","list")},1500)),H=!1}),v.on("error",function(a){h.add("PLUGIN_DISCONNECTED",{},h.CONNECTION_LOST,-1,!0),h.add("PLUGIN_DISCONNECTED_MOBILE",{},h.CONNECTION_LOST_MOBILE,-1,!0),console.error(a)}),v.on("disconnect",function(b){console.debug(b),e(a.connect.bind(a),0),H=!0}),v.on("message",n)})}}function u(b,c){l("http",y,J).then(function(d){var e={process:b,action:"restart",url:c};a.post(d.http+"/killbrowser",e)})}var v,w,x="localhost",y=8989,z=9e3,A="1.1.60",B=!1,C=[],D=[],E={ports:[],program:[],serial:[],download:[]},F={},G=0,H=!0,I=150;"safari"===g.browser.getBrowser()&&(I=600);var J=300;return{connect:t,findService:l,restartBrowser:u,perform:function(a,c,d){var e=b.defer(),f="keep";return v?B&&"req_downloadtool"!==a?(e.reject(!1),e.promise):("req_serial_monitor_open"===a?v.emit("command","open "+c.com_name+" "+c.baudrate+" timed",function(){F.open=e}):"req_serial_monitor_write"===a?v.emit("command","send "+c.com_name+" "+c.data,function(){e.resolve(!0)}):"req_serial_monitor_close"===a?v.emit("command","close "+c.com_name,function(){return F.close?F.close:void(F.close=e)}):"req_downloadtool"===a&&(d&&(E.download=[d]),c.tool?v.emit("command","downloadtool "+c.tool+" "+c.tool_version+" "+c.package+" "+f,function(){F.download=e}):(e.resolve("no need to download a nonexistent tool"),F.download=null)),e.promise):(e.reject(),e.promise)},onPortsUpdate:function(a){E.ports.push(a)},onSerialData:function(a){E.serial.push(a)},upload:function(b,c,e){function f(){var a=j.name.split("."),b=i("translate")("M_UPLOAD_SKETCH",{sketch_name:a[0]});void 0===_.find(h.items,{text:b})&&h.add(b,h.SUCCESS)}function g(a){m("program",{done:!0,err:a})}if(B=!0,E.program=[e],0===c.files.length)return B=!1,void m("program",{done:!0,err:"You need at least one file to upload"});var j=c.files[0];j.name=j.name.split("/"),j.name=j.name[j.name.length-1];for(var k={board:b.board,port:b.port,commandline:c.commandline,signature:c.signature,hex:j.data,filename:j.name,extra:{auth:{username:b.auth_user,password:b.auth_pass,private_key:b.auth_key,port:b.auth_port},wait_for_upload_port:"true"===c.options.wait_for_upload_port,use_1200bps_touch:"true"===c.options.use_1200bps_touch,network:b.network,ssh:b.ssh,params_verbose:c.options.param_verbose,params_quiet:c.options.param_quiet,verbose:c.options.verbose},extrafiles:c.extrafiles||[]},n=1;n<c.files.length;n++)k.extrafiles.push({filename:c.files[n].name,hex:c.files[n].data});l(d.protocol(),y,J).then(function(b){a.post(b[d.protocol()]+"/upload",k).then(f).catch(g)})},stopUpload:function(){B=!1,v.emit("command","killprogrammer")},disconnected:function(){return H},connected:function(){return!H},firefoxCert:function(a){return a+"/certificate.crt"},checkHttps:function(b){return a.get(b+"/info",{timeout:100})},stopDaemon:function(b){return a.post(b+"/pause")}}}]),ideapp.service("daemonChromeApp",["$q","$interval","config","messages","modal","settings",function(a,b,c,d,e,f){function g(a,c){if(c.version){var g=l.indexOf(a);if(!(m===-1||g<m))return a.onMessage.removeListener(),a.onDisconnect.removeListener(),r++,void a.disconnect();j&&(b.cancel(j),j=void 0),m>-1&&(l[m].onMessage.removeListener(),l[m].onDisconnect.removeListener(),r++,l[m].disconnect()),m=g,a.onDisconnect.addListener(h),_.remove(d.items,{type:d.CONNECTION_LOST}),_.remove(d.items,{type:d.CONNECTION_LOST_MOBILE}),j||(j=b(function(){n||l[m].postMessage({command:"listPorts"})},1500)),q=!1}else if(c.supportedBoards)f.boardsFqbnWhitelist=c.supportedBoards;else if(c.ports){var k=c.ports.map(function(a){return{Name:a.name,SerialNumber:a.serialNumber,IsOpen:a.isOpen,VendorID:a.vendorId,ProductID:a.productId}});i("ports",k)}else if(c.uploadStatus)if("success"===c.uploadStatus){var o=c.filename.split(".");d.add("M_UPLOAD_SKETCH",{sketch_name:o[0]},d.SUCCESS),n=!1,i("program",{done:!0})}else if("error"===c.uploadStatus){n=!1;var s=c.message;i("program",{done:!0,err:s+"\n"}),"Free trial expired"===s&&e.show("freeTrialExpired",{})}else"message"===c.uploadStatus&&i("program",{done:!1,msg:c.message+"\n"});else if(c.portOpenStatus){if("success"===c.portOpenStatus){if(p.open.length){var t=p.open.shift();t.resolve(!0)}}else if(p.open.length){var t=p.open.shift();t.reject(c.message)}}else if(c.portCloseStatus){if("success"===c.portCloseStatus){if(p.close.length){var t=p.close.shift();t.resolve(!0)}}else if(p.close.length){var t=p.close.shift();t.reject(c.message)}}else c.serialData&&i("serial",{data:c.serialData})}function h(){r++,r===k.length&&(d.add("CHROMEAPP_DISCONNECTED",{},d.CONNECTION_LOST,-1,!0),m=-1,q=!0,j&&(b.cancel(j),j=void 0))}function i(a,b){if(o&&o[a]&&o[a].length)for(var c in o[a])o[a][c](b)}var j,k=c.chromeExtensionIds,l=[],m=-1,n=!1,o={ports:[],program:[],serial:[]},p={open:[],close:[]},q=!0,r=0;return{connect:function(){if(m===-1||q){r=0;for(var a=0;a<k.length;a++)l[a]=chrome.runtime.connect(k[a]),l[a].onMessage.addListener(g.bind(this,l[a])),l[a].onDisconnect.addListener(h)}},perform:function(b,c,d){var e=a.defer();return n?(e.reject(),e.promise):("req_downloadtool"===b?e.resolve():"req_serial_monitor_open"===b?(l[m].postMessage({command:"openPort",data:{name:c.com_name,baudrate:c.baudrate}}),p.open.push(e)):"req_serial_monitor_close"===b?(l[m].postMessage({command:"closePort",data:{name:c.com_name}}),p.close.push(e)):"req_serial_monitor_write"===b&&l[m].postMessage({command:"writePort",data:{name:c.com_name,data:c.data}}),e.promise)},onPortsUpdate:function(a){o.ports.push(a)},onSerialData:function(a){o.serial.push(a)},upload:function(a,b,c){if(n=!0,o.program=[c],0===b.files.length)return n=!1,void i("program",{done:!0,err:"You need at least one file to upload"});var d=b.files[0];d.name=d.name.split("/"),d.name=d.name[d.name.length-1],l[m].postMessage({command:"upload",data:{filename:d.name,data:d.data,board:a.board,port:a.port,commandline:b.commandline}})},stopUpload:function(){},disconnected:function(){return q}}}]),ideapp.service("deviceInfo",["$document","$window",function(a,b){var c={dimensionType:function(){var b=a.width(),c=[["480","tiny"],["750","small"],["960","middle"]];for(var d in c)if(b<c[d][0])return c[d][1];return"big"}},d={cachedBrowser:void 0,_detectBrowser:function(){var a=b.navigator.userAgent,c={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,explorer:/msie/i};if(/edge/i.test(a))return"edge";for(var d in c)if(c[d].test(a))return d;return"unknown"},getBrowser:function(){return this.cachedBrowser||(this.cachedBrowser=this._detectBrowser()),this.cachedBrowser}},e=function(){var a=(b.navigator.userAgent||b.navigator.vendor).toLowerCase();return/ip(ad|hone|od)/.test(a)?"iOS":a.indexOf("android")!==-1&&"Android"},f={screen:c,browser:d,isMobile:e};return f}]),ideapp.service("devices",["devicesAPI","Things",function(a,b){return{url:"",client:null,connect:function(){return a.do("devices_v1#connect",null,null).then(function(a){return this.url=a.data.url,this.client=new b(a.data.signed_websocket),this.client}.bind(this))},list:function(){return a.do("devices_v1#list",null,null).then(function(a){return a.data})},create:function(){return a.do("devices_v1#create",null,{}).then(function(a){return a.data})},update:function(b,c){return a.do("devices_v1#update",{params:{id:b}},{name:c}).then(function(a){return a.data})},image:function(b,c){return a.do("devices_v1#image",{params:{id:b},responseType:"blob"},c).then(function(a){return a.data})},delete:function(b){return a.do("devices_v1#delete",{params:{id:b}}).then(function(a){return a.data})}}}]),ideapp.factory("Things",["$q","$window",function(a,b){return function(c){var d={},e=new b.Paho.MQTT.Client(c,"browser-"+(new Date).getTime());e.onMessageArrived=function(a){var b=d[a.destinationName];if(b)for(var c=0;c<b.length;c++)b[c](a.payloadString)},e.onConnectionLost=function(a){console.error(a)};var f=a.defer(),g={useSSL:!0,timeout:3,mqttVersion:4,onSuccess:function(){f.resolve()},onFailure:function(a){f.reject(a)}};return e.connect(g),{send:function(a,b,c){b="$aws/things/"+a+b,f.promise.then(function(){e.send(b,c)},function(a){throw a})},subscribe:function(a,b,c,g){b="$aws/things/"+a+b,console.debug(b),d[b]||(d[b]=[]);var h=d[b].push(c);return f.promise.then(function(){e.subscribe(b)}).catch(function(a){g&&g(a)}),{remove:function(){d[b].splice(h-1,1)}}},unsubscribe:function(a,b,c,d){b="$aws/things/"+a+b,console.debug(b),f.promise.then(function(){e.unsubscribe(b,{onSuccess:c,onFailure:function(a){d&&d(a)}})})}}}}]),ideapp.factory("Thing",["$interval","$q","AuthService","builderAPI",function(a,b,c,d){function e(e,f){var g={status:null,online:!1,send:function(a,b){return f.send(e,a,b)},subscribe:function(a,b,c){return f.subscribe(e,a,b,c)},unsubscribe:function(a,b,c){return f.unsubscribe(e,a,b,c)},ready:function(){return this.online?b.resolve():b.reject("DEVICE_OFFLINE")},setup:function(){return b.resolve()},action:function(a,c){var d=b.defer();return this.subscribe("/sketch",function(a){a.indexOf("ERROR")===-1?d.resolve(a):d.reject(a)}),this.send("/sketch/post",JSON.stringify({action:c,id:a})),d.promise},upload:function(a,e,f,g,h){var i=b.defer(),j=this.subscribe("/upload",function(a){h(a),a.indexOf("ERROR")===-1?(j.remove(),i.resolve(a)):(j.remove(),i.reject(a))});return c.token().then(function(b){this.send("/upload/post",JSON.stringify({token:b.token,url:d.endpoint+a.bin_url,name:f,id:e}))}.bind(this)),i.promise}},h=0;return a(function(){h>3?g.online=!1:h+=1},5e3),f.subscribe(e,"/status",function(a){g.online=!0,h=0;try{a=a.replace("INFO: ",""),g.status=JSON.parse(a)}catch(a){g.status=null}}),f.send(e,"/status/post",""),a(function(){f.send(e,"/status/post","")},5e3),g}var f={};return function(a,b){var c=f[a];return c||(c=e(a,b)),f[a]=c,c}}]),ideapp.factory("editor",["$rootScope","$state","$stateParams","$q","sanity","boards","sketches","examples","libraries","preferences","toggler","CreateUserService",function(a,b,c,d,e,f,g,h,i,j,k,l){var m={};m.projects=e.rootTree(),m.currentProject={},m.currentIsSourceCode=!1,m.setContext=function(a){m.current=a},m.setFirstTabAvailable=function(a,b){b||(b=m.currentProject);var c=_.where(b.files,{unsaved:!0});c.length||(b.unsaved=!1),a.active=!1,b.currentFile===a&&m.setCurrentFile(b.files[0],b)},m.getContainerArray=function(a,b,c){for(var d=0;d<b.length;++d){var e=b[d];a.href&&a.href===e.href||"folder"===e.type&&a.path===e.path?c.files=b:e.files&&m.getContainerArray(a,e.files,c)}},m.insertLibCode=function(b){var c=m.currentProject;if("sketch"===c.type||"example"===c.type){var d=m.getPrimaryTab(c);g.setAsUnsaved(c,d),m.setCurrentFile(d,c),a.$emit("insertLibCode",b)}},m.removeLibCode=function(b){var c=m.currentProject;if("sketch"===c.type||"example"===c.type){var d=m.getPrimaryTab(c);g.setAsUnsaved(c,d),m.setCurrentFile(d,c),a.$emit("removeLibCode",b)}},m.addTab=function(a,d,e,f){return d.files.push(a),a.path=d.path+this.current.sep+a.name,a.sketchID=d.id,a.parent_type="sketch",e?g.setAsSaved(d,a):(f||b.go("editor.user.sketch.file",{uid:c.uid,id:d.id,filename:a.name}),g.setAsUnsaved(d,a)),"example"!==d.type&&(m.current.configuration.user.autosave||e)&&g.save(d),a},m.addTabToCurrent=function(a,b,c){return this.addTab(a,this.currentProject,b,c)},m.addFileToTarget=function(a,b,c,d){var f=e.defaultFile(a,b,c);m.addTab(f,d)},m.setCurrentProject=function(a){if(m.currentProject&&(m.currentProject.active=!1,m.currentProject.currentFile&&(m.currentProject.currentFile.active=!1)),m.currentProject=a,a.active=!0,a.currentFile||m.setCurrentFile(m.getPrimaryTab(a),a),a.metadata&&a.metadata.cpu)f.select(a.metadata.cpu,!0);else{var b=_.findWhere(f.connected,function(a){return"cloud"===a.val.type});b||(b=_.findWhere(f.connected,function(a){return"serial"===a.val.type})),b||(b=_.findWhere(f.connected,function(a){return"network"===a.val.type})),f.selected&&!f.isDisconnected(f.selected)?f.select(f.selected):b&&f.select(b.val)}k.closeMobile()},m.getPrimaryTab=function(a){var b;return angular.forEach(a.files,function(a){a.primary&&(b=a)}),b};var n=function(a){"secret"!==a.type&&("sketch"===a.parent_type&&g.getSketchFile(a),"example"!==a.parent_type&&a.parent_type||h.getFile(a))};return m.setCurrentFile=function(a,b){b.currentFile&&(b.currentFile.active=!1),b.currentFile=a,a.undo||(a.undo=[]),a.content?a.loaded=!0:n(a),a.mimetype&&(this.currentIsSourceCode=0===a.mimetype.indexOf("text")),a.active=!0},m.savePreferences=function(a){var b=d.defer();return j.save(a).then(function(){b.resolve()},function(){b.reject()}),b.promise},m.loadLibraries=function(){var a=d.defer();if(h.data.tree.files.length>0)return a.resolve(h.data),a.promise;var b=[i.fetchBuiltin(),l.getUserInfo().then(function(a){return i.fetchCustom(a.id)}),i.fetchContributed()],c=function(a,b){return a.name<b.name?-1:a.name>b.name?1:0};return d.all(b).then(function(a){i.data.builtin=a[0].sort(c),i.data.custom=a[1].sort(c),i.data.contributed=_.map(a[2],function(a){return a.contributed=!0,a}).sort(c),i.data.all=i.data.builtin.concat(i.data.custom).concat(i.data.contributed);var b=angular.copy(i.data.builtin),d=_.remove(b,function(a){return a.architectures.indexOf("mraa")!==-1});return i.data.mraa=d.concat(b),h.fetch()})},m}]),ideapp.service("examples",["$q","builderAPI","createAPI","sanity","_",function(a,b,c,d,e){return{data:{tree:{name:"__root",open:!0,files:[]},folders:[]},fetch:function(){return b.do("examples#list",{params:{type:"Arduino",maintainer:"Arduino"}}).then(function(a){return d.prepare(this.data.tree,a.data,"example",!0),this.data}.bind(this))},getFile:function(e){if("secret"===e.type)return a.resolve(e);var f;return f=0===e.href.indexOf("/builder")?b:c,f.do("files#show",{href:e.href}).then(function(a){return e.data=a.data.data,d.processFileContent(e),e.loaded=!0,e})},load:function(b,c){var f=e.map(b.files,function(a){if(d.processFileData(a),a.primary&&(b.ino=a),c||!a.unsaved)return a.unsaved=!1,this.getFile(a)}.bind(this));return a.all(f)}}}]),ideapp.factory("keyboard",["$rootScope","$document",function(a,b){var c={};c.ESC="esc",c.SAVE="save",c.SAVE_AS="save_as",c.INFO="info",c.VERIFY="verify",c.UPLOAD="upload",c.DUPLICATE="duplicate",c.SERIAL="serial",c.PREFERENCE="preference",c.SHORTCUTS="shortcuts",c.NEW_TAB="new_tab";var d={C_83:c.SAVE,C_68:c.DUPLICATE,C_73:c.INFO,C_85:c.UPLOAD,C_69:c.VERIFY,C_77:c.SERIAL,C_188:c.PREFERENCE,CS_78:c.NEW_TAB,CS_83:c.SAVE_AS,AS_220:c.SHORTCUTS};return b.bind("keydown",function(b){var e=b.keyCode+"";27===b.keyCode&&(a.$emit("keyShortCut",{intent:c.ESC}),b.preventDefault(),b.stopImmediatePropagation()),(b.ctrlKey||b.metaKey)&&(e=b.shiftKey?"CS_"+e:"C_"+e),b.altKey&&(e=b.shiftKey?"AS_"+e:"A_"+e),d[e]&&(a.$emit("keyShortCut",{intent:d[e]}),b.preventDefault(),b.stopImmediatePropagation())}),c}]),ideapp.service("importer",["$q","_","sanity","sketches","libraries","$filter","CreateUserService",function(a,b,c,d,e,f,g){function h(e){var f={},g=[];for(var h in e){var i=e[h];if(!i.dir){var j=i.name.split("."),k=j[j.length-1];j=i.name.split("/");var l=j[0];l&&b.contains(["arduino","sketchbook"],l.toLowerCase())&&j.shift();var m=j.pop(),n=j.join("/"),o=j.pop(),p=j.join("/");if(n.indexOf("__MACOSX")===-1&&n.indexOf(".DS_Store")===-1&&n.indexOf("libraries")===-1)if(f[n]||(f[n]={name:o,public:!0,files:[],folder:p}),"sketch.json"===m)g.push(i.async("text").then(function(a){return this.metadata=JSON.parse(a),a}.bind(f[n])));else if("ino"!==k||m!==o+".ino"&&!b.isUndefined(o)){i.type="";var q=c.getFileType(i),r={name:m,mimetype:q||"application/octet-stream",unsaved:!0};g.push(i.async("base64").then(function(a){return this.data=a,a}.bind(r))),f[n].files.push(r)}else f[n].ino={name:m,unsaved:!0},f[n].name=m.substring(0,m.lastIndexOf(".")),g.push(i.async("base64").then(function(a){return this.data=a,a}.bind(f[n].ino)))}}return a.all(g).then(function(){var b=[],e={success:[],errors:[]};for(var g in f)f[g].ino&&b.push(d.save(f[g],!0).then(function(a){return d.list.push(a),e.success.push(a),a}).catch(function(a){return e.errors.push(a),a}));return a.all(b).then(function(){return c.prepare(d.tree,d.list),e})}).catch(function(b){return a.reject(b)})}function i(a,c){var d=a.files,e=b.first(c.split("."));return e.lastIndexOf("-master")!==-1&&(e=e.substr(0,e.lastIndexOf("-master"))),j(d,e)}function j(c,d){c=b.pick(c,n);var e=l(c);e=m(e);var f=[];return b.forEach(e,function(a){f.push(p(a,c,d))}),a.all(f).then(k)}function k(c,d){var f=[],g={success:[],errors:[]};return b.forEach(c,function(a){f.push(e.addCustom(a,d).then(function(a){g.success.push(a)},function(a){g.errors.push(a)}))}),a.all(f).then(function(){return g})}function l(a){var c=[];for(var d in a){var e=a[d],f=t(e.name),g=f.paths,h=f.getExt();if("h"===h){var i;i=o(e.name)?b.take(g,b.lastIndexOf(g,"examples")):b.include(g,"src")?b.take(g,b.lastIndexOf(g,"src")):g;var j=i.join("/");b.include(c,j)||c.push(j)}}return c}function m(a){var c=[];for(var d in a){var e=a[d],f=e.split("/");c.push({libPath:e,levels:f.length})}var g=b.min(c,"levels").levels,h=b.pluck(b.filter(c,function(a){return a.levels===g}),"libPath");return h}function n(a,c,d){if(a.dir)return!1;c||(c=a.name.split("/"));var e=["__MACOSX",".DS_Store",".git"];d&&(e=e.concat(d));for(var f in e)if(b.include(c,e[f]))return!1;return!0}function o(a){return b.include(a.split("/"),"examples")}function p(c,d,e){var f=b.clone(B,!0),g=b.last(c.split("/"));g.lastIndexOf("-master")!==-1&&(g=g.substr(0,g.lastIndexOf("-master"))),g||(g=e);var h=b.pick(d,function(a,b){return b.startsWith(c)}),i={},j={};b.forEach(h,function(a,b){o(b)?i[b]=a:j[b]=a});var k={};return k.examples=q(i,g).then(function(a){f.examples=a}),k.files=r(j,c).then(function(a){f.files=a}),f.name=g,a.all(k).then(function(){return f})}function q(c,d){var e=[];return b.forEach(c,function(a){var b=a.name.substring(a.name.indexOf("examples/")+9);e.push(s(a,b))}),a.all(e).then(function(a){var c=[],e=[];return b.forEach(a,function(a){var c=t(a.name),f=c.getExt();if("ino"===f||"pde"===f){var g=c.paths,h=c.path,i=d+g.slice(0,-1).join("/"),j=b.last(g),k={path:h,folder:i,name:j},l=!0;b.forEach(e,function(a,b){var c=a.path;h.indexOf(c+"/")!==-1?l=!1:c.startsWith(h)&&(e[b]=k,l=!1)}),l&&e.push(k)}}),b.forEach(a,function(a){var d=t(a.name),f=d.path,g=b.find(e,function(a){return f===a.path});if(!b.isUndefined(g)){var h=g.path,i=g.name,j=g.folder,k=b.find(c,{name:i,folder:j});b.isUndefined(k)&&(k=b.clone(C,!0),k.name=i,k.folder=j,k.name&&c.push(k));var l=d.getExt(),m=d.getNoExt();"ino"!==l&&"pde"!==l||m!==i.toLowerCase()?(a.name=a.name.slice(h.length+1),k.files.push(a)):(a.name=i+".ino",k.ino=a)}}),c})}function r(c,d){var e=[];return b.forEach(c,function(a,b){var c=b.substring(d.length);e.push(s(a,c))}),a.all(e).then(function(a){return a}).catch(function(a){return a})}function s(a,c){return a.async("base64").then(function(a){var d=b.clone(D,!0);return"/"!==c[0]&&(c="/"+c),d.data=a,d.name=c,d})}function t(a){var c,d,e,f,g;return c=a.split("/"),g=c.pop(),e=b.last(g.split(".")),f=g.slice(0,g.lastIndexOf(".")).toLowerCase(),d=c.join("/"),{paths:c,path:d,ext:e,noExt:f,filename:g,getExt:function(a){return angular.isUndefined(a)&&(a=!0),a?this.ext.toLowerCase():this.ext},getNoExt:function(a){return angular.isUndefined(a)&&(a=!0),a?this.noExt.toLowerCase():this.noExt}}}function u(a){var b=a.files;return v(b)}function v(a){a=b.pick(a,function(a){return n(a)});var c=[];b.each(a,function(a){c.push(t(a.name))});var d=w(c),e=d?d+"/libraries":"libraries",f=!1;for(var g in c)if(Object.prototype.hasOwnProperty.call(c,g)){var h=c[g];if(h.path.startsWith(e)){f=!0;break}}if(f)return y(a,d),z("sketchbook",a);var i;for(var j in c)if(Object.prototype.hasOwnProperty.call(c,j)){var k=c[j],l=k.getExt();if("ino"===l||"pde"===l){i=c[j];break}}return b.isUndefined(i)?z("library",a):x(c,i)?z("library",a):(y(a,d),z("sketchbook",a))}function w(a){var c=a[0].paths[0];b.isUndefined(c)&&(c="");for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)){var e=a[d].paths[0];if(e!==c){c="";break}}return c}function x(a,c){if(b.contains(c.paths,"examples")){var d=c.path.substring(0,c.path.lastIndexOf("examples")-1);if(b.some(a,function(a){return a.path.startsWith(d+"/src")})||b.some(a,function(a){return"h"===a.getExt()&&a.path===d}))return!0}return!1}function y(a,c){var d=c.length;d=d?d+1:0,b.each(a,function(b){var c=b.name;b.name=b.name.substring(d),delete a[c],a[b.name]=b})}function z(a,b){switch(a){case"sketchbook":return A(b);default:return j(b).then(function(a){return{sketch:{errors:[],success:[]},library:a}})}}function A(c){c=b.pick(c,function(a){return n(a)});var d={},e={};b.each(c,function(a,b){var c=t(a.name);c.path.startsWith("libraries")?e[b]=a:d[b]=a});var f=[];return f.push(h(d)),f.push(j(e)),a.all(f).then(function(a){var b={sketch:a[0],library:a[1]};return b})}var B={architectures:["*"],code:"",examples:[],sketches_number:NaN,files:[],id:"",name:"",sentence:"",types:[],url:""},C={name:"",files:[],ino:{},folder:""},D={name:"",data:""};return{libraries:function(b){var c=g.userStats();return b.size>c.availableSpace?a.reject("SIZE_LIMIT_REACHED"):JSZip.loadAsync(b.content,{base64:!0}).then(function(a){return i(a,b.name)})},sketchBook:function(b){var c=g.userStats();return b.size>c.availableSpace?a.reject("SIZE_LIMIT_REACHED"):JSZip.loadAsync(b.content,{base64:!0}).then(u)},libraryFromPayloads:function(a,b){return k(a,b)}}}]),ideapp.service("libraries",["builderAPI","createAPI","examples","sanity","$q","CreateUserService",function(a,b,c,d,e,f){var g,h,i={},j=function(a,b){return _.find(b.all,{id:a})},k=function(a,b){return _.remove(i.data.all,{id:a}),_.remove(b,{id:a})},l=function(a,b){return _.remove(b.all,{name:a}),_.remove(b.custom,{name:a})},m=function(a,b){if(a.examples&&a.examples.length){_.map(a.examples,function(c){c.architectures=a.architectures,"customLibraries#show"===b&&(c.types.push("custom"),c.libraryID=a.id)});var e=d.prepare(c.data.tree,a.examples,"example",!0,"customLibraries#show"===b);e[0].library_name=a.name,a.examples=e[0].files}};i.loadWithExamples=function(a,b){if("string"==typeof a){var c=a;if(a=j(c,i.data),!a)return e.reject("Can't find library with id "+c)}return i.load(a,b).then(function(c){return m(c.data,b),angular.copy(c.data,a),a}).catch(function(){console.log("Can't fetch library with id "+a.id)})},i.data={builtin:[],custom:[],contributed:[],all:[]},i.libraryManager={list:[]},i.fetchContributedList=function(){return a.do("libraries#list",{params:{without_type:"Arduino"}}).then(function(a){this.libraryManager.list=a.data}.bind(this))},i.fetchBuiltin=function(){return a.do("libraries#list",{params:{type:"Arduino"}}).then(function(a){var b=[];for(var c in a.data)b.push(this.loadWithExamples(a.data[c],"libraries#show"));return e.all(b).then(function(){return a.data}.bind(this),function(){return a.data}.bind(this))}.bind(this))},i.fetchCustom=function(a){return b.do("libraries#search",{params:{owner:a}}).then(function(a){var b=[];for(var c in a.data.libraries)a.data.libraries[c].type="custom",
b.push(this.loadWithExamples(a.data.libraries[c],"customLibraries#show"));return e.all(b).then(function(){return a.data.libraries}.bind(this),function(){return a.data.libraries}.bind(this))}.bind(this))},i.fetchContributed=function(){return a.do("pinnedLibraries#list").then(function(a){var b=[];for(var c in a.data)b.push(this.loadWithExamples(a.data[c],"libraries#show"));return e.all(b).then(function(){return a.data}.bind(this),function(){return a.data}.bind(this))}.bind(this))},i.addCustom=function(a,d){var e={params:{force:!1}};return d&&(e.params.force=!0),g(),b.do("libraries#create",e,a).then(function(b){return a.href||l(b.data.name,this.data),c.data.tree.files=_.reject(c.data.tree.files,{library_name:b.data.name,custom:!0}),m(b.data,"customLibraries#show"),this.data.custom.push(b.data),this.data.all.push(b.data),h=b.data.id,f.refreshStats(),b}.bind(this))},i.editCustom=function(a){return b.do("libraries#edit",{href:a.href},a).then(function(a){console.log(a)}.bind(this))},i.load=function(c,d){return d||(d="libraries#show"),"customLibraries#show"===d?b.do("libraries#show",{params:{id:c.id}}):a.do(d,{params:{id:c.id}})},i.addContributed=function(b){return a.do("pinnedLibraries#add",{params:{id:b.id}}).then(function(){return this.load(b).then(function(a){return angular.copy(a.data,b),b.contributed=!0,m(b),this.data.contributed.push(b),this.data.all.push(b),h=b.id,a}.bind(this))}.bind(this))},i.removeLibrary=function(d){var e,g,h=this.data.custom;return d.category&&d.types.length?(h=this.data.contributed,e=a.do("pinnedLibraries#remove",{params:{id:d.id}})):(e=b.do("libraries#delete",{params:{id:d.id}}),g=!0),e.then(function(){f.refreshStats(),k(d.id,h),c.data.tree.files=_.reject(c.data.tree.files,{library_name:d.name,custom:g})}.bind(this))};var n=function(c,d){if("folder"===c.type)for(var e=0;e<c.files.length;e++)n(c.files[e],d);else for(var f=0;f<c.files.length;f++){var g=b;0===c.files[f].href.indexOf("/builder")&&(g=a),d.push(g.do("files#show",{href:c.files[f].href}))}};return i.export=function(c){for(var d=[],f=new JSZip,g=0;g<c.files.length;g++){var h=c.files[g],i=b;0===h.href.indexOf("/builder")&&(i=a),d.push(i.do("files#show",{href:h.href}))}if(c.examples)for(var j=0;j<c.examples.length;j++)n(c.examples[j],d);return e.all(d).then(function(a){for(var b in a){var d=a[b].data,e=d.path.split("/");e.pop(),0===c.types.length&&e.splice(0,3),f.folder(c.name+"/"+e.join("/")).file(d.name,d.data,{base64:!0})}return f.generateAsync({type:"blob"})}).then(function(a){saveAs(a,c.name+".zip")})},i.getLastAdded=function(){return h},i.parseSemVer=function(a){var b=a.split("-");return b.slice(-3).join(".")},i.setForceCustomTabCall=function(a){g=a},i}]),function(){"use strict";function a(){function a(){g=!1}function b(){g=!0}function c(){return g}function d(a){f=a}function e(){return f}return this.clean=a,this.error=b,this.hasError=c,this.setMessage=d,this.getMessage=e,this;var f,g}angular.module("ideapp").service("LoginError",a)}(),ideapp.factory("messages",["$timeout","$rootScope","$filter",function(a,b,c){var d={};return d.SUCCESS="success",d.ERROR="error",d.SERVER_ISSUE="server-issue",d.CONNECTION_LOST="connection-lost",d.CONNECTION_LOST_MOBILE="connection-lost-mobile",d.items=[],d.add=function(e,f,g,h,i){g=g||"success",h=h||5e3,f=f||{};var j={text:c("translate")(e,f),type:g,active:!0,dismissable:i};b.$evalAsync(function(){d.items.push(j)}),h!==-1&&a(function(){var a=d.items.indexOf(j);d.items.splice(a,1)},h)},d}]),ideapp.service("boardMetadata",["editor","sketches","messages","modal","$filter","boards",function(a,b,c,d,e,f){var g={get:function(){return a.currentProject.metadata},set:function(e){var g=a.currentProject;g.metadata||(g.metadata={}),g.metadata.cpu=e;var h=f.getBoardName(e);"sketch"===g.type&&b.save(g).then(function(){c.add("M_SKETCH_SAVE_BOARD_SUCCESS",{save_sketch_name:g.name,board_name:h.name},c.SUCCESS)}).catch(function(a){a.status&&412===a.status?d.show("usedSpace",{}):c.add("M_SKETCH_SAVE_ERROR",{save_sketch_name:g.name},c.ERROR)})},writeSecrets:function(){a.currentProject.metadata||(a.currentProject.metadata={});var b=a.currentProject.metadata,c=[],d=!1;return _.each(a.currentProject.files,function(a){if(a.content){var b=a.content.match(/SECRET_[A-Z0-9_]+/g);_.each(b,function(a){_.findWhere(c,{name:a})||c.push({name:a,value:null})})}}),_.each(c,function(a){var c=_.findWhere(b.secrets,{name:a.name});c&&(d=!0,a.value=c.value)}),b.secrets=c,d}};return g}]),ideapp.factory("modal",["$rootScope","$timeout","$http","$templateCache","localStorageService",function(a,b,c,d,e){var f={},g={visibility:!1,view:null,params:{callback:function(){},callback_close:function(){}},focus:!1,close_delay:0,getView:function(){return this.view?"views/modals/partials/"+this.view+".html":null}};return f.alert=_.cloneDeep(g),f.show=function(c,d){if(d.skip){var f=e.get(d.skip);if("true"===f)return d.callback(d)}this.alert.view=c;for(var g in this.alert.params)_.isUndefined(d[g])&&(d[g]=this.alert.params[g]);this.alert.params=d,b(function(){a.$emit("triggerFocus")},100),this.alert.visibility=!0},f.hide=function(){this.alert.params=_.cloneDeep(g.params),this.alert.visibility=!1,this.alert.focus=!1,this.alert.view="",this.alert.close_delay=0},f.close=function(){a.$emit("modalClosing"),this.alert.close_delay?b(function(){f.hide(),a.$emit("modalClosed")},this.alert.close_delay):(f.hide(),a.$emit("modalClosed"))},f}]),ideapp.service("notifications",function(){return{}}),ideapp.factory("Os",[function(){function a(){}var b,c=window.navigator.platform;a.isWin=function(){return c.indexOf("Win")>-1},a.isMac=function(){return c.indexOf("Mac")>-1},a.isLinux=function(){return c.indexOf("X11")>-1||c.indexOf("Linux")>-1},a.isChromeOs=function(){return window.navigator.userAgent.indexOf(" CrOS ")!==-1},a.isiOS=function(){var a=window.navigator.userAgent.toLowerCase();return/iphone|ipod|ipad/.test(a)};var d=function(){return b=a.isWin()?"Windows":a.isMac()?"MacOS":a.isLinux()?"Linux":a.isChromeOs()?"ChromeOS":"Unknown OS"};return a.getName=function(){return b||d()},a}]),ideapp.service("PageTitle",["views",function(a){var b="Arduino Create",c="HOMEPAGE_DESC",d="EDITOR_DESC";return{title:function(){return b},setTitle:function(a){b=a},metaDesc:function(){return a.getCurrentRoute().indexOf("editor")===-1?c:d}}}]),ideapp.factory("progress",["$filter",function(a){var b={};b.items={},b.inProgress=!1,b.interrupting=!1;var c=!1;return b.update=function(a){b.items[a.path]||b.reset(a.path,"");var c=b.items[a.path];c.progress=0===a.progress?50:a.progress,c.pid=a.pid},b.reset=function(a,c){b.inProgress=!0,b.items[a]={path:a,pid:0,items:0,active:!0,message:c,type:"regular"}},b.end=function(b,c,d){"string"!=typeof c&&(c=a("translate")("COMPILATION_FAILED_ERROR")),this.items[b].message=this.interrupting?a("translate")("ABORTED"):c,this.interrupting=!1,this.items[b].type=d||"regular",this.items[b].active=!1,this.inProgress=!1},b.secondTryWithPasswordDone=function(){return c},b.tryWithPassword=function(){c=!0},b.resetSecondTry=function(){c=!1},b}]),ideapp.factory("reference",["$http","$templateCache",function(a,b){function c(){return[d.basePath,d.includePath].join("/")}var d={};return d.includePath="index.html",d.basePath="reference",d.baseUrl=function(){var a=c().split("/");return _.first(a,a.length-1).join("/")+"/"},d.loadRef=function(a){void 0===a||0==a.length?d.includePath="index.html":d.includePath=a},d.getContent=function(){return c()},d.getCurrentMeta=function(){return d.getMeta(d.includePath)},d.getMeta=function(a){var b={syntax:null,category:null,group:null,entity:null},c=a.split("/");switch(c=_(c).map(function(a){return a.toLowerCase()}).value(),c.length){case 0:break;case 1:b.entity=c[0];break;case 2:b.syntax=c[0],b.entity=c[1];break;case 3:b.syntax=c[0],b.category=c[1],b.entity=c[2];break;case 4:b.syntax=c[0],b.category=c[1],b.group=c[2],b.entity=c[3];break;default:b.syntax=c[0],b.category=c[1],b.group=c[2],b.entity=c.join(" ")}return b},d.hasMeta=function(a){a=a.toLowerCase();var b=d.getCurrentMeta();for(var c in b)if(b.hasOwnProperty(c)){var e=b[c];if(e==a)return!0}return!1},d.isIndex=function(){return"index.html"==d.includePath},d}]),ideapp.factory("swag",["$http","$q",function(a,b){return function(c){function d(c,d,e,f,g){var h=[],i=[],j={};if(g&&g.href)d=c+g.href;else{d=c+d;for(var k in f.parameters){var l=f.parameters[k];"header"!==l.in&&(g&&g.params&&g.params[l.name]||l.required&&h.push("param "+l.name+" is required"),"path"===l.in&&(d=d.replace("{"+l.name+"}",g.params[l.name])),"query"===l.in&&g.params[l.name]&&i.push(encodeURIComponent(l.name)+"="+encodeURIComponent(g.params[l.name])))}}if(i.length>0&&(d=d+"?"+i.join("&")),h.length>0)return b.reject(h);var m={url:d,method:e,headers:j,data:g.params.payload};return g.timeout&&(m.timeout=g.timeout),g.responseType&&(m.responseType=g.responseType),a(m)}var e,f=a.get(c+"/swagger.json").then(function(a){return e=a.data}),g={};return{endpoint:"",secure:function(a,b){g[a]=b},do:function(a,c,e){return c||(c={}),c.params||(c.params={}),e&&(c.params.payload=e),f.then(function(e){var f=e.schemes[0]+"://"+e.host;this.endpoint=f;for(var g in e.paths)for(var h in e.paths[g])if(e.paths[g][h].operationId===a)return d(f,g,h,e.paths[g][h],c);return b.reject("The action "+a+" does not exists")}.bind(this))}}}}]),ideapp.service("builderAPI",["swag","config",function(a,b){return a(b.builder.endpoint)}]),ideapp.service("createAPI",["swag","config",function(a,b){return a(b.create.endpoint)}]),ideapp.service("devicesAPI",["swag","config",function(a,b){return a(b.devices.endpoint)}]),ideapp.factory("sanity",["$window","settings","$http","Os","$filter","CreateUserService",function(a,b,c,d,e,f){var g={},h="";g.loadReadme=function(){c.get("languages/readme/en-US.adoc").then(function(a){h=a.data})};var i=function(){var a=f.userInfo();h=h.replace(/{AuthorName}/g,a.id).replace(/{AuthorEmail}/g,a.email).replace(/{DateNow}/g,(new Date).toJSON().slice(0,10).replace(/(\d+)-(\d+)-(\d+)/,"$3/$2/$1"))};g.ensureDirectory=function(a){return"/"!==a[a.length-1]&&(a+="/"),a},g.defaultSketch=function(a){var b=a||"Untitled_Project",c=b+".ino",d=g.defaultIno(c);d.content=g.defaultCode();var e=g.defaultReadme();return{ino:d,name:b,type:"sketch",path:"",unsaved:!0,board:"",metadata:null,files:[e],created:g.getNow(),modified:g.getNow()}},g.getNow=function(){return(new Date).toISOString()},g.defaultMetadata=function(){return{cpu:{fqbn:null,name:""},board_name:null}},g.defaultFolder=function(){return{name:"Untitled Folder",type:"folder",path:"",files:[],hasSketch:!0,sketches_number:0}},g.defaultIno=function(a){var b=a||"";return{name:b,content:"",type:"code",path:"path/tp/some",active:!1,mimetype:"text/x-c++src",unsaved:!0,loaded:!0,undo:[],created:g.getNow(),modified:g.getNow()}},g.defaultSecret=function(){return{name:"Secret",content:"",type:"secret",path:"path/tp/some",active:!1,unsaved:!0,loaded:!0,undo:[],created:g.getNow(),modified:g.getNow()}},g.getFileType=function(a){var b=["markdown","mdown","mkdn","md","mkd","mdwn","mdtxt","mdtext","text","adoc","asciidoc","asc"];if(""!==a.type)return a.type;var c=a.name.substr(a.name.lastIndexOf(".")+1);return"ino"===c?"text/x-c":"c"===c?"text/x-csrc":"pde"===c||"cpp"===c?"text/x-c++src":"h"===c?"text/x-chdr":b.lastIndexOf(c)!==-1?"text":"zip"===c?"application/zip":void 0},g.beautifyMimetype=function(a){return angular.isUndefined(a)?"other":0===a.indexOf("text/x-c")?"code":0===a.indexOf("text/x-c++src")?"code":0===a.indexOf("text")?"text":0===a.indexOf("application/json")?"text":0===a.indexOf("image")?"image":a.indexOf("zip")>=0?"archive":"other"},g.isTypeBinary=function(a){var b=this.beautifyMimetype(a);return"code"!==b&&"text"!==b},g.defaultFile=function(a,b,c){var d,e;return c?(d=c,e=this.beautifyMimetype(d)):(d="text/x-c++src",e="code"),{name:a,content:b,type:e,path:"",active:!1,mimetype:d,unsaved:!0,loaded:!0,undo:[],created:g.getNow(),modified:g.getNow()}},g.defaultReadme=function(){return i(),{name:"ReadMe.adoc",content:h,type:"adoc",path:"",active:!1,mimetype:"text/adoc",unsaved:!0,loaded:!0,undo:[],created:g.getNow(),modified:g.getNow()}},g.defaultCode=function(){return"/*\r\r*/\r\rvoid setup() {\r    \r}\r\rvoid loop() {\r    \r}\r"},g.rootTree=function(){return{name:"_root",open:!0,files:[]}},g.os=function(){return d.getName()},g.removeDot=function(a){var b=a.split(".");return b[0]};var j=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];g.today=new Date;var k=function(a,b){for(var c=0;c<a.length;c++){var d=a[c].name;if(b===d)return!0}return!1},l=function(a){var b=a%26,c=a/26|0,d=b?String.fromCharCode(64+b).toLowerCase():(--c,"z");return c?l(c)+d:d};g.getSketchName=function(a){for(var b=j[this.today.getMonth()],c=this.today.getDate(),d="sketch_"+b+c,e=1,f=d+l(e);k(a.files,f);){var g=l(e);f=d+g,e++}var h=f;return h},g.getAvailableCopyName=function(a,b){if(!k(b,a))return a;var c=a.split("."),d=c[0],e=d+"_copy";2===c.length&&(e=e+"."+c[1]);for(var f=e,g=1;k(b,f);)f=e+g,g++;return f},g.getCpuTranslatedLabel=function(a){var b="";if(a.fqbn){var c=e("translate")(a.fqbn);b=c===a.fqbn?e("translate")(a.name):c}else b=e("translate")(a.name);return b};var m={autosave:!0,save_on_build:!1,verbose_always_visible:!0,verify_code:!1,show_all_content:!1,verbose_compilation:!1,verbose_upload:!1,font_size:"14",skin:"light",verbose:!1};g.consolidateConfiguration=function(a,b){a.configuration=b;var c;for(c in b.user)"true"===b.user[c]&&(b.user[c]=!0),"false"===b.user[c]&&(b.user[c]=!1);for(c in m)b.user.hasOwnProperty(c)||(b.user[c]=m[c]);return a.sketchbook_path=b.user["sketchbook.path"],a.sep="/",a},g.prepareSketch=function(a,b){b||(b="sketch"),a.owner||(a.owner=this.uid),a.type=b,a.files||(a.files=[]),a.ino.primary=!0;var c=_.find(a.files,function(b){return b.name===a.name+".ino"});return c||a.files.unshift(a.ino),_.each(a.files,function(c){c.content?c.loaded=!0:c.loading=!0,c.mimetype=c.mimetype||"text/plain","secret"!==c.type&&(c.type=g.beautifyMimetype(c.mimetype)),c.undo=[],c.parent_type=b,c.sketchID=a.id,c.path=a.href?a.href+"/"+c.name:a.path+"/"+c.name}),a};var n=function(a,b,c,d){if("__root"===b)return a;for(var e=b.split("/"),f=_.find(d,{name:e[0]});e.length>1;){var h=f?f.files:[];a=n(a,e[0],c,h),e.shift()}var i=_.find(a.files,function(a){return a.name===e[0]});return i||(i=g.defaultFolder(),i.name=e[0],i.path=b,a.files.push(i)),i.files||(i.files=[]),i.folder=a.name,i.open=!!f&&f.open,i.sketches_number?i.sketches_number++:i.sketches_number=1,c&&(a.name||(i.category=c)),i};return g.prepare=function(a,b,c,d,e){var f=[];return _.each(b,function(b){var d,e={files:f,name:"",open:!1};b.types&&"example"===c&&(d=b.types.indexOf("builtin")===-1?"libraries":"base"),b.folder&&""!==b.folder&&(e=n(e,b.folder,d,a.files));var h=g.prepareSketch(b,c);b.architectures&&_.map(f,function(a){a.architectures=b.architectures}),e.files.push(h)}),d?(e&&(f[0].custom=!0),a.files=a.files.concat(f)):a.files=f,f},g.processFileContent=function(b){if(b.data)if(b.mimetype=b.mimetype||"",g.isTypeBinary(b.mimetype))b.content=a.decodeURIComponent(a.escape(b.data));else try{b.content=a.decodeURIComponent(a.escape(a.atob(b.data)))}catch(c){b.content=a.atob(b.data)}},g.processFileData=function(b){(b.content||""===b.content)&&(b.mimetype=b.mimetype||"",g.isTypeBinary(b.mimetype)?b.data=a.unescape(a.encodeURIComponent(b.content)):b.data=a.btoa(a.unescape(a.encodeURIComponent(b.content))))},g.b64toBlob=function(b,c,d){c=c||"",d=d||512;for(var e=a.atob(b),f=[],g=0;g<e.length;g+=d){for(var h=e.slice(g,g+d),i=new Array(h.length),j=0;j<h.length;j++)i[j]=h.charCodeAt(j);var k=new Uint8Array(i);f.push(k)}var l=new a.Blob(f,{type:c});return l},g}]);var Sketches=function(){function a(a,b,c,d,e,f,g,h,i){var j,k,l="",m=function(a){var b={name:a.name,folder:a.folder,metadata:a.metadata,files:[]};b.ino={name:a.name+".ino"},a.ino.unsaved&&(f.processFileData(a.ino),b.ino.data=a.ino.data);for(var c=0;c<a.files.length;c++)if(a.files[c].name!==b.ino.name&&"secret"!==a.files[c].type){var d={name:a.files[c].name};a.files[c].unsaved&&(f.processFileData(a.files[c]),d.data=a.files[c].data),b.files.push(d)}return b};this.list=[],this.tree={name:"__root",open:!0,files:[]},this.folders=[],this.fetch=function(a){var b=this;return l=a?a:l,e.do("sketches#search",{params:{owner:l}}).then(function(a){b.list=a.data.sketches,0===a.data.sketches.length?b.addTemporarySketch():f.prepare(b.tree,a.data.sketches)})},this.findFirst=function(){return g.max(this.list,function(a){return new Date(a.modified)})},this.findById=function(a){return g.find(this.list,function(b){return b.id===a})},this.findFile=function(a,b){var c=this.findById(a),d=g.find(c.files,function(a){return a.name===b});return d?d:c.ino},this.get=function(a,b){return e.do("sketches#show",{params:{id:b}}).then(function(a){return f.prepareSketch(a.data)})},this.getSketchFile=function(a){if("secret"===a.type)return b.resolve(a);var c=b.defer();return e.do("files#show",{href:a.href}).then(function(b){b.data.data?(a.data=b.data.data,f.processFileContent(a)):(a.data="",a.content=""),a.loaded=!0,a.size=b.data.size,c.resolve(a)}).catch(function(b){console.error(b),b&&b.error&&"ActionNotFound"===b.error&&a.content&&c.resolve(a),c.reject(b)}),c.promise},this.save=function(a,b){var c,d=this;return c=a.href?this.saveExistingSketch(a):this.saveNewSketch(a,b),c.then(function(a){return a}).then(function(b){return g.each(a.files,function(b){delete b.saving,d.setAsSaved(a,b)}),b}).catch(function(a){if(!k)throw a})},this.saveNewSketch=function(a,d){var h=g.findWhere(a.files,{name:"arduino_secrets.h"});if(h){var j=/^#define\s+(SECRET_[A-Z0-9_]+)\s+"(.*)"$/gm;if(h.data){a.metadata||(a.metadata={}),a.metadata.secrets=[],f.processFileContent(h);for(var k=j.exec(h.content);null!==k;){var l=k[1],n=k[2];a.metadata.secrets.push({name:l,value:n}),k=j.exec(h.content)}a.files=g.reject(a.files,{name:"arduino_secrets.h"}),a.ino.mimetype="text/plain",f.processFileContent(a.ino),f.processFileData(a.ino)}}a.ino.content=a.ino.content.replace(/#include\s+"arduino_secrets.h"\s*\n*/,"");var o=m(a);return e.do("sketches#create",{},o).then(function(b){return g.merge(a,f.prepareSketch(b.data)),h&&a.files.push(f.defaultSecret()),a}).then(function(a){return i.refreshStats(),d?a:(c.go("editor.user.sketch.file",{uid:a.owner,id:a.id,filename:a.ino.name}),a)}).catch(function(c){return c.sketch=a,b.reject(c)})},this.saveExistingSketch=function(a){k=!1,j&&(j.resolve(),j=null,k=!0),j=b.defer();var c=m(a);return e.do("sketches#edit",{href:a.href,timeout:j.promise},c).then(function(a){return j=null,i.refreshStats(),a})},this.copy=function(a,b,c){switch(void 0===c&&(c=!1),a.type){case"sketch":case"example":return this.copySketch(a,b,c);case"folder":return this.copyFolder(a,b,c);default:return this.copyFile(a,b)}},this.copyFile=function(a,b){var c=this;return this.getSketchFile(a).then(function(){var d=c.findById(a.sketchID),e=angular.copy(a);return e.href=null,e.unsaved=!0,e.name=f.getAvailableCopyName(a.name,b.files),d.files.push(e),c.save(d)})},this.copySketch=function(a,b,c){var d=this;return void 0===c&&(c=!1),a.ino||(a.ino=g.find(a.files,function(b){return b.name===a.name+".ino"})),this.load(a).then(function(){var e=angular.copy(a);return e.ino=g.find(e.files,function(a){return a.name===e.ino.name}),e.files=g.reject(e.files,function(a){return a.name===e.ino.name}),e.name=f.getAvailableCopyName(a.name,b.files),e.ino.name=e.name+".ino",e.id=e.name,e.href=null,b.folder&&""!==b.folder?e.folder=b.folder+"/"+b.name:b.name&&(e.folder=b.name),d.list.push(e),c||f.prepare(d.tree,d.list),g.each(e.files,function(a){d.setAsUnsaved(a)}),d.save(e)})},this.copyFolder=function(a,c,d){var e=this;void 0===d&&(d=!1);var h=f.getAvailableCopyName(a.name,c.files),i=this.createFolder(h,c);c.folder&&""!==c.folder?i.folder=c.folder+"/"+c.name:c.name&&(i.folder=c.name);var j=g.map(a.files,function(a){return this.copy(a,i,!0)}.bind(this));return b.all(j).then(function(){d||f.prepare(e.tree,e.list)})};var n=function(a){a.returnValue="Do you want to review the unsaved sketches?"};this.setAsSaved=function(b,c){c&&(c.unsaved=!1),b&&(b.unsaved=!1),a.removeEventListener("beforeunload",n)},this.setAsUnsaved=function(b,c){c&&(c.unsaved=!0),b&&(b.unsaved=!0),a.addEventListener("beforeunload",n)},this.createFolder=function(a,b){var c=f.defaultFolder();return c.name=a,this.folders.push(c),b||(b=this.tree),b.files.push(c),c},this.addTemporarySketch=function(a,b,d){d||(d=this.tree),a||(a=f.getSketchName(d));var e=f.defaultSketch(a);return b&&(e.ino.content=b),e.id=a,e.public=!0,d.name&&(e.folder=d.name),this.list.push(e),f.prepare(this.tree,this.list),this.save(e).then(function(){c.go("editor.user.sketch.file",{uid:c.params.uid,id:e.id,filename:e.ino.name})})},this.load=function(a){if("example"===a.type)return h.load(a);var c=this,d=g.map(a.files,function(a){if(f.processFileData(a),!(a.unsaved||a.data&&"undefined"!==a.data))return c.getSketchFile(a)});return b.all(d)},this.move=function(a,c,d){var e=this;void 0===d&&(d=!1);var h=f.getAvailableCopyName(a.name,c.files);if(h!==a.name&&!d)return b.reject("ERROR_MOVING_MESSAGE");if(c.folder&&""!==c.folder?a.folder=c.folder+"/"+c.name:a.folder=c.name,"sketch"===a.type)return this.save(a).then(function(){d||f.prepare(e.tree,e.list)});if("folder"===a.type){var i=g.map(a.files,function(b){return this.move(b,a,!0)}.bind(this));return b.all(i).then(function(){d||f.prepare(e.tree,e.list)})}};var o=function(a){var b=a.findFirst();c.go("editor.user.sketch.file",{uid:b.owner,id:b.id,filename:b.ino.name})};this.delete=function(a,c,h){var j=this;if(void 0===h&&(h=!1),"sketch"===a.type)return e.do("sketches#delete",{href:a.href}).then(function(){i.refreshStats(),j.list=g.reject(j.list,function(b){return"sketch"===b.type&&b.name===a.name&&b.folder===a.folder}),h||(0===j.list.length?j.addTemporarySketch():(f.prepare(j.tree,j.list),a.id===d.id&&o(j)))}.bind(this));if("folder"===a.type){var k=g.map(a.files,function(a){return this.delete(a)}.bind(this));return b.all(k).then(function(){j.folders=g.reject(j.folders,function(b){return"folder"===b.type&&b.name===a.name&&b.folder===a.folder}),f.prepare(j.tree,j.list),!h&&j.list.length>1&&g.findWhere(a.files,{id:d.id})&&o(j)}.bind(this))}},this.deletefile=function(a,b){for(var d in a.files)if(a.files[d].name===b.name&&a.files[d].type===b.type){a.files.splice(d,1);break}return this.save(a).then(function(){a.active&&c.go("editor.user.sketch",{uid:a.owner,id:a.id})}.bind(this))},this.rename=function(a,b,c){switch(void 0===c&&(c=!1),a.type){case"sketch":return this.renameSketch(a,b,c);case"folder":return this.renameFolder(a,b,c);default:return this.renameFile(a,b,c)}},this.renameSketch=function(a,b,c){var d=this;return void 0===c&&(c=!1),a.name=b,a.ino.name=b+".ino",this.save(a).then(function(){c||f.prepare(d.tree,d.list)})},this.renameFolder=function(a,c,d){var e=this;void 0===d&&(d=!1),a.name=c;var h=g.map(a.files,function(b){return this.move(b,a,!0)}.bind(this));return b.all(h).then(function(){d||f.prepare(e.tree,e.list)})},this.renameFile=function(a,b){var c=this.findById(a.sketchID);return a.primary?this.rename(c,b):(a.name=b,this.setAsUnsaved(a),this.save(c))},this.exportMultiple=function(a,c){var d=new JSZip,e=[],h=this;return g.isUndefined(c)&&(c="sketches"),g.each(a,function(a){e.push(h.load(a).then(function(){if("sketch"===a.type||"example"===a.type){var b=a.folder.split("/");"__root"===b[0]&&b.shift(),b.push(a.name),b=b.join("/");var c=d.folder(b);c.file(a.ino.name,a.ino.data,{base64:!0}),c.file("sketch.json",JSON.stringify(a.metadata));var e=g.findWhere(a.files,{type:"secret"});if(e){for(var h={mimetype:"text/x-c++src; charset=utf-8",content:""},i=0;i<a.metadata.secrets.length;i++){var j=a.metadata.secrets[i];h.content+="#define "+j.name+' ""\n'}f.processFileData(h),c.file("arduino_secrets.h",h.data,{base64:!0});var k={mimetype:"text/x-c++src; charset=utf-8",content:'#include "arduino_secrets.h"\n'+a.ino.content};f.processFileData(k),a.ino.data=k.data}for(var l in a.files)"secret"!==a.files[l].type&&c.file(a.files[l].name,a.files[l].data,{base64:!0})}}))}),b.all(e).then(function(){return d.generateAsync({type:"blob"})}).then(function(a){".zip"!==c.slice(-4)&&(c+=".zip"),saveAs(a,c)})}}return a}();ideapp.service("sketches",["$window","$q","$state","$stateParams","createAPI","sanity","_","examples","CreateUserService",Sketches]),ideapp.factory("skin",["views",function(a){var b={},c="light",d=13;return b.current=function(){return a.hasTealBackground()?"light":c},b.set=function(a){c=a},b.setFontSize=function(a){d=a},b.currentFontSize=function(){return d},b}]),ideapp.factory("toggler",["$log","$timeout","$rootScope","$window",function(a,b,c,d){var e,f={};f.zenMode=!1;var g=300;c.$on("endSplitter",function(a,b){g=parseInt(b,10)}),f.toggleZen=function(){f.zenMode=!f.zenMode,f.zenMode&&f.close(),c.$emit("fullScreenChanged")};var h={fullscreen:{main:"tooltip.fullscreen"},exit_fullscreen:{main:"tooltip.exit_fullscreen"}};return f.zenTooltip=function(){return f.zenMode?h.exit_fullscreen:h.fullscreen},f.currentOpen=function(){return e},f.toggle=function(a){e?e===a?f.close():f.open(a,250):f.open(a,0)},f.close=function(){f._openClose("open",0,function(){e=null,c.$emit("sidebarClose",e)})},f.closeMobile=function(){d.innerWidth<415&&f.close()},f.open=function(a,b){f._openClose("close",b,function(){e=a,c.$emit("sidebarOpen",a)})},f._openClose=function(a,c,e){var f,h=$("#subMainSidebar"),i=$("#split01"),j=g,k=d.innerWidth;f=k<415?j=k-50:k<845?j=240:300;var l={open:[0,0,0,0],close:[f,j,5,5]};b(function(){h.css("min-width",l[a][0]),h.css("width",l[a][1]),i.css("min-width",l[a][2]),i.css("width",l[a][3]),e()},c)},f.openVerbose=function(){var a=angular.element("#outputOut");0===a.height()&&a.height(100),c.$emit("verboseChanged")},f}]),ideapp.factory("verbose",function(){var a={};return a.output={},a.addOutput=function(b){a.output[b.id]||a.reset(b.id);var c=a.output[b.id],d=b.output?b.output.split("\n"):[];angular.forEach(d,function(a){var d=b.output_type;"out"===d&&(d="deb"),a.indexOf("[error]")===-1&&a.indexOf("ERROR:")===-1||(a=a.replace("[error] ",""),d="err"),a.indexOf("[warn]")!==-1&&(a=a.replace("[warn] ",""),d="warn"),a.indexOf("[info]")!==-1&&(a=a.replace("[info] ",""),d="out"),_.contains(b.output,"#pragma message")&&(d="warn"),""!==a&&a.indexOf("WARNING: Category")===-1&&c.push({message:a,classtype:"color_"+d})})},a.getRaw=function(b){var c=a.output[b],d="";return angular.forEach(c,function(a){d+=a.message+"\n"}),d},a.reset=function(b){a.output[b]=[]},a.getFirstError=function(b,c){var d,e=a.output[b],f={message:"",column:0,row:0};for(d=0;d<e.length;d++){var g=e[d];if(g.message.indexOf("error: ")!==-1){var h=g.message.indexOf(".ino:"),i=g.message.substr(h+5),j=g.message.substr(0,h).split("/"),k=j[j.length-1]+".ino",l=i.split(":");return f.file=k,f.row=parseInt(l[0],10),f.column=parseInt(l[1],10),c&&(g.message=g.message.replace(":"+f.row+":"+f.column,":"+(f.row-1)+":"+f.column),f.row--),f.message=l.slice(3).join(":"),f}"color_err"===g.classtype&&g.message&&(f.message=g.message)}return f},a.getLast=function(b){var c,d,e=a.output[b];for(d=e.length-1;d>=0;d--){var f=e[d];""===f.message||c||(c=angular.copy(f))}var g=c?c.message.split("):"):null;return g&&g.length>1&&(c.message=g[1]),c?c.message:""},a}),ideapp.factory("views",["$state","$location",function(a,b){var c=["wait","redeem"],d=["wait","nobrowser","redeem","getting-started","setup-done","editor.public","missing-sketch","terms-and-conditions"],e=["nobrowser","getting-started-plugin","getting-started-device","getting-started-up2","getting-started","editor.public","setup-done","missing-sketch","terms-and-conditions","devices"],f=["nobrowser","getting-started-plugin","getting-started-device","getting-started","editor.public","missing-sketch","setup-done","redeem","terms-and-conditions","devices"],g=["home","getting-started","editor.public"];return{EDITOR:"editor",WAITER:"wait",NO_BROWSER:"nobrowser",GETTING_STARTED:"getting-started",GETTING_STARTED_PLUGIN:"getting-started-plugin",GETTING_STARTED_DEVICE:"getting-started-device",GETTING_STARTED_UP2:"getting-started-up2",DEVICES:"devices",HOME:"home",LOGGED_HOME:"logged.home",REDEEM:"redeem",SETUPDONE:"setup-done",hasDashboard:function(){return a.current.name&&c.indexOf(a.current.name)===-1},hasMessages:function(){return a.current.name&&d.indexOf(a.current.name)===-1},isDashboard:function(){return a.current.name===this.HOME||a.current.name===this.LOGGED_HOME},hasWhiteIcons:function(){return a.current.name&&e.indexOf(a.current.name)!==-1},setRoute:function(b,c,d){var e=c?{location:!1}:null;a.go(b,d,e)},getCurrentRoute:function(){return a.current.name},setSketchHash:function(a){b.path("editor/"+a).replace()},viewExists:function(a){for(var b in this)if(this.hasOwnProperty(b)&&this[b]===a)return!0;return!1},hasNotifications:function(){return a.current.name.indexOf("editor")!==-1&&"editor.public"!==a.current.name},hasTealBackground:function(){return a.current.name&&f.indexOf(a.current.name)!==-1},hasLoginButton:function(){return a.current.name&&g.indexOf(a.current.name)!==-1}}}]),ideapp.service("storeLink",function(){var a={"arduino:avr:LilyPadUSB":"https://www.arduino.cc/en/Main/ArduinoBoardLilyPadUSB","arduino:avr:mini:cpu=atmega328":"https://store.arduino.cc/product/A000087","arduino:avr:leonardoeth":"https://store.arduino.cc/product/A000022","arduino:avr:atmegang":null,"arduino:avr:diecimila":"https://www.arduino.cc/en/Main/Boards","arduino:avr:fio":null,"arduino:samd:mzero_pro_bl_dbg":"https://www.arduino.cc/en/Main/ArduinoBoardM0PRO","arduino:samd:arduino_zero_native":"https://store.arduino.cc/product/GBX00003","arduino:avr:mega:cpu=atmega2560":"https://store.arduino.cc/product/A000067","arduino:avr:robotMotor":"https://www.arduino.cc/en/Main/Robot","arduino:avr:gemma":null,"arduino:samd:adafruit_circuitplayground_m0":null,"Intel:i686:izmir_ec":null,"arduino:sam:arduino_due_x_dbg":"https://store.arduino.cc/product/A000062","arduino:samd:arduino_zero_edbg":"https://store.arduino.cc/product/GBX00003","Intel:i586:izmir_fd":null,"Intel:i586:izmir_fg":null,"Microsoft:win10:w10iotcore":null,"arduino:avr:circuitplay32u4cat":null,"arduino:avr:unowifi":null,"arduino:avr:yun":"https://store.arduino.cc/product/A000008","arduino:avr:one":null,"arduino:avr:micro":"https://store.arduino.cc/product/GBX00053","arduino:avr:ethernet":null,"Intel:arc32:arduino_101":"https://store.arduino.cc/product/GBX00005","arduino:avr:leonardo":"https://store.arduino.cc/product/A000057","arduino:avr:bt":null,"arduino:avr:esplora":"https://store.arduino.cc/product/A000095","arduino:sam:arduino_due_x":"https://store.arduino.cc/product/A000062","atmel-avr-xminis:avr:atmega328pb_xplained_mini":null,"atmel-avr-xminis:avr:atmega168pb_xplained_mini":null,"arduino:avr:yunmini":"https://store.arduino.cc/product/A000108","arduino:avr:chiwawa":"https://store.arduino.cc/product/A000126","arduino:avr:nano:cpu=atmega328":"https://store.arduino.cc/product/A000005","arduino:avr:megaADK":"https://store.arduino.cc/product/A000069","arduino:samd:mkrzero":"https://store.arduino.cc/product/ABX00012","atmel-avr-xminis:avr:atmega328p_xplained_mini":null,"arduino:avr:robotControl":"https://www.arduino.cc/en/Main/Robot","arduino:avr:pro:cpu=16MHzatmega328":"https://www.arduino.cc/en/Main/ArduinoBoardPro","arduino:avr:lilypad:cpu=atmega328":"https://www.arduino.cc/en/Main/ArduinoBoardLilyPad","arduino:samd:mzero_pro_bl":"https://www.arduino.cc/en/Main/ArduinoBoardM0PRO","arduino:samd:mzero_bl":"https://www.arduino.cc/en/Main/ArduinoBoardM0","littleBits:avr:w6_arduino":null,"arduino:avr:uno":"https://store.arduino.cc/product/A000066","arduino:samd:mkr1000":"https://store.arduino.cc/product/ABX00004","arduino:samd:tian":"https://store.arduino.cc/product/A000116","arduino:samd:mkrfox1200":"https://store.arduino.cc/homepage/arduino-mkrfox1200"},b={get:function(b){return a[b]?a[b]:null}};return b}),ideapp.service("CreateUserService",["$q","AuthService","createAPI",function(a,b,c){var d={},e={},f=function(a){var b=100*(a.disk_libraries+a.disk_sketches)/d.limits.disk;
a.limitSketches=d.limits.sketches,a.spaceUsedPercMin=Math.min(100,b),a.libSpaceUsedPerc=Math.min(100,100*a.disk_libraries/d.limits.disk),a.sketchesSpaceUsedPerc=Math.min(100,100*a.disk_sketches/d.limits.disk),a.limitMB=Math.round(d.limits.disk/1048576),a.spaceUsed=a.disk_libraries+a.disk_sketches,a.spaceUsedMB=Math.round(a.spaceUsed/1048576),a.availableSpace=d.limits.disk-a.spaceUsed,a.availableSpaceMB=Math.round(a.availableSpace/1048576),a.availableSpaceKB=Math.round(a.availableSpace/1024),b>100&&(a.libSpaceUsedPerc=100*a.disk_libraries/a.spaceUsed,a.sketchesSpaceUsedPerc=100*a.disk_sketches/a.spaceUsed)},g=function(){return c.do("users#edit",{params:{id:"me"}},{}).then(function(a){return d=a.data,a.data})},h=function(){return c.do("users#stats",{params:{id:"me"}}).then(function(a){e=a.data,f(e)})},i=function(){return c.do("users#show",{params:{id:"me"}}).then(function(b){return"0001-01-01T00:00:00Z"===b.data.activated?a.reject({Error:"AccessDenied"}):(d=b.data,d.uid=d.id,h(),a.resolve(b.data))}).catch(function(b){return 401===b.status?a.reject({Error:"TokenInvalid"}):404===b.status?g().then(function(){return a.reject({Error:"AccessDenied"})}):a.reject(b)})},j=function(){return d},k=function(){return e};return{getUserInfo:i,userInfo:j,userStats:k,refreshStats:h}}]),ideapp.service("preferences",["createAPI",function(a){var b=null,c=function(){return a.do("users#show",{params:b}).then(function(a){return a.data.prefs})};return{init:function(){return b={id:"me"},c()},save:function(c){return a.do("users#edit",{params:b},{prefs:c})}}}]),ideapp.directive("focus",["$rootScope","$timeout",function(a,b){return{scope:{trigger:"@focus"},link:function(c,d){var e=a.$on("triggerFocus",function(){b(function(){d[0].focus()})});c.$on("$destroy",function(){e()})}}}]),ideapp.directive("focusMe",["$timeout",function(a){return{scope:{trigger:"=focusMe"},link:function(b,c){b.$watch("trigger",function(b){b===!0&&a(function(){$(c[0]).find("input").focus()})})}}}]),ideapp.directive("clickOnEnter",function(){return{link:function(a,b){$(document).bind("keydown keypress",function(a){13!==a.which||$(b).prop("disabled")||b.click()}),a.$on("$destroy",function(){$(document).unbind("keydown keypress")})}}}),ideapp.directive("ngRightClick",["$parse","settings",function(a,b){return function(c,d,e){if(b.enableContextMenu){var f=a(e.ngRightClick);d.bind("contextmenu",function(a){c.$apply(function(){a.preventDefault(),f(c,{$event:a})})})}}}]),ideapp.directive("scrollBottom",["$timeout",function(a){return{link:function(b,c,d){var e=angular.element(c);b.$watch(d.changed,function(){a(function(){e.scrollTop(e.prop("scrollHeight"))},0)})}}}]),ideapp.directive("handlePlay",["$rootScope","$timeout","$window",function(a,b,c){return{scope:!1,link:function(a,b,d){c.innerWidth<1024&&$(b).empty(),a.$watch(d.handlePlay,function(a){c.innerWidth>1024&&(a?b[0].play():b[0].pause())})}}}]),ideapp.directive("addClassIfIframe",function(){return{link:function(){window.self!==window.top&&$(document.body).addClass("in-iframe")}}}),ideapp.directive("fitImgHeight",["$rootScope","$timeout",function(a,b){return{link:function(c,d,e){function f(){b(function(){var a=i.width(),b=i.height(),c=i.find("img");if(c){c.removeAttr("style"),g=c.width(),h=c.height();var d=a/g,e=b/h;d>e?(c.width(g*e-10),c.height(h*e-10)):(c.width(g*d-10),c.height(h*d-10))}})}var g,h,i=angular.element(d);$(d).hide();var j=a.$on("aceResized",function(){f()});c.$watch(e.fitImgHeight,function(){f(),$(d).show()}),c.$on("$destroy",function(){j()})}}}]),ideapp.directive("removeSplash",function(){return{scope:{},restrict:"A",link:function(){$("html, body").css("background-image","none")}}}),ideapp.directive("pluginDisconnectedButton",["modal",function(a){return{restrict:"C",scope:{},link:function(b,c){c.click(function(){a.show("tryReconnect",{})})}}}]),ideapp.directive("chromeappDisconnectedButton",["config","daemon","messages","$window",function(a,b,c,d){return{restrict:"CA",scope:{},link:function(b,c){c.click(function(){d.location="https://chrome.google.com/webstore/detail/"+a.chromeExtensionIds[0]})}}}]),ideapp.directive("selectOnClick",function(){return function(a,b){b.on("focus",function(){this.select()})}}),ideapp.directive("iframeOnLoad",function(){return{scope:{callBack:"&iframeOnLoad"},link:function(a,b){b.on("load",function(){return a.callBack()})}}}),ideapp.directive("addSearchKey",function(){return{link:function(a,b){b.on("click",function(){var a=$.Event("keypress",{which:13});$(b).siblings("tags-input").find("input").focus(),$(b).siblings("tags-input").find("input").trigger(a)})}}}),ideapp.directive("scrollOnAdd",["libraries","$timeout",function(a,b){return{link:function(c,d,e){var f=$(d).parents(".fileList.scrollable");e.id===a.getLastAdded()&&(f.scrollTop($(d).offset().top-f.offset().top+f.scrollTop()),$(d).css("background-color","rgba(127,203,205,.2)"),b(function(){$(d).css("background-color","inherit")},3e4))}}}]),ideapp.directive("input",["deviceInfo",function(a){return"edge"!==a.browser.getBrowser()?{}:{link:function(a,b){"number"===b[0].type&&b.on("keydown",function(c){switch(c.which){case 38:case 40:a.$evalAsync(function(){b.triggerHandler("change")})}})}}}]),ideapp.directive("targetBlank",function(){return{scope:{content:"="},link:function(a,b){var c=$("<div>"+a.content+"</div>");$(c).find("a").attr("target","_blank"),b.append($(c).contents())}}}),ideapp.directive("bulkActionCanceller",["bulkAction",function(a){return{link:function(b,c){$("body").get(0).addEventListener("click",function(d){a.selection&&0!==a.selection.length&&0===c.find(d.target).length&&0===$(".bulkActionWrapper").find(d.target).length&&0===$(".basemodal").find(d.target).length&&b.bulkDeselect()},!0)}}}]),function(){"use strict";var a=angular.module("ideapp");a.filter("libArchFilter",["$filter",function(a){return function(b){return b?b.indexOf("*")!==-1?a("translate")("any").toUpperCase():b.join(", ").toUpperCase():""}}]),a.filter("imagedata",function(){return function(a,b){var c="data:"+b+";base64,";return c+a}}),a.filter("removeATags",function(){return function(a){return a?String(a).replace(/<[a-zA-Z]*>/gim,""):""}}),a.filter("filterLinks",function(){return function(a){return a?String(a).replace(/(.*:\/\/)((ww(2|w))*\.)?|(\?.*)/gim,""):""}})}();var H__Splitter=function(a,b,c){function d(a){r.className="",l=e(0),clearTimeout(m)}function e(a){var b,c;return b=document.defaultView.getComputedStyle(q,"").getPropertyValue("height"),c=document.defaultView.getComputedStyle(r,"").getPropertyValue("height"),b=parseInt(b,10)+a,c=parseInt(c,10)-a,{wL:b,wR:c}}function f(a){var b=a.clientY-n,c=e(b);g(c.wL,c.wR),n=a.clientY}function g(a,b){q.style.height=a+"px",r.style.height=b+"px"}function h(){document.removeEventListener("mousedown",d),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",h),parseInt(document.defaultView.getComputedStyle(r,"").getPropertyValue("height"),10)<=30&&(r.className="animated",r.style.height=0),clearTimeout(m),m=setTimeout(function(){e(0);p.wL=l.wL,p.wR=l.wR,l=null},1e3),k(),r.className="animated"}function i(a){a.preventDefault(),n=a.clientY,document.addEventListener("mousedown",d),document.addEventListener("mousemove",f),document.addEventListener("mouseup",h)}function j(a){r.className="animated",g(p.wL,p.wR)}var k,l,m,n=0,o=a,p={wL:0,wR:0},q=document.getElementById(b),r=document.getElementById(c);this.endOfDrag=function(a){k=a},o.addEventListener("mousedown",i),o.addEventListener("dblclick",j),this.destroy=function(){o.removeEventListener("mousedown",i),o.removeEventListener("dblclick",j),document.removeEventListener("mousedown",d),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",h),clearTimeout(m)}};ideapp.directive("splitDrag",["$timeout","$rootScope",function(a,b){return{restrict:"A",scope:{prev:"=prev",next:"=next",direction:"=direction"},link:function(c,d,e){var f,g=angular.element(d);a(function(){f=new H__Splitter(g[0],c.prev,c.next),f.endOfDrag(function(){b.$emit("endSplitter")})},500),c.$on("$destroy",function(){f&&(f.destroy(),f=null)})}}}]);var V__Splitter=function(a,b){function c(a){k=d(0),clearTimeout(l)}function d(a){var c;return c=document.defaultView.getComputedStyle(b,"").getPropertyValue("width"),c=parseInt(c,10)+a,{wL:c}}function e(a){var b=a.clientX-m,c=d(b);f(c.wL),m=a.clientX}function f(a){b.style.width=a+"px"}function g(){window.removeEventListener("mousedown",c),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",g),parseInt(document.defaultView.getComputedStyle(b,"").getPropertyValue("width"),10)<=30,clearTimeout(l),l=setTimeout(function(){d(0);o.wL=k.wL,k=null},1e3),j(b.style.width)}function h(a){a.preventDefault(),m=a.clientX,window.addEventListener("mousedown",c),window.addEventListener("mousemove",e),window.addEventListener("mouseup",g)}function i(a){f(o.wL)}var j,k,l,m=0,n=a,o={wL:0,wR:0},b=document.getElementById(b);this.endOfDrag=function(a){j=a},n.addEventListener("mousedown",h),n.addEventListener("dblclick",i),this.destroy=function(){n.removeEventListener("mousedown",h),n.removeEventListener("dblclick",i),window.removeEventListener("mousedown",c),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",g),clearTimeout(l)}};ideapp.directive("splitDragH",["$timeout","$rootScope",function(a,b){return{restrict:"A",scope:{updateDiv:"=updateDiv"},link:function(c,d,e){var f,g=angular.element(d);a(function(){f=new V__Splitter(g[0],c.updateDiv),f.endOfDrag(function(a){b.$emit("endSplitter",a)})},500),c.$on("$destroy",function(){f&&(f.destroy(),f=null)})}}}]),ideapp.controller("contextualMenuCtrl",["$scope","contextMenu","Os",function(a,b,c){a.ctxMenu=b,a.isMac=c.isMac(),a.isWin=!c.isMac(),a.clickMenu=function(a){a(),b.hide()},a.getStatus=function(a){return a.disabled},a.getItemClass=function(a){return a.separator&&void 0!==a.separator?"separator ":""}}]),ideapp.directive("contextualMenuAdjustYPos",["$document","$timeout",function(a,b){function c(c,d,e){var f=c.ctxMenu,g=50;c.$watch(function(){return 1e3*f.x+f.y},function(c,e){var h=a.height();f.preRender=!0,b(function(){var a=d.children(0).outerHeight();f.y+a+g>h&&(f.y-=a),f.preRender=!1},0)})}return{link:c}}]),ideapp.controller("aceEditorCtrl",["$scope","$rootScope","$timeout","ace","editor","contextMenu","$filter","sketches","boardMetadata",function(a,b,c,d,e,f,g,h,i){a.editor=e;var j,k,l=!0,m=["ino","h","c","cpp"];a.forceSecretsInstructionsOpen=void 0,a.userTheme=d.getTheme(),a.mode="arduino";var n=_.debounce(function(){var a=i.get().secrets;i.writeSecrets();var b=i.get().secrets;if(angular.equals(a,b)===!1){var c=_.findWhere(e.currentProject.files,{type:"secret"});h.setAsUnsaved(e.currentProject,c)}},1e3);a.editorReady=function(b){d.init(b,e.currentProject.currentFile),j=b,e.currentProject.currentFile.readonly&&b.setReadOnly(!0),a.generateSecrets()},a.editorChange=function(){d.clearErrors(),angular.forEach(e.currentProject.files,function(a){delete a.error});var b=e.current.configuration.user.autosave;if(b){if("example"===e.currentProject.type)return h.setAsUnsaved(e.currentProject,e.currentProject.currentFile),void(l&&(a.makeACopy(!0),l=!1));clearTimeout(k);var c=e.currentProject.currentFile.href;k=setTimeout(function(){var b=_.findWhere(e.currentProject.files,{href:c})||_.findWhere(e.currentProject.ino,{href:c});i.writeSecrets(),b.unsaved=!0,a.saveCurrentProject(!0)},500)}else"example"!==e.currentProject.type&&n(),h.setAsUnsaved(e.currentProject,e.currentProject.currentFile)},a.onChangingContent=function(){d.onChangingContent()},a.onContentChanged=function(){d.onContentChanged(e.currentProject.currentFile)},a.showHideSecretsInstructions=function(){a.forceSecretsInstructionsOpen=!a.forceSecretsInstructionsOpen},a.secretsInstructionsVisible=function(){var b=i.get().secrets||[];if(a.forceSecretsInstructionsOpen===!0)return!0;if(a.forceSecretsInstructionsOpen===!1)return!1;for(var c=0;c<b.length;c++){if(b[c].value)return void 0===a.forceSecretsInstructionsOpen&&(a.forceSecretsInstructionsOpen=!1),!1;void 0===a.forceSecretsInstructionsOpen&&(a.forceSecretsInstructionsOpen=!0)}return!0},a.$watch(function(){return e.currentProject.currentFile},function(b){if(j&&b.name){var c=b.name.split(".").pop();m.indexOf(c)===-1&&b.name.split(".").length>1?(j.session.setMode("ace/mode/text"),a.mode="text"):(j.session.setMode("ace/mode/arduino"),a.mode="arduino")}}),a.setSecretUnsaved=function(){e.currentProject.currentFile.unsaved=!0};var o=b.$on("insertLibCode",function(a,b){c(function(){var a=j.find(b,{wrap:!0,caseSensitive:!0,regExp:!1,preventScroll:!0});a?h.setAsSaved(e.currentProject,e.currentProject.currentFile):j.session.getDocument().insert({row:0,column:0},b+"\n\n"),j.session.setScrollTop(0)})}),p=b.$on("removeLibCode",function(a,b){c(function(){var a=function(a){return j.find(a,{wrap:!0,caseSensitive:!0,regExp:!1,preventScroll:!0})},c=0,d=a(b+"\n\n");d||(d=a(b+"\n")),d||(d=a(b),c=Number.MAX_VALUE),d&&(d.start.column=0,d.end.column=c,j.session.replace(d,""))})});a.$on("$destroy",function(){o(),p()});var q=function(){var a=d.ace_ref.selection.getCursor();d.ace_ref.gotoLine(a.row,a.column),d.ace_ref.focus()};a.showContextMenu=function(b){var c=[{label:g("translate")("SHORT_COPY"),disabled:""===d.ace_ref.getCopyText(),clipboard:!0,text:d.ace_ref.getCopyText(),shortcut:{mac:"C",win:"ctrl C"},clb:function(){d.fillClipBoard(d.ace_ref.getCopyText()),d.ace_ref.focus()}},{label:g("translate")("SHORT_CUT"),disabled:""===d.ace_ref.getCopyText(),clipboard:!0,text:d.ace_ref.getCopyText(),shortcut:{mac:"X",win:"ctrl X"},clb:function(){d.fillClipBoard(d.ace_ref.getCopyText()),d.ace_ref.insert(""),d.ace_ref.focus()}},{label:""===d.getClipBoard()?g("translate")("PASTE_FROM_OS"):g("translate")("SHORT_PASTE"),disabled:""===d.getClipBoard(),separator:!0,clipboardpaste:""===d.getClipBoard(),shortcut:{mac:"V",win:"ctrl V"},clb:function(){d.ace_ref.insert(d.getClipBoard()),e.currentProject.currentFile.content=j.session.getValue(),a.editorChange(),d.ace_ref.focus()}},{label:g("translate")("UNDO"),disabled:!d.hasUndo(),shortcut:{mac:"Z",win:"ctrl Z"},clb:function(){d.undo(),d.ace_ref.focus()}},{label:g("translate")("REDO"),disabled:!d.hasRedo(),shortcut:{mac:"Z",win:"ctrl  Z"},clb:function(){d.redo(),d.ace_ref.focus()}},{label:g("translate")("SELECT_ALL"),disabled:!1,separator:!0,shortcut:{mac:"A",win:"ctrl A"},clb:function(){d.selectAll()}},{label:g("translate")("COMMENT_UNCOMMENT"),disabled:!d.hasSelection(),shortcut:{mac:"/",win:"ctrl /"},clb:function(){d.toggleComment(),e.currentProject.currentFile.content=j.session.getValue(),e.currentProject.currentFile.unsaved=!0,a.editorChange(),q()}},{label:g("translate")("INDENT_INCREASE"),disabled:!d.hasSelection(),shortcut:{mac:"tab",win:"tab"},clb:function(){d.increaseIndent(),e.currentProject.currentFile.content=j.session.getValue(),e.currentProject.currentFile.unsaved=!0,a.editorChange(),q()}},{label:g("translate")("INDENT_DECREASE"),separator:!0,disabled:!d.hasSelection(),shortcut:{mac:"tab",win:" tab"},clb:function(){d.decreaseIndent(),e.currentProject.currentFile.content=j.session.getValue(),e.currentProject.currentFile.unsaved=!0,a.editorChange(),q()}},{label:g("translate")("SHORT_FIND"),disabled:!1,shortcut:{mac:"F",win:"ctrl F"},clb:function(){d.openFind()}},{label:g("translate")("SHORT_FIND_AND_REPLACE"),disabled:!1,shortcut:{mac:" shift F",win:"ctrl  F"},clb:function(){d.openFindAndReplace()}}];f.show(b.clientX,b.clientY,c)},a.getImagePath=function(a){var b=a?"/download/"+a.path:"";return b};var r=["text","json"];a.mimeEditorAllowed=function(a){if(a&&"secret"===a.type)return!1;if(a&&a.mimetype){var b=!1;return angular.forEach(r,function(c){a.mimetype.indexOf(c)>=0&&(b=!0)}),b}return!1},a.isImg=function(a){return!!(a&&a.mimetype&&a.mimetype.indexOf("image")>=0)}}]),ideapp.controller("editorCtrl",["$rootScope","$scope","settings","editor","toggler","modal","sanity","compiler","messages","mainMenu","$state","sketches","PageTitle","$filter","user","$stateParams","APIAlive","$timeout","$q","libraries","$window","CreateUserService","skin","builderAPI","Coachmarks","boardMetadata",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){function A(a){var b="sketch"===a.type?"SKETCH":"FILE";return b="folder"===a.type?"FOLDER":b}b.srv=e,b.settings=c,b.user=o,b.editorsrv=d,b.userStats=v.userStats();var B=angular.copy(d.current.configuration.user);B.font_size=Number(B.font_size)?Number(B.font_size):13,b.$watch(function(){return v.userStats()},function(a){b.userStats=a}),b.showDonate=l.list.length>3,b.closeTour=function(){b.showTour=!1,B.walkthrough_off=!0,d.savePreferences(B)};var C=function(){b.showCompletedStep=!0};b.openTour=function(){b.showTour=!1,y.open(C),B.walkthrough_off=!0,d.savePreferences(B)},b.hideCompletedStep=function(){b.showCompletedStep=!1},1===l.list.length&&!B.walkthrough_off&&u.innerWidth>750&&(b.showTour=!0),m.setTitle("Arduino Editor"),j.addItem("sketchbookSidebar","sketchbookSidebar/sketchbookSidebar.html","SKETCHBOOK","Editor-Main_Sidebar-Sketchbook"),j.addItem("examplesSidebar","examplesSidebar/examplesSidebar.html","EXAMPLES","Editor-Main_Sidebar-Examples"),j.addItem("librariesSidebar","librariesSidebar/librariesSidebar.html","LIBRARIES","Editor-Main_Sidebar-Libraries"),j.addItem("serialSidebar","serialSidebar/serialSidebar.html","MONITOR","Editor-Main_Sidebar-Serial_Monitor"),j.addItem("helpSidebar","helpSidebar/helpSidebar.html","HELP","Editor-Main_Sidebar-Help"),j.addItem("preferenceSidebar","preferenceSidebar/preferenceSidebar.html","PREFERENCE","Editor-Main_Sidebar-Preferences"),e.toggle("sketchbookSidebar");var D=function(){var a=_.findWhere(i.items,{type:i.SERVER_ISSUE});q.checkIfAlive().success(function(){_.remove(i.items,{type:i.SERVER_ISSUE})}).error(function(){a||i.add("SERVER_ISSUE",{},i.SERVER_ISSUE,-1,!0)}),r(D,1e4)};D(),b.menuItems=j.items();var E=a.$on("prefChanged",function(){F()});b.$on("$destroy",function(){E(),e.toggle(e.currentOpen())});var F=function(){var c=d.current.configuration.user;b.verboseHeight=c.verbose_always_visible?{"min-height":"100px"}:{height:"0px"},a.$emit("verboseChanged")};F(),b.renameItem=function(a){return s(function(c,e){var g="sketch"===a.type||a.primary?"SKETCH":"FILE";g="folder"===a.type?"FOLDER":g;var h={files:null};d.getContainerArray(a,l.tree.files,h),h.files||(h.files=l.tree.files),a.primary&&(a.name=a.name.replace(".ino","")),f.show("rename",{title:n("translate")("RENAME_"+g+"_TITLE"),item:a,name:a.name,parent:h,callback:function(){b.changeName(this).then(function(){c()})}})})},b.changeName=function(a){f.close();var b=a.item.name,c="sketch"===a.item.type?g.removeDot(a.name):a.name;return l.rename(a.item,c).then(function(){i.add("M_SKETCH_RENAME",{sketch_name:b,new_sketch_name:c},i.SUCCESS)}).catch(function(){i.add("M_SKETCH_RENAME_ERROR",{sketch_name:b,new_sketch_name:c},i.ERROR)})},b.createNewTab=function(){var a=g.defaultIno();f.show("rename",{title:n("translate")("NEW_TAB"),name:a.name,item:a,parent:d.currentProject,callback:b.confirmFileCreation})},b.generateSecrets=function(a){var b=z.get(),c=_.findWhere(d.currentProject.files,{name:"arduino_secrets.h"});if(!_.findWhere(d.currentProject.files,{type:"secret"})&&(b&&b.secrets&&0!==b.secrets.length||a||c)){var e=!1;e=z.writeSecrets();var h=_.findWhere(d.currentProject.files,{name:"Secret"});if(h)return void("secret"!==h.type&&f.show("generic",{title:n("translate")("TAB_NAME_CONFLICT"),text:n("translate")("REMOVE_SECRET_NAMED_FILE")}));var i=g.defaultSecret();c&&(d.currentProject.files=_.reject(d.currentProject.files,{name:"arduino_secrets.h"}),d.currentProject.ino.content=d.currentProject.ino.content.replace(/#include\s+"arduino_secrets.h"\s*\n*/,""),e=!0),d.addTabToCurrent(i,e,!0)}},b.confirmFileCreation=function(a){a.item.name=a.name,d.addTabToCurrent(a.item),f.close()},b.exportCurrent=function(){b.exportSketch(d.currentProject)},b.exportCurrentLib=function(){b.downloadLib(d.currentProject)},b.deleteCurrentLib=function(){var a=d.currentProject,c=a.category&&a.types.length;b.deleteLibrary(a,c);var e=l.findFirst();k.go("editor.user.sketch",{uid:p.uid,id:e.id,filename:e.ino.name})},b.exportSketch=function(a){l.exportMultiple([a],a.name).then(function(){i.add("M_EXPORT_SUCCESS",{export_file_name:a.name},i.SUCCESS)}).catch(function(){i.add("M_EXPORT_ERROR",{export_file_name:a.name},i.ERROR)})},b.exportCMake=function(a){a||(a=d.currentProject),f.show("wait",{title:n("translate")("EXPORTING_CMAKE")}),l.load(a).then(function(){var b=angular.copy(a);_.remove(b.files,function(a){return"code"!==a.type||a.primary===!0});var c={fqbn:b.metadata.cpu.fqbn,sketch:{files:b.files,ino:b.ino,metadata:b.metadata,name:b.name},verbose:d.current.configuration.user.verbose};i.add("M_EXPORT_CMAKE_START",{sketch_name:b.name},i.SUCCESS),x.do("export#cmake",{},c).then(function(a){var b=g.b64toBlob(a.data,"application/zip");u.saveAs(b,"arduino_create-cmake.zip"),f.close()}).catch(function(a){console.log(a),i.add("M_EXPORT_CMAKE_ERROR",{sketch_name:b.name},i.ERROR),f.close()})})},b.exportMultiple=function(a){return s(function(b,c){l.exportMultiple(a).then(function(){b(),i.add("M_EXPORT_SUCCESS",{export_file_name:"sketches.zip"},i.SUCCESS)}).catch(function(){i.add("M_EXPORT_ERROR",{export_file_name:"sketches.zip"},i.ERROR)})})},b.deleteFiles=function(a){return s(function(c,d){var e=[];f.show("warning",{title:n("translate")("DELETE_FILES",{number:a.length}),body:n("translate")("DELETE_ALERT"),type:"alert",cancel:!0,callback:function(){f.close(),_.each(a,function(a){e.push(b.fileDeleted(a.file,a.parent))}),s.all(e).then(function(){c()})}})})},b.deleteFile=function(a,c){return s(function(d,e){var g=A(a);f.show("warning",{title:n("translate")("DELETE_"+g+"_TITLE")+" "+a.name,body:n("translate")("DELETE_ALERT"),type:"alert",cancel:!0,callback:function(){f.close(),b.fileDeleted(a,c).then(function(){d()})}})})};var G=function(a,b){var c=_.remove(b,{name:a.name,folder:a.folder});if(0===c.length)for(var d=0;d<b.length;d++)"folder"===b[d].type&&G(a,b[d].files)};b.fileDeleted=function(a,b){var c=A(a);if(!a.href&&"FILE"===c){var e=b.files.indexOf(a);return b.files.splice(e,1),s.resolve(d.setFirstTabAvailable(a))}if(!a.href&&"SKETCH"===c){if(G(a,l.tree.files),_.remove(l.list,{name:a.name,folder:a.folder}),a.id===d.currentProject.id){var f=l.findFirst();k.go("editor.user.sketch.file",{uid:f.owner,id:f.id,filename:f.ino.name})}return s.resolve()}return a.href&&"FILE"===c?l.deletefile(b,a).then(function(){i.add("M_"+c+"_DELETE_SUCCESS",{type_name:a.name},i.SUCCESS),d.setFirstTabAvailable(a,b)}).catch(function(){i.add("M_"+c+"_DELETE_ERROR",{type_name:a.name},i.ERROR)}):a.href&&"SKETCH"===c?l.delete(a).then(function(){i.add("M_"+c+"_DELETE_SUCCESS",{type_name:a.name},i.SUCCESS)}).catch(function(){i.add("M_"+c+"_DELETE_ERROR",{type_name:a.name},i.ERROR)}):"FOLDER"===c?l.delete(a).then(function(){i.add("M_"+c+"_DELETE_SUCCESS",{type_name:a.name},i.SUCCESS)}).catch(function(){i.add("M_"+c+"_DELETE_ERROR",{type_name:a.name},i.ERROR)}):void 0},b.sketchInfo=function(a){l.load(a).then(function(){f.show("info",{title:n("translate")("RENAME_"),item:a})})},b.shareSketch=function(a){f.show("share",{title:n("translate")("SHARE_SKETCH_TITLE"),item:a})},b.makeACopy=function(a){if(100===b.userStats.spaceUsedPercMin||b.userStats.sketches>=b.userStats.limitSketches)f.show("usedSpace",{});else{var c=n("translate")("MAKE_A_COPY");a&&(c=n("translate")("MAKE_A_COPY_EXAMPLE")),f.show("rename",{title:c,item:d.currentProject,parent:l.tree,saveAs:!0,name:d.currentProject.name+"_copy",callback:b.copyInSketchbook,editingExample:a})}},b.copyInSketchbook=function(a){f.close();var b=angular.copy(a.item);b.name=a.name,b.modified=g.getNow(),b.currentFile=null,b.owner=o.uid;var c=d.getPrimaryTab(b);c.name=b.name+".ino","sketchbookSidebar"!==e.currentOpen()&&e.toggle("sketchbookSidebar"),l.copy(b,l.tree).catch(function(a){a.status&&412===a.status?f.show("usedSpace",{}):i.add("M_SKETCH_ERROR",{sketch_name:b.name},i.ERROR)})},b.saveCurrentProject=function(a){var c=d.currentProject;f.close(),l.save(c).then(function(){a||i.add("M_SKETCH_SAVE_SUCCESS",{save_sketch_name:c.name},i.SUCCESS)}).catch(function(a){a.status&&412===a.status?f.show("usedSpace",{}):(console.error(a),i.add("M_SKETCH_SAVE_ERROR",{save_sketch_name:c.name},i.ERROR))}),b.generateSecrets()};var H=function(){var a=d.currentProject;t.load(a).then(function(b){a.files=b.data.files}),i.add("M_LIBRARY_SAVE_SUCCESS",{save_lib_name:a.name},i.SUCCESS)};b.saveCurrentLib=function(){var a=d.currentProject,b=a.category&&a.types.length,c=a.types.indexOf("Arduino")!==-1;_.each(a.files,function(a){a.content&&(g.isTypeBinary(a.mimetype)?a.data=u.unescape(u.encodeURIComponent(a.content)):a.data=u.btoa(u.unescape(u.encodeURIComponent(a.content))))});var e=angular.copy(a);delete e.examples,b||c?t.addCustom(e).then(function(){H()}).catch(function(b){409===b.status?f.show("library-import",{callback:function(){t.addCustom(e,!0).then(function(){H()})}}):(console.error(b),i.add("M_LIBRARY_SAVE_ERROR",{save_lib_name:a.name},i.ERROR))}):t.editCustom(a).then(function(){_.each(a.files,function(b){l.setAsSaved(a.data,b)}),i.add("M_LIBRARY_SAVE_SUCCESS",{save_lib_name:a.name},i.SUCCESS)}).catch(function(b){console.error(b),i.add("M_LIBRARY_SAVE_ERROR",{save_lib_name:a.name},i.ERROR)})},b.build=function(a){var b=d.currentProject;b.compiling=!0,h[a](b).then(function(){b.compiling=!1}).catch(function(){e.openVerbose(),b.compiling=!1})},b.killProcess=function(){h.killCurrent()},b.selectFile=function(a){"example"===d.currentProject.type||!d.currentProject.type||"secret"===a.type||a.path.startsWith(d.currentProject.href)?d.setCurrentFile(a,d.currentProject):k.go("editor.user.sketch.file",{uid:p.uid,id:d.currentProject.id,filename:a.name})},b.downloadLib=function(a){t.export(a).then(function(){i.add("M_EXPORT_SUCCESS",{export_file_name:a.name},i.SUCCESS)}).catch(function(){i.add("M_EXPORT_ERROR",{export_file_name:a.name},i.ERROR)})},b.deleteLibrary=function(a,b){return t.removeLibrary(a).then(function(){b?i.add("M_LIBRARY_REMOVED",{name:a.name},i.SUCCESS):i.add("M_LIBRARY_DELETE",{name:a.name},i.SUCCESS)}).catch(function(){i.add("M_LIBRARY_DELETE_ERROR",{},i.ERROR)})},b.duplicateFile=function(a,c){return a.owner=b.user.uid,l.copy(a,c).catch(function(b){b.status&&412===b.status?f.show("usedSpace",{}):i.add("M_SKETCH_SAVE_ERROR",{save_sketch_name:a.name},b.message)})},b.getSkin=function(){return w.current()}}]),ideapp.controller("examplesSidebarCtrl",["$scope","editor","toggler","boards","$filter","contextMenu","examples","sanity","libraries","modal",function(a,b,c,d,e,f,g,h,i,j){var k,l;a.foundCounter="init",b.loadLibraries().then(function(b){a.dataLoaded=!0,a.tree=b.tree,l=e("retiredLibrary")(i.data.builtin,!0),a.$watch("treeFilter",function(b){b&&b.length?a.foundCounter=0:a.foundCounter="init",o(a.tree.files,b)},!0)});var m;a.type="base",a.sortedBy="name";var n=!0;a.archToggleDisabled=!1,a.changeTo=function(b){a.type=b},a.isOpen=function(){return"examplesSidebar"===c.currentOpen()},a.getItemClass=function(b){return b===a.type?"selected":""},a.rootClass=function(a){return a&&"__root"===a.name?"isRoot":""},a.ifRoot=function(a){return a&&"__root"===a.name},a.isCategory=function(a){return a.category&&"example"!==a.type},a.isCurrentCategory=function(b){return!!a.ifRoot(b)||(!(!b.category||b.category!==a.type)||(!b.category||!a.type))},a.getLabel=function(a){if(a.files&&"example"!==a.type){var b=a.name+" ("+a.sketches_number+")";return b}return a.name},a.getArchFilterLabel=function(){return n&&d.selected?d.getBoardLabelForArchFilter():"FILTER_LIBRARIES_FOR_OPTION_2"},a.toggleArchFilter=function(){n=!n},a.classConversion={sketch:"sketch",folder:"folder",image:"generic_file",text:"generic_file",other:"generic_file",code:"generic_file",example:"sketch"},a.getLiClass=function(b){if(b){var c=a.classConversion[b.type];return c=b.open&&"folder"===b.type?c+" parent_li":c,c=b.active?c+" selected":c,c=b.unsaved?c+" unsaved":c}return""},a.isRetired=function(a){return _.findWhere(l,{name:a.library_name})&&!a.custom},a.toggleChildren=function(a){return a.open&&"example"!==a.type},a.toggle=function(a){"folder"===a.type?a.open=!a.open:"example"===a.type&&b.setCurrentProject(a),f.hide()},a.resetFilterTagRemoved=function(){a.treeFilter&&a.treeFilter.length||!m||(a.type=m)},a.resetFilterTagAdded=function(){a.type&&(m=angular.copy(a.type)),a.type="",n=!1},a.byArchitecture=function(b){var c,e=d.selected;if(e&&e.fqbn){var f=e.fqbn.split(/[:_]+/),g="";f&&f.length>=2&&(g=f[1]),c=g,k||(n=!0),a.archToggleDisabled=!1}else c=void 0,n=!1,a.archToggleDisabled=!0;return k=e,!c||!n||(!b.architectures||(b.architectures.indexOf("*")!==-1||b.architectures.indexOf(c)!==-1))},a.showContextMenu=function(b,c){var d=[{label:e("translate")("DOWNLOAD_EXAMPLE"),separator:!0,remove:"example"!==c.type,clb:function(){a.exportSketch(c)}},{label:e("translate")("RELOAD_EXAMPLE"),remove:"example"!==c.type,disabled:!c.unsaved,clb:function(){g.load(c,!0).then(function(a){c.files=a,c.unsaved=!1})}}];f.show(b.clientX,b.clientY,d,c)};var o=function(b){var c=a.treeFilter;angular.forEach(b,function(b){if(b.notFound=!1,b.open&&(b.open=!1),b.files&&o(b.files),c&&c.length&&(1!==c.length||!c[0].type)){var d,e=!1,f=b.name.toLowerCase(),g=b.path?b.path:b.href;g.indexOf("examples")!==-1&&g.indexOf("libraries")!==-1?d=g.indexOf("libraries")<g.indexOf("examples")?g.split("/libraries/")[1].toLowerCase():g.split("/examples/")[1].toLowerCase():g.indexOf("libraries")!==-1?d=g.split("/libraries/")[1].toLowerCase():g.indexOf("examples")!==-1&&(d=g.split("/examples/")[1].toLowerCase()),angular.forEach(c,function(a){if(a.name){var b=a.name.toLowerCase();d&&f.indexOf(b)===-1&&d.indexOf(b)===-1&&!a.type&&(e=!0),d||f.indexOf(b)!==-1||a.type||(e=!0)}}),b.notFound=e,"folder"!==b.type&&"sketch"!==b.type||(_.where(b.files,{notFound:!1}).length&&b.notFound&&(b.open=!0,b.notFound=!1),b.notFound||0!==_.where(b.files,{notFound:!1}).length||(b.open=!1,angular.forEach(b.files,function(a){a.notFound=!1})),!b.notFound&&_.where(b.files,{notFound:!1}).length&&(b.open=!0))}if(b.architectures){var h=b.architectures;((h.indexOf("i586")!==-1||h.indexOf("i686")!==-1)&&1===h.length||h.indexOf("i586")!==-1&&h.indexOf("i686")!==-1&&2===h.length)&&(b.notFound=!0)}b.notFound===!1&&"number"==typeof a.foundCounter&&a.foundCounter++},c)};a.showSupportedBoards=function(a){j.show("supported-boards",{library:a})}}]),ideapp.controller("librariesSidebarCtrl",["$scope","editor","libraryImporter","libraries","messages","modal","toggler","$filter","contextMenu","boards","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){a.data=d.data;var l=!0;a.archToggleDisabled=!1,a.filtered2={retired:[]};var m={};a.isOpen=function(){return"librariesSidebar"===g.currentOpen()},a.type="builtin";var n,o="builtin";a.changeTo=function(b){a.type=b};var p=function(){a.treeFilter="",a.changeTo("custom")};d.setForceCustomTabCall(p),a.tooltips={install_library_zip:{main:"tooltip.import"}},a.insertLib=function(c){var d="// "+c.name+" - Version: Latest \n",e=d+c.code;b.currentProject.metadata=b.currentProject.metadata||{};var f=b.currentProject.metadata.included_libs=b.currentProject.metadata.included_libs||[],h=_.findWhere(f,{name:c.name});if(h){var i="// "+c.name+" - Version: "+h.version+"\n"+c.code;b.removeLibCode(i),c.pinned_version||_.remove(f,{name:c.name})}if(c.version&&c.pinned_version){if(a.resetDropdown=!0,b.removeLibCode(e),h)h.version=c.version;else{var j={name:c.name,version:c.version};f.push(j)}e=c.pinned_version.description+c.code,delete c.pinned_version,delete m[c.id],k(function(){a.resetDropdown=!1})}b.insertLibCode(e),g.closeMobile()},a.getItemClass=function(b){return b===a.type?"selected":""},a.getArchFilterLabel=function(){return l&&j.selected?j.getBoardLabelForArchFilter():"FILTER_LIBRARIES_FOR_OPTION_2"},a.toggleArchFilter=function(a){l=a?a:!l};var q=function(){a.treeFilter="",a.type=o};a.$watch("uploadedLib",function(){if(a.uploadedLib){var b=a.uploadedLib;c.import(b).then(function(){q(),a.type="custom",l=!1,
a.uploadedLib=null})}}),a.resetFilter=function(){a.treeFilter&&a.treeFilter.length||!o?a.type="all":a.type=o},a.resetFilterOnSearch=function(){a.type&&"all"!==a.type&&(o=angular.copy(a.type)),l=!1,a.type="all"};var r=function(a){var b="",c=a.fqbn.split(/[:_]+/);return c&&c.length>=2&&(b=c[1]),b};a.sortLibs=function(b){return"builtin"===b&&j.selected&&j.selected.fqbn&&r(j.selected).indexOf("mraa")!==-1?a.data.mraa:a.data[b]},a.containsString=function(b){var c,d=!0,e=b.name.toLowerCase(),f="",g=[];return j.selected&&j.selected.fqbn?(c=r(j.selected),n||(l=!0),a.archToggleDisabled=!1):(c=void 0,l=!1,a.archToggleDisabled=!0),n=j.selected,b.sentence&&(f=b.sentence.toLowerCase()),b.architectures&&(g=b.architectures,((b.architectures.indexOf("i586")!==-1||b.architectures.indexOf("i686")!==-1)&&1===b.architectures.length||b.architectures.indexOf("i586")!==-1&&b.architectures.indexOf("i686")!==-1&&2===b.architectures.length)&&(d=!1),c&&l&&g.indexOf("*")===-1&&g.indexOf(c)===-1&&(d=!1)),angular.forEach(a.treeFilter,function(a){var b=a.name;a.name&&(b=a.name.toLowerCase()),e.indexOf(b)!==-1||h("filterLinks")(h("removeATags")(f)).indexOf(b)!==-1||a.type||(d=!1)}),d};var s=function(a,b){return d.removeLibrary(a).then(function(){b?e.add("M_LIBRARY_REMOVED",{name:a.name},e.SUCCESS):e.add("M_LIBRARY_DELETE",{name:a.name},e.SUCCESS)}).catch(function(){e.add("M_LIBRARY_DELETE_ERROR",{},e.ERROR)})};a.showContextMenu=function(b,c){var d=c.types.indexOf("Arduino")!==-1,e=[{label:h("translate")("SUPPORTED_BOARDS"),clb:function(){f.show("supported-boards",{library:c})}},{label:h("translate")("DOWNLOAD_LIBRARY"),clb:function(){a.downloadLib(c)}},{label:c.category&&c.types.length?h("translate")("REMOVE_CONTRIBUTED_LIBRARY"):h("translate")("DELETE_LIBRARY"),remove:d,clb:function(){s(c,c.category&&c.types.length)}}];i.show(b.clientX,b.clientY,e,c,!0)},a.openLibraryManager=function(b){f.show("libraryManager",{search:b,larger:!0,addCallback:function(){a.treeFilter="",a.type="contributed"},removeCallback:function(a){return s(a,!0)}})};var t=function(a,b){return a[0]===b[0]?(a.shift(),b.shift(),t(a,b)):b[0]-a[0]};a.versionSelect=function(b){if(!m[b.id]){var c=b.other_versions.sort(function(a,b){var c=d.parseSemVer(a).split("."),e=d.parseSemVer(b).split(".");return t(c,e)}),e=d.parseSemVer(c[0]);m[b.id]={items:_(c).map(function(c){return{label:"Version "+d.parseSemVer(c),selected:function(){return e===d.parseSemVer(c)},action:function(){var f=d.parseSemVer(c);e=f;var g={name:b.name,version:f,code:b.code,id:b.id};return g.pinned_version={id:c.split("/").slice(-1)[0],description:"// "+b.name+" - Version: "+f+"\n",version:f},a.insertLib(g),!0}}}).value()}}return m[b.id]},a.arrowColor=function(){return"light"===b.current.configuration.user.skin?"#00979D":"#7fcbcd"}}]),ideapp.filter("retiredLibrary",[function(){return function(a,b){var c=[];return angular.forEach(a,function(a){_.isUndefined(a.types)&&(a.types=[]),b&&a.types.indexOf("Retired")!==-1&&c.push(a),b||a.types.indexOf("Retired")!==-1||c.push(a)}),c}}]),ideapp.controller("library_exampleItemCtrl",["$scope","$rootScope","editor","libraries","messages","$filter","contextMenu","examples",function(a,b,c,d,e,f,g,h){a.editor=c,a.hasExamples=a.lib.examples_number>0,a.tree={name:"__root",files:a.lib.examples&&a.lib.examples.length>0?a.lib.examples:[],open:!1},a.toggleExamples=function(){a.tree.open=!a.tree.open},a.getExampleClass=function(a){return a.open?"open":""},a.ifRoot=function(a){return a&&"__root"===a.name},a.isCategory=function(a){return a.category&&"example"!==a.type},a.toggleChildren=function(a){return a.open&&"example"!==a.type},a.isCurrentCategory=function(b){return!!a.ifRoot(b)||(!(!b.category||b.category!==a.type)||!b.category)},a.getLabel=function(a){return a.files&&"example"!==a.type?a.name+" ("+a.files.length+")":a.name},a.toggle=function(b){"folder"===b.type?(b.open=!b.open,a.currentOpen=b.open?b:null):"example"===b.type&&a.editor.setCurrentProject(b)},a.classConversion={example:"sketch",folder:"folder",image:"generic_file",text:"generic_file",other:"generic_file",code:"generic_file"},a.getLiClass=function(b){if(b){var c=a.classConversion[b.type];return c=b.open&&"folder"===b.type?c+" parent_li":c,c=b.active?c+" selected":c,c=b.unsaved?c+" unsaved":c}return""},a.showExampleContextMenu=function(b,c){var d=[{label:f("translate")("DOWNLOAD_EXAMPLE"),separator:!0,remove:"example"!==c.type,clb:function(){a.exportSketch(c)}},{label:f("translate")("RELOAD_EXAMPLE"),remove:"example"!==c.type,disabled:!c.unsaved,clb:function(){h.load(c,!0).then(function(a){c.files=a,c.unsaved=!1})}}];g.show(b.clientX,b.clientY,d,c)}}]),ideapp.controller("mainEditorSidebarCtrl",["$scope","toggler",function(a,b){a.getItemClass=function(a){return b.currentOpen()===a?"selected":""}}]),ideapp.controller("outputCtrl",["$scope","$timeout","verbose","editor","messages","deviceInfo",function(a,b,c,d,e,f){a.browser=f.browser.getBrowser(),a.getLog=function(){var a=d.currentProject.id||d.currentProject.path;return c.output[a]||[]},a.numElements=function(){return a.getLog().length},a.copyToClip=function(){e.add("COPIED_VERBOSE_LOG",{},e.SUCCESS)},a.copyToClipError=function(){e.add("COPIED_SAFARI",{},e.SUCCESS)},a.getFontSizeProp=function(){var a={size:d.current.configuration.user.font_size};return{"font-size":a.size+"px"}}}]),ideapp.controller("preferenceSidebarCtrl",["$scope","$rootScope","$timeout","sanity","editor","skin","messages","ace","$filter","_","modal","keyboard",function(a,b,c,d,e,f,g,h,i,j,k,l){a.pref=angular.copy(e.current.configuration.user),f.setFontSize(a.pref.font_size),a.pref.font_size=Number(a.pref.font_size)?Number(a.pref.font_size):13;var m=["light","dark"];a.themeSelect={label:a.pref.skin?i("translate")(a.pref.skin.toUpperCase()+"_THEME"):i("translate")("LIGHT_THEME"),items:j(m).map(function(b){return{label:i("translate")(b.toUpperCase()+"_THEME"),selected:function(){return b===f.current()},action:function(){return a.changeSkin(b),!0}}}).value()},a.savePref=function(){var b;return e.savePreferences(a.pref).then(function(){e.current.configuration.user=angular.copy(a.pref),b&&b()}).catch(function(){a.pref=angular.copy(e.current.configuration.user),g.add("M_SAVE_PREFS",g.ERROR)}),this.done=function(a){return b=a,this},this},a.setVerboseAlwaysVisible=function(){a.savePref().done(function(){b.$emit("prefChanged")})};var n=function(){var b=a.pref.skin||"light";f.set(b),h.setTheme(b),a.pref.skin=b},o=function(){var b=a.pref.font_size;f.setFontSize(b),h.setFontSize(b)},p=b.$on("aceInstanceReady",function(){c(n),c(o)});a.$on("$destroy",function(){p()}),h.inited&&(n(),o()),a.changeSkin=function(b){a.pref.skin=b,n(),a.savePref()},a.changeFontSize=function(){setTimeout(o,300),a.savePref()},a.openHelp=function(){k.show("help",{callback:function(){k.hide()}})},a.openLimitsModal=function(){k.show("usedSpace",{})};var q=b.$on("keyShortCut",function(b,c){k.alert.visibility||c.intent===l.SHORTCUTS&&a.openHelp()});a.$on("$destroy",function(){q()})}]),ideapp.controller("helpSidebarCtrl",["$scope","Coachmarks",function(a,b){a.type="tutorials",a.openTour=function(){b.open()}}]),ideapp.controller("referenceSidebarCtrl",["$scope","$rootScope","reference",function(a,b,c){a.refService=c;var d="structure",e=b.$on("sidebarOpen",function(a,b){"referenceSidebar"===b&&c.loadRef("index.html")}),f=b.$on("sidebarClose",function(a,b){"referenceSidebar"===b&&c.loadRef("index.html")});a.$on("$destroy",function(){e(),f()}),a.parseContent=function(){c.isIndex()?angular.element(".reference > div").each(function(a,b){b=angular.element(b),b.is("#"+d)||b.hide()}):angular.element("img",".reference").each(function(a,b){b=angular.element(b);var d=b.data("src").replace(/(?!http)(.+)/,c.baseUrl()+"$1");b.attr("src",d)})},a.showSection=function(b){c.loadRef("index.html"),a.parseContent(),angular.element(".reference > div").hide(),angular.element("#"+b,".reference").show(),d=b},a.moveToPage=function(a){c.loadRef(a)},a.hasMeta=function(a){return a=a.toLowerCase(),!(!c.isIndex()||a!=d)||c.hasMeta(a)}}]),ideapp.controller("secondaryToolbarCtrl",["$scope","editor","progress",function(a,b,c){a.editor=b,a.getProgress=function(){var a=b.currentProject.id||b.currentProject.path;return c.items[a]},a.getMessage=function(){var b=a.getProgress();return b?b.message:""},a.goToSecret=function(){var a=_.findWhere(b.currentProject.files,{type:"secret"});b.setCurrentFile(a,b.currentProject)}}]),ideapp.controller("serialSidebarCtrl",["$scope","SerialPortManager","boards","$filter","_","editor","messages","deviceInfo","toggler",function(a,b,c,d,e,f,g,h,i){a.__autoscroll=!0,a.freezed=function(){return b.getFreezeStatus()};var j=!1;a.browser=h.browser.getBrowser(),a.userConnectedStatus=function(){return b.getUserStatus()},a.cloudDeviceSelected=function(){return c.selected&&"cloud"===c.selected.type};var k=[{label:d("translate")("NO_LINE_ENDING"),data:""},{label:d("translate")("NEWLINE"),data:"\n"},{label:d("translate")("CARRIAGE_RETURN"),data:"\r"},{label:d("translate")("BOTH_NL_&_CR"),data:"\r\n"}];f.currentProject.serial_endln="\n",a.lineEndingsSelect={items:e(k).map(function(a){return{label:a.label,selected:function(){return a.data===f.currentProject.serial_endln},action:function(){return f.currentProject.serial_endln=a.data,b.setLineEnding(a.data),!0}}}).value()};var l=[300,1200,2400,4800,9600,19200,38400,57600,115200];f.currentProject.serial_baud=9600,a.baudRatesSelect={items:e(l).map(function(a){return{label:a+" baud",selected:function(){return a===f.currentProject.serial_baud},action:function(){return f.currentProject.serial_baud=a,b.setBaudrate(a),!0}}}).value()},a.$watch(function(){return c.isDisconnected(c.selected)},function(a){a||b.open().then(function(){j=!1},function(a){a&&a.indexOf("Serial port busy")!==-1&&(j=!0)})}),a.$watch(function(){return c.selected},function(e,f){if(e&&e.com_name&&("serial"===e.type||"cloud"===e.type)){!f||e.com_name===f.com_name&&e.name===f.name||b.close().then(function(){b.open().then(function(){j=!1},function(a){a&&a.indexOf("Serial port busy")!==-1&&(j=!0)})});var g=c.getBoardName(e);a.boardSelected=g.name,a.portSelected=e.com_name}else a.boardSelected=d("translate")("UNKNOWN_SERIAL_PORT"),a.portSelected=void 0,j=!1},!0),a.$watch(function(){return i.currentOpen()},function(a){"serialSidebar"===a?b.open(!0).then(function(){j=!1},function(a){a&&a.indexOf("Serial port busy")!==-1&&(j=!0)}):b.close()},!0),a.closeSerial=function(){b.disconnect()},a.openSerial=function(){b.connect()},a.uploadInProgress=function(){return b.getUploadStatus()},a.getFreezedStatus=function(){return j===!0?"other-software":b.getUploadStatus()===!0?"uploading":"disconnected"},a.send=function(c){b.send(c),a.message=""},a.copyToClip=function(){g.add("COPIED_SERIAL_LOG",{},g.SUCCESS)},a.copyToClipError=function(){g.add("COPIED_SAFARI",{},g.SUCCESS)}}]),ideapp.directive("serialOutput",["SerialPortManager","$interval","$timeout",function(a,b,c){return{restrict:"A",scope:{portSelected:"="},link:function(d,e,f){c(function(){$(e).slimScroll({alwaysVisible:!0,height:"auto"}).bind("slimscroll",function(){"false"===f.autoscroll&&e.val(a.output())})}),$(window).on("resize.doResize",_.debounce(function(){$(e).slimScroll({height:"auto"})},100)),d.$watch(function(){return a.getFreezeStatus()},function(a){a===!0&&e.val("")}),d.$watch(function(){return d.portSelected},function(a,b){a!==b&&e.val("")}),$(e).on("mousewheel DOMMouseScroll",function(){"false"===f.autoscroll&&e.val(a.output())});var g=b(function(){""!==a.output()&&("true"===f.autoscroll||a.output().length<5e3)&&e.val(a.output())},64);d.$on("$destroy",function(){b.cancel(g),$(e).slimScroll({destroy:!0})})}}}]),ideapp.controller("sketchbookSidebarCtrl",["$scope","$state","$stateParams","editor","modal","contextMenu","$filter","sketchBookImporter","messages","sketches","bulkAction","$q","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){if(b.length){var c=_.find(a,{type:"folder",name:b.shift()}).files;return n(c,b)}return a}function o(b){var c=[];return _.each(b,function(a){var b=a.type.toUpperCase();u.indexOf(b)===-1&&(b="FILE"),c.push({file:a,parent:x(a,b)})}),a.deleteFiles(c)}function p(b){return b=q(b),l(function(c,d){var f=[];_.each(b,function(a){f.push(x(a,"SKETCH"))}),e.show("where",{title:g("translate")("FB_MOVE_MULTIPLE_FILE",{number:b.length}),okLabel:g("translate")("MOVE"),item:b,tree:j.tree,parent:f,orderingFunc:a.sketchComparator,orderType:a.order,callback:function(a){var d=[];_.each(b,function(b){d.push(j.move(b,a.target))}),l.all(d).then(function(){e.close(),c()}).catch(function(a){e.show("warning",{title:g("translate")("ERROR_WHILE_MOVING"),body:g("translate")(a),type:"alert",cancel:!1,callback:function(){e.hide()}})})}})})}function q(a){var b=[];return _.each(a,function(c){var d=_.last(c.folder.split("/"));_.some(a,{name:d,type:"folder"})||b.push(c)}),b}a.editor=d,a.tree=j.tree,a.bulkSelection=k.selection;var r=d.current.configuration.user.show_all_content;a.foundCounter="init",a.tooltips={newFolder:{main:"tooltip.new_folder"},import:{main:"tooltip.import"},L:{main:"tooltip.linux_sketch"},A:{main:"tooltip.arduino_sketch"}};var s=function(b){a.treeFilter&&a.treeFilter.length?a.foundCounter=0:a.foundCounter="init",y(j.tree.files,b)};a.$watch("treeFilter",function(){s()},!0),a.newFolder=function(b){return l(function(c,d){var f=b?b:j.tree;e.show("rename",{title:g("translate")("NEW_FOLDER"),parent:f,name:"",item:{type:"folder"},callback:function(){a.confirmNewFolder(this),c()}})})},a.confirmNewFolder=function(a){e.close();var b=a.name,c=a.parent.name?a.parent:null;j.createFolder(b,c),i.add("M_FOLDER_CREATE_SUCCESS",{folderName:b},i.SUCCESS)},a.showImportInstruction=function(){return!(1!==a.tree.files.length||!a.foundCounter||"sketch"!==a.tree.files[0].type)},a.$watch("uploadedSketch",function(){a.uploadedSketch&&h.import(a.uploadedSketch)}),a.createNewSketch=function(){100===a.userStats.spaceUsedPercMin||a.userStats.sketches>=a.userStats.limitSketches?e.show("usedSpace",{}):j.addTemporarySketch().then(function(){s()}).catch(function(a){a.status&&412===a.status&&e.show("usedSpace",{})})},a.checkView=function(a){return r=d.current.configuration.user.show_all_content,r?a:"sketch"===a.type||"folder"===a.type&&a.hasSketch?a:null},a.sortedBy="modified",a.order="modified"===a.sortedBy,a.getSortingLabel=function(){return"modified"===a.sortedBy?"LAST_MODIFIED":"NAME"},a.toggleSorting=function(){a.sortedBy="name"===a.sortedBy?"modified":"name",a.order="modified"===a.sortedBy};var t=function(a,b){return _.each(a.files,function(a){"folder"===a.type?b=b.startsWith("9")?t(a,b):"9"+t(a,b):"9"+a.modified>b&&(b="9"+a.modified)}),b};a.sketchComparator=function(b){if("modified"===a.sortedBy){if("folder"===b.type){var c=t(b,"91970-01-01T00:00:00.000Z");return c}return b.modified}if("name"===a.sortedBy){var d=b.name;return d=d.toLowerCase(),"folder"===b.type?"0"+d:d}},a.ifRoot=function(a){return a?"__root"===a.name:null},a.rootClass=function(a){return a&&"__root"===a.name?"isRoot":""},a.getLabel=function(a){return a.files&&"sketch"!==a.type&&!a.error?a.name+" ("+a.sketches_number+")":a.name},a.classConversion={sketch:"sketch",folder:"folder",secret:"generic_file",image:"generic_file",text:"generic_file",other:"generic_file",code:"generic_file"},a.getLiClass=function(b){if(b){var c=a.classConversion[b.type];return c=b.open&&"folder"===b.type?c+" parent_li":c,c=b.active?c+" selected":c,c=b.unsaved?c+" unsaved":c,c=b.compiling?c+" busy":c,c=b.ctx_menu?c+" ctx_menu_open":c,c=b.error?c+" error":c}return""},a.toggleChildren=function(a){return a.open},a.toggle=function(d){d.error||("folder"===d.type?(d.open=!d.open,a.currentOpen=d.open?d:null):"sketch"===d.type?(d.open=!d.open,b.go("editor.user.sketch",{uid:c.uid,id:d.id,filename:d.ino.name})):"sketch"===d.parent_type&&b.go("editor.user.sketch.file",{uid:c.uid,id:d.sketchID,filename:d.name}),f.hide(!0))},a.toggleAllChildren=function(b,c){if("folder"===b.type){var d;d=_.isUndefined(c)?!b.open:c,b.open=d,_.each(b.files,function(b){a.toggleAllChildren(b)})}},a.prepareFB_move=function(b){return l(function(c,d){var f="sketch"===b.type||"folder"===b.type?b.type:"file",h=f.toUpperCase(),i=x(b,h);e.show("where",{title:g("translate")("FB_MOVE_FILE",{filename:b.name,filetype:f}),okLabel:g("translate")("MOVE"),item:b,tree:j.tree,parent:i,orderingFunc:a.sketchComparator,orderType:a.order,callback:function(a){j.move(b,a.target).then(function(){e.hide(),c()}).catch(function(a){if(412===a.status)e.show("usedSpace",{});else{var b=g("translate")(a);a.statusText&&(b=g("translate")(a.statusText)),e.show("warning",{title:g("translate")("ERROR_WHILE_MOVING"),body:b,type:"alert",cancel:!1,callback:function(){e.hide(),c()}})}})}})})};var u=["SKETCH","FOLDER","FILE"],v=function(a){var b=[];return j.tree.files.forEach(function(c){"folder"===c.type&&"libraries"!==c.name&&a.name!==c.name&&b.push(c)}),b},w=function(a){var b=v(a);return!b.length},x=function(a,b){var c={files:null};return"FILE"===b&&(c=j.findById(a.sketchID)),d.getContainerArray(a,j.tree.files,c),c};a.showContextMenu=function(b,c){if(0===a.bulkSelection.length){var d=c.type.toUpperCase();u.indexOf(d)===-1&&(d="FILE");var h=[{label:g("translate")("DUPLICATE_"+d),disabled:c.unsaved,clb:function(){if(100===a.userStats.spaceUsedPercMin||a.userStats.sketches>=a.userStats.limitSketches)e.show("usedSpace",{});else{var b=x(c,d);a.duplicateFile(c,b).then(function(){s(!0)})}}},{label:g("translate")("RENAME_"+d),clb:function(){a.renameItem(c).then(function(){s(!0)})}},{label:g("translate")("EXPORT_"+d),remove:"SKETCH"!==d,clb:function(){a.exportSketch(c)}},{label:g("translate")("EXPORT_CMAKE"),disabled:!c.metadata||!c.metadata.cpu||"arduino:mraa:intel_x86_64"!==c.metadata.cpu.fqbn&&"arduino:mraa:up2"!==c.metadata.cpu.fqbn,remove:"SKETCH"!==d,clb:function(){a.exportCMake(c)}},{label:g("translate")("SHARE_SKETCH"),remove:"SKETCH"!==d,clb:function(){a.shareSketch(c)}},{label:g("translate")("MOVE_"+d),remove:"FILE"===d,disabled:c.unsaved||w(c),clb:function(){a.prepareFB_move(c).then(function(){s(!0)})}},{label:g("translate")("DISPLAY_"+d+"_INFO"),remove:"SKETCH"!==d,clb:function(){a.sketchInfo(c)}},{label:g("translate")("DELETE_"+d),clb:function(){var b=x(c,d);a.deleteFile(c,b).then(function(){s(!0)})},separator:!0,disabled:c.primary},{label:g("translate")("NEW_FOLDER"),remove:"FOLDER"!==d,clb:function(){a.newFolder(c).then(function(){s(!0)})}},{label:g("translate")("NEW_SKETCH"),remove:"FOLDER"!==d,clb:function(){100===a.userStats.spaceUsedPercMin||a.userStats.sketches>=a.userStats.limitSketches?e.show("usedSpace",{}):j.addTemporarySketch(null,null,c).then(function(){s(!0)})}},{label:g("translate")("IMPORT_FILE",{type:g("translate")(d)}),uploadFile:"uploadFile",target:c,remove:"SKETCH"!==d}];f.show(b.clientX,b.clientY,h,c)}};var y=function(b,c){var e=a.treeFilter;r=d.current.configuration.user.show_all_content,angular.forEach(b,function(b){if(b.notFound=!1,b.open&&!c&&(b.open=!1),b.files&&y(b.files),e&&e.length){var d=!1,f=b.name.toLowerCase();r=!0,angular.forEach(e,function(a){if(a.name){var b=a.name.toLowerCase();f.indexOf(b)===-1&&(d=!0)}}),b.notFound=d,"folder"!==b.type&&"sketch"!==b.type||b.notFound&&!_.where(b.files,{notFound:!1}).length||(_.where(b.files,{notFound:!1}).length&&b.notFound&&(b.open=!0,b.notFound=!1),0!==_.where(b.files,{notFound:!1}).length||b.notFound||(b.open=!1,angular.forEach(b.files,function(a){a.notFound=!1})),!b.notFound&&_.where(b.files,{notFound:!1}).length&&(b.open=!0)),b.notFound===!1&&a.foundCounter++}},e)};a.itemSelected=function(a){return k.isSelected(a)},a.selectItem=function(b,c){if(b.shiftKey===!1)a.doSelectItem(c);else{var d=k.getLastSelection();if(_.isUndefined(d))return void a.doSelectItem(c);var e="__root"===d.folder?"":d.folder,f="__root"===c.folder?"":c.folder;if(e!==f)return;a.bulkDeselect();var g;g=""===d.folder||"__root"===d.folder?[]:d.folder.split("/");var h=n(a.tree.files,g);h=_.sortBy(h,a.sketchComparator);var i,j,l=[];for(var m in h)if(j){if(l.push(h[m]),i.id===h[m].id)break}else h[m].id===d.id&&(i=c,j=!0,l.push(h[m])),h[m].id===c.id&&(i=d,j=!0,l.push(h[m]));_.each(l,function(b){a.doSelectItem(b)})}},a.doSelectItem=function(b){k.toggleItem(b,a.tree.files),a.toggleAllChildren(b,a.itemSelected(b))},a.bulkDelete=function(){o(k.selection).then(function(){a.bulkDeselect(),s(!0)})},a.bulkMove=function(){p(k.selection).then(function(){a.bulkDeselect(),s(!0)})},a.bulkExport=function(){a.exportMultiple(k.selection).then(function(){k.deselectAll()})},a.bulkDeselect=function(){k.deselectAll()},a.moveDisabled=function(){var a=!1;return _.each(k.selection,function(b){var c="sketch"===b.type||"folder"===b.type?b.type:"file";"file"===c&&(a=!0)}),a?"disabled":""};var z=m.$on("keyShortCut",function(b,c){"esc"===c.intent&&a.bulkDeselect()});a.$on("$destroy",function(){z()})}]),ideapp.controller("tabBarCtrl",["$scope","editor",function(a,b){a.editor=b,a.initImportButton=!1,a.totalTabs=5,a.renameItemFromTab=function(c){var d=b.currentProject;if("secret"!==c.type)return"example"===d.type?void a.makeACopy():void("sketch"===d.type&&(c.primary?a.renameItem(d):a.renameItem(c)))},$(window).on("resize.doResize",_.debounce(function(){a.$apply()},100)),a.getTabClass=function(c){var d=b.currentProject.currentFile.name===c.name&&b.currentProject.currentFile.type===c.type?"selected":"";d=c.unsaved?d+" unsaved":d,d=c.saving?d+" saving":d;var e=b.currentProject.files.indexOf(b.currentProject.currentFile),f=b.currentProject.files.indexOf(c),g=0,h=0;window.innerWidth<=1475&&(a.totalTabs=5),window.innerWidth<1235&&(a.totalTabs=4),window.innerWidth<625&&(a.totalTabs=3),window.innerWidth<486&&(a.totalTabs=2),window.innerWidth<408&&(a.totalTabs=1),window.innerWidth>1475&&(a.totalTabs=6),window.innerWidth>1648&&(a.totalTabs=7),window.innerWidth>1820&&(a.totalTabs=8),a.totalTabs=Math.min(a.totalTabs,b.currentProject.files.length);var i=h+a.totalTabs-1;return e>i?(g=e-i,h+=g,i+=g):e<h&&(g=h-e,h-=g,i-=g),(f<h||f>i)&&(d+=" remove"),d},a.deleteTab=function(){a.deleteFile(b.currentProject.currentFile,b.currentProject)},a.isPrimary=function(){var a=b.currentProject,c=a.currentFile;return c?c.primary:null},a.isSecret=function(){var a=b.currentProject,c=a.currentFile;return"secret"===c.type},a.hasSecret=function(){return _.findWhere(b.currentProject.files,{type:"secret"})}}]),ideapp.controller("toolBarCtrl",["$filter","$rootScope","$scope","boards","editor","modal","Os","progress","boardMetadata","keyboard","sketches","$timeout","daemon","toggler","$window","localStorageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){var b=angular.copy(d.connected);return b.push({label:a("translate")("SELECT_OTHER_BOARD"),action:function(){return f.show("target",{hardwarePorts:s,chromeOsOnlyCompile:t}),!1}}),b.sort(function(a,b){return a.info<b.info?-1:a.info>b.info?1:0}),b}c.editor=e,c.progress=h,c.isMac=g.isMac(),c.isWin=!g.isMac();var r=!1;c.showChromeOsWarningMessage=function(){return!m.disconnected()&&g.isChromeOs()&&!r},c.hideChromeOsWarningMessage=function(){r=!0},c.boards=d;var s,t;d.initHardwarePorts().then(function(){s=d.chromeOsSupported?d.chromeOsSupported:d.hardwarePorts,t=d.chromeOsOnlyCompile;var a={name:" Board"};c.mobileHardwarePorts=angular.copy(s),c.mobileHardwarePorts.push(a),c.mobileBoardSelected=a}),c.selectBoard=function(a){d.select(a)},c.boardSelect={label:a("translate")("SELECT_TARGET"),items:q()};var u,v=function(a){var b=d.searchSameName(a.cpu);b&&d.select(b.val)};c.$watch(function(){return i.get()},function(b,e){var f=b;if(f&&f.cpu&&(""!==f.cpu.name||""!==f.cpu.fqbn||""!==f.cpu.com_name)?(f.cpu.unknown?(d.saveUnsupported(f.cpu),c.boardSelect.label="Board"):(c.boardSelect.label=d.getBoardName(f.cpu).name,c.boardSelect.disconnected=d.isDisconnected(f.cpu),c.boardSelect.disconnected&&v(f)),c.boardSelect.port=f.cpu.com_name):(d.resetSelect(),c.boardSelect.label=a("translate")("SELECT_TARGET"),c.boardSelect.disconnected=!1),b&&e&&!angular.equals(b.secrets,e.secrets)&&"example"!==c.editor.currentProject.type){var g=c.editor.current.configuration.user.autosave;g&&(clearTimeout(u),u=setTimeout(function(){c.saveCurrentProject(!0)},500))}},1),c.$watch("boards.connected",function(){var a=i.get();if(c.boardSelect.items=q(),a&&a.cpu)c.boardSelect.disconnected=d.isDisconnected(a.cpu),c.boardSelect.disconnected&&v(a);else{var b=_.findWhere(d.connected,function(a){return"serial"===a.val.type}),e=p.get("up2-name");if(e){var f=_.findWhere(d.connected,function(a){return"cloud"===a.val.type&&a.val.name===e});if(!f)return;b=f,p.remove("up2-name")}b||(b=_.findWhere(d.connected,function(a){return"network"===a.val.type})),b&&d.select(b.val)}},!0),c.tooltips={verify:{main:"tooltip.verify_save",shortcut:"E"},upload:{main:"tooltip.upload_save",shortcut:"U"},rename:{main:"tooltip.rename"}};var w=function(a){a===!1?(c.tooltips.verify.main="tooltip.verify",c.tooltips.upload.main="tooltip.upload"):(c.tooltips.verify.main="tooltip.verify_save",c.tooltips.upload.main="tooltip.upload_save")};w(e.current.configuration.user.save_on_build),c.$watch(function(){return e.current.configuration.user.save_on_build},function(a){void 0!==a&&w(a)}),c.$watch(function(){return e.currentProject.type},function(a){w(void 0!==a&&"example"===a?!1:e.current.configuration.user.save_on_build)}),c.getClassStatus=function(a){return a&&a.online?"online":"offline"},c.getDropStatus=function(){var a=e.currentProject;return!("sketch"===a.type||"example"===a.type)},c.checkButtonStatus=function(a){var b=!1,c=e.currentProject;if(c){switch(a){case"verify":b=!1;break;case"upload":b=m.disconnected()&&e.currentProject.metadata&&e.currentProject.metadata.cpu&&"cloud"!==e.currentProject.metadata.cpu.type;break;case"interrupt":b=e.currentProject.uploading&&"network"===e.currentProject.metadata.cpu.type;break;case"info":b=!1;break;case"rename":b=!1;break;case"share":b=!1;break;case"delete":b=!1;break;case"export":b=!1;break;case"cmake":b=!e.currentProject.metadata||!e.currentProject.metadata.cpu||"arduino:mraa:intel_x86_64"!==e.currentProject.metadata.cpu.fqbn&&"arduino:mraa:up2"!==e.currentProject.metadata.cpu.fqbn}b="sketch"!==c.type&&"example"!==c.type||b}return b},c.checkLibButtonStatus=function(){return!!e.currentProject.types&&e.currentProject.types.indexOf("Arduino")!==-1},c.isContributed=function(){return e.currentProject.category&&e.currentProject.types.length},c.showSketchInfo=function(){c.sketchInfo(e.currentProject)},c.showShareSketch=function(){c.shareSketch(e.currentProject)},c.renameItemFromTool=function(){var a=e.currentProject;return"example"===a.type?void c.makeACopy():void c.renameItem(a)},c.deleteSketchFromTool=function(){c.deleteFile(e.currentProject)},c.getBtnProgress=function(a){return c.actualBtnProgress===a?"progress":""},c.saveCurrent=function(){var a=e.currentProject;return"example"===a.type?void c.makeACopy():void c.saveCurrentProject()},c.saveCurrentAs=function(){var b=e.currentProject,d={files:null};e.getContainerArray(b,k.tree.files,d),d.files||(d.files=k.tree.files),f.show("rename",{title:a("translate")("SAVE_AS"),item:b,name:b.name+"_copy",parent:d,callback:c.onSaveAs})},c.onSaveAs=function(a){a.item.temporary?(c.changeName(a),c.saveCurrent()):c.copyInSketchbook(a)},c.getProgressLabel=function(){return h.interrupting?(angular.element("#closeIcon").removeClass("displayInlineBlock"),a("translate")("ABORTING_PROGRESS")):c.ismouseover?(angular.element("#closeIcon").addClass("displayInlineBlock"),a("translate")("WORKING_PROGRESS")):(angular.element("#closeIcon").removeClass("displayInlineBlock"),a("translate")("WORKING_PROGRESS"))};var x=b.$on("keyShortCut",function(a,b){if(b.intent===j.ESC&&l(function(){f.close()}),!f.alert.visibility){if(b.intent===j.SAVE&&("sketch"!==e.currentProject.type&&"example"!==e.currentProject.type?c.saveCurrentLib():c.saveCurrent()),"sketch"!==e.currentProject.type&&"example"!==e.currentProject.type||(b.intent===j.SAVE_AS&&c.saveCurrentAs(),b.intent===j.VERIFY&&c.build("verify"),b.intent===j.UPLOAD&&c.build("upload"),b.intent===j.NEW_TAB&&c.createNewTab()),b.intent===j.INFO&&"sketch"===e.currentProject.type&&c.showSketchInfo(),b.intent===j.DUPLICATE){var d={files:null};e.getContainerArray(e.currentProject,k.tree.files,d),c.duplicateFile(e.currentProject,d)}b.intent===j.NEW_TAB&&c.createNewTab(),b.intent===j.SERIAL&&n.toggle("serialSidebar"),b.intent===j.PREFERENCE&&n.toggle("preferenceSidebar")}});c.$on("$destroy",function(){x()}),c.getLibraryHeader=function(){return a("translate")("LIBRARY_EDIT_HEADER",{libname:e.currentProject.name})},c.showRunStopButton=function(){var a=d.selected,b=e.currentProject;return!!(a&&a.thing&&a.thing.status&&a.thing.status.sketches&&a.thing.status.sketches[b.id])},c.toMyDevices=function(){o.open("/devices/"+d.selected.com_name)}}]),ideapp.controller("gettingStartedCtrl",["$scope","PageTitle","$window",function(a,b,c){b.setTitle("Arduino Getting Started"),a.goToCloudGS=function(){c.location="http://cloud.arduino.cc/cloud/getting-started"}}]),ideapp.controller("gettingStartedCreateCtrl",["$scope","$state","$window","$filter","daemon","$timeout","$http","$location","AuthService","deviceInfo","$rootScope","CreateUserService","config",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=c.navigator.userAgent,o=j.browser.getBrowser(),p=h.search();k.bootstrappedNoLogin=!0,a.stepFirefoxButtonDisabled=!1;var q="https://chrome.google.com/webstore/detail/"+m.chromeExtensionIds[0];a.pluginOnChromeStoreTextVar={chromeAppLink:q},a.currentStep=p.page||1,a.newsletterSubscribe={flagValue:!1};var r={file_name:""};a.pluginNotFound=!1,a.certificateInstalled=!0;var s,t,u={windows:"ArduinoCreateAgent-1.1-windows-installer.exe",mac:"ArduinoCreateAgent-1.1-osx-installer.dmg ",linux:"ArduinoCreateAgent-1.1-linux-x64-installer.tar.gz"};a.homeUrl=h.host(),a.goToStep=function(b){a.currentStep=b};var v=function(){var a={windows:/windows/i,mac:/mac/i,linux:/linux/i,chromeos:/cros/i};for(var b in a)if(a[b].test(n))return r.file_name=u[b],b;return"unknown"};a.architecture=v();var w="chrome"===o&&"mac"!==a.architecture,x=function(){"https"===h.protocol()&&"chromeos"!==a.architecture?i.logout(h.absUrl().replace("https","http")+"?page=2"):a.currentStep=2};a.goToStep2=function(){a.newsletterSubscribe.flagValue?l.getUserInfo().then(function(a){g.post("https://www.arduino.cc/subscribe.php",{lists:["arduino_create_betatesting_newsletter_id"],email:a.email}).then(function(){console.log("subscribed to newsletter"),x()},function(){console.log("an error occurred, let's retry"),g.post("https://www.arduino.cc/subscribe.php",{lists:["arduino_create_betatesting_newsletter_id"],email:a.email}).then(function(){x()},function(){x()})})},function(){x()}):x()},a.goToHome=function(){return!w||a.certificateInstalled?void(c.location=b.href("home",{},{absolute:!0})):void a.goToStep("restartchrome")},a.archCapitalized={os_name:d("capitalize")(a.architecture)};var y=function(b){e.checkHttps(b).then(function(){a.certificateInstalled=!0,a.goToStep(4)},function(){a.certificateInstalled=!1,t=f(function(){y(b)},800)})};a.setArchitecture=function(b){a.architecture=b,r.file_name=u[b],a.archCapitalized.os_name=d("capitalize")(a.architecture)},a.goToStep3=function(b){b&&(c.location="//downloads.arduino.cc/CreateBridgeStable/"+r.file_name),a.goToStep(3);var d=!1,g=0,i=function(){d?f.cancel(s):(90===g&&(a.setPluginNotFoundView(),g=0,i()),g++,s=f(i,1e3))};i();var j=h.protocol();e.findService(j,8989,100).then(function(b){g<6?(e.stopDaemon(b.http),e.findService(j,8989,100).then(function(b){"firefox"===o?(a.certLink=e.firefoxCert(b.http),a.goToStep("certificate")):(d=!0,a.goToStep(4),w&&y(b.https))})):"firefox"===o?(a.certLink=e.firefoxCert(b.http),a.goToStep("certificate")):(d=!0,a.goToStep(4),w&&y(b.https))},function(){console.log("failed")})},a.setPluginNotFoundView=function(){a.pluginNotFound=!0},a.$on("$destroy",function(){f.cancel(s),f.cancel(t)}),a.checkHttps=function(){a.stepFirefoxButtonDisabled=!0;var b,d;e.findService(h.protocol(),8989,100).then(function(a){return b=a.http,d=a.https,e.checkHttps(d)}).then(function(){a.goToStep(4)},function(){
c.location=e.firefoxCert(b),y(d)})},a.restartNow=function(){var b="chrome";"linux"===a.architecture&&(b="chrom"),e.restartBrowser(b,h.host()+"/setup-done")},a.goToChromeApp=function(){c.location=q}}]),ideapp.controller("gettingStartedDeviceCtrl",["$scope","$q","AuthService","CreateUserService","modal","localStorageService","daemon","devices","things","$window","$filter","Thing","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){return b(function(b,c){e.show("devicePassword",{cancel:!0,passError:q,sshError:r,disableBackdropClose:!0,values:a.values,callback:function(c){a.values=c,e.hide(),b()},undo:function(){e.hide(),c("canceled")}})})}function o(a,d){return c.token().then(function(c){var e={board:"connector",port:a.ipAddress,auth_user:a.username,auth_pass:a.password,auth_key:a.sshKey,auth_port:a.sshPort,network:!0,ssh:!0},f="#!/bin/bash\n\n";f+="export id="+d.id+"\n",f+="export token="+c.token+"\n",f+="export password='"+a.password+"'\n",t(a),a.httpProxy&&(f+="export http_proxy=http://"+a.httpProxy+":"+a.httpProxyPort+"\n"),a.httpsProxy&&(f+="export https_proxy=http://"+a.httpsProxy+":"+a.httpsProxyPort+"\n"),a.allProxy&&(f+="export all_proxy=socks5://"+a.allProxy+":"+a.allProxyPort+"\n");var h="source /tmp/env.sh && wget -O - https://downloads.arduino.cc/tools/arduino-connector.sh | bash",i={commandline:h,signature:"",files:[{name:"env.sh",data:j.btoa(j.unescape(j.encodeURIComponent(f)))}],options:{verbose:!0}};return b(function(a,b){var c=function(c){return console.debug(c),c.err?b(c.err):c.done?a(c):void 0};g.upload(e,i,c)})})}function p(a){return b(function(b,c){i.subscribe(a,"/register",function(a){console.debug("received",a),b(a)},function(a){c(a)})})}a.steps={current:0,sub:0},a.backFromError="1.1",a.values={ipAddress:"",username:"",password:"",passwordConfirm:"",id:"",name:"",sshPort:22,selectedOS:"ubuntu"};var q=!1,r=!1;a.downloadingOS=!1,a.osInstallMessages="Output from OS Installation will be displayed here...\n",a.goToStep=function(b){var c=b.split(".");a.steps.current=parseInt(c[0],10),a.steps.sub=parseInt(c[1],10),"2.0"===b&&(a.backFromError=b)},a.openHelpFindIP=function(){e.show("helpFindIP",{})},a.progress={percent:10},g.connect(),a.uploadNetwork=function(c){if(!c&&g.disconnected())return f.set("gateway-flow",!0),f.set("gateway-ip",a.values.ipAddress),void a.goToGettingStarted();a.goToStep("2.1");var d;h.create().then(function(b){return d=b,a.values.id=b.id,a.progress.percent=40,n()}).then(function(){return a.progress.percent=80,a.goToStep("2.5"),b.all([p(d.id),o(a.values,d)])}).then(function(){q=!1,a.goToStep("3.0")}).catch(function(b){console.error(b),"canceled"===b?a.goToStep("0.0"):!b.indexOf||b.indexOf("[password none]")===-1&&b.indexOf("unable to authenticate")===-1?b.indexOf&&b.indexOf("no key found")!==-1?(r=!0,a.uploadNetwork()):a.goToStep("2.2"):(q=!0,a.uploadNetwork())})};var s,t=function(a){a.httpProxy&&(a.httpProxy=a.httpProxy.replace("http://","")),a.httpsProxy&&(a.httpsProxy=a.httpsProxy.replace("https://","")),a.allProxy&&(a.allProxy=a.allProxy.replace("socks5://",""))};a.openB=function(){a.stringReady=!1,h.create().then(function(b){a.values.id=b.id,a.progress.percent=40;var c=a.values;t(c),a.typeCommand="export id="+b.id+"\n\n",c.httpProxy&&(a.typeCommand+="export http_proxy=http://"+c.httpProxy+":"+c.httpProxyPort+"\n\n"),c.httpsProxy&&(a.typeCommand+="export https_proxy=http://"+c.httpsProxy+":"+c.httpsProxyPort+"\n\n"),c.allProxy&&(a.typeCommand+="export all_proxy=socks5://"+c.allProxy+":"+c.allProxyPort+"\n\n"),a.typeCommand+="wget -O install.sh https://downloads.arduino.cc/tools/arduino-connector.sh\n\n",a.typeCommand+="chmod +x install.sh\n\n",a.typeCommand+="./install.sh",s=p(b.id),a.stringReady=!0}).catch(function(b){console.debug(b),a.goToStep("2.2")})},a.uploadKeyboard=function(){a.goToStep("2.1"),s.then(function(){a.goToStep("3.0")})},a.updateThing=function(b,c){h.update(b,c).then(function(){a.goToStep("3.1")}).catch(function(b){console.debug(b),a.goToStep("2.2")})},f.get("plugin-installed")&&(f.remove("plugin-installed"),a.values.ipAddress=f.get("gateway-ip"),f.remove("gateway-ip"),a.values.ipAddress?a.uploadNetwork(!0):a.goToStep("2.0")),a.correctName=function(){a.values.name=a.values.name.replace(/[^a-zA-Z0-9_.@-]/g,"_")},a.downloadOS=function(){a.downloadingOS=!0,t(a.values);var b=[{name:"url",value:h.url},{name:"username",value:a.values.username},{name:"password",value:a.values.password},{name:"distro",value:a.values.selectedOS}];a.values.httpProxy&&b.push({name:"http_proxy",value:"http://"+a.values.httpsProxy+":"+a.values.httpsProxyPort}),a.values.httpsProxy&&b.push({name:"https_proxy",value:"http://"+a.values.httpsProxy+":"+a.values.httpsProxyPort}),a.values.allProxy&&b.push({name:"all_proxy",value:"socks5://"+a.values.allProxy+":"+a.values.allProxyPort}),c.token().then(function(a){return b.push({name:"token",value:a.token}),h.create()}).then(function(c){return a.values.id=c.id,b.push({name:"id",value:c.id}),h.image(c.id,b)}).then(function(a){saveAs(a,"arduino-connector.img")}).then(function(){a.downloadingOS=!1,a.goToStep("1.3")})},a.readProgress=function(){a.osTitleTranlastion=k("translate")("SETTING_UP_PLATFORM_OS",{name:k("capitalize")(a.values.selectedOS)}),i.subscribe(a.values.id,"/install",function(b){var c=b.split("] "),d=c[1],f="";a.osInstallMessages+="\n"+d;var g=c[0].split("[")[1];g>0?a.progress.percent=g:g<0&&(f+=d),"installation failed"===d.replace(/(\r\n|\n|\r)/gm,"").toLowerCase()&&e.show("generic",{title:k("translate")("SETUP_DONE_FAIL_TITLE"),text:f,callback:function(){a.osInstallMessages="",a.goToStep("2.2")}}),"please remove the usb key"===d.replace(/(\r\n|\n|\r)/gm,"").toLowerCase()&&e.show("generic",{title:k("translate")("ALMOST_DONE"),text:k("translate")("REMOVE_USB_KEY")}),a.progress.percent>=100&&(e.hide(),a.goToStep("2.5"))},function(b){a.osInstallMessages="",a.goToStep("2.2"),console.log(b)})},a.proxyConfig=function(b){a.proxyModalOpen=!0,e.show("proxyConfig",{values:a.values,callback:function(c){a.proxyModalOpen=!1,a.values=c,b&&a.openB(),e.hide()},undo:function(){a.proxyModalOpen=!1,e.hide()}})}}]),ideapp.controller("gettingStartedUP2Ctrl",["$scope","$q","AuthService","modal","localStorageService","daemon","devices","things","$window","$filter","Thing","$timeout","Os",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){return b(function(a,b){d.show("warning",{title:j("translate")("UP2_WARNING_RESET_TITLE"),body:j("translate")("UP2_WARNING_RESET"),type:"alert",cancel:!1,callback:function(){d.hide(),a()},undo:function(){d.hide(),b("canceled")}})})}function o(e){var g=a.values;return c.token().then(function(c){var h={board:"connector",port:a.values.port,network:!1},i="#!/bin/bash\n\n\n\n";i+="export id="+e.id+"\n\n",i+="export token="+c.token+"\n\n",s(g),g.httpProxy&&(i+="export http_proxy=http://"+g.httpProxy+":"+g.httpProxyPort+"\n\n"),g.httpsProxy&&(i+="export https_proxy=http://"+g.httpsProxy+":"+g.httpsProxyPort+"\n\n"),g.allProxy&&(i+="export all_proxy=socks5://"+g.allProxy+":"+g.allProxyPort+"\n\n");var k="{runtime.tools.linuxuploader.path}/adb devices",n="6598247fa98eed69dc6b21c19a13119b6f4b3a63c0294aad1dd7cb997cb9783c2bcafcfb9f60aece6e801d094c4f6171173848fe67861b35f386d72728df520e7045062420872820ef7fc732e6e43d9af847840eee65586060a637b19738eca91173a5f945a3785b5ebee3f3db29d212ae6e759b608d8e4e672a9c103029d8095e5fc8a3867238acf37a810976ce0b7d395ff19fc56d88dff1fac2b8dad0bfd67f978ddc955e2afdef106c49fbf680923fa28f57162401d2ae464dd50d59ac71b39b738653bb69ac6a43ea8c6c2e32c6999ff52dd541fd80689b075e74707787fce1f842e217b35663892d8530ae8f3083ee8eb58a38fd91ac2fdba6002e0ab4",o="{runtime.tools.linuxuploader.path}/adb push {build.path}/env.sh /tmp/",p="4f43100f787c6721fe6b9059b638bcc88f053117b0f3d7d9d8ef3f779ab7f266a9aaf2cf8d19be40c9d2f04c684751f2493ee7931f6a58865c0d755ee57388500136274cb679f0d6b3c35de235fa42b636271068d96cd2785f115fa751c51c020f0da1a3e4c0015a3fcacf7019860ea8661e9e391b1279e40981c398fd3cff9816d21aa22b1ca073da69ead2d174d32485dd7c7be063d6a31cb117c97811a6193c2252f253ca78cc0f4c690ef4fcd71b6fd1ff4015fd6cc278b0355015845e9c35813db2d8cc9d02266d50dc120a82fb6c435225391fbc869bae5e7e5a4d5150916a774406b5525b8dc25ced864e16ae1d187c3bb40b129650b30b9c5429dd2c",t="{runtime.tools.linuxuploader.path}/adb push {build.path}/arduino-connector.sh /tmp/",u="6a440c1b979d577b893a71f60c532c7bb6b8f3a7197bae5297dfcb3648ec83745262b07869f3bf30bdc382408f82c6e81f342c3c098da6b7df7896bd8e53a5e71f39f2e16abd716783295977318556cfca0bf53b4198884dbff6b53634a8604ac1a58baad2b902928a5f6e0354f11d156bd66b39a6658801578d210b2fd1e15f321f9f3b15a1df242de061cfbd7dc4bf2e43184963296e5aa43ec5ff839e97779da07c591e4d85e9277df14a04e6e38fc040894b185f3cc15763971fe558e879affd5b546a62716505c3c58452df49f5632c0bf8f0f133e7d27fe4db63dcd7bdebc9449bd010ebd53466559fdd4d9d2000d9737667909c76f6236f45fba94dbd",v="{runtime.tools.linuxuploader.path}/adb shell chmod +x /tmp/arduino-connector.sh",w="8929f54196d9c5abfdd1d60efca4dce48a4b2b376159b89aeac0cffb29de2c55e6edbdb3bf4cf4b50d5893ccfbce487306c44eaa7e3f9cb85dbb53c7c24fa18fc72ab8183c7add70369f6bfa5fe3b93c7f664ce58efd79296d2d81eb8643124df5d06351388ca00e8fac72d75b7d78e240c1de3c484f4efee474c58b45e7e3a70df788fc3fbce01e9cee8f61a681709773977183e7d6c5a0ba91fbadffbb523d4c92f4a9f740769f418070797b7e4431f60e62093ff1500863824cc4f54a72ae8d6014c9e1f47c3190309723d1ed90b5546797dabe2daa4ea7b4ff0cff13705f553bf3894c1a33158c0123c87b3781b234439f201791249864a7502d5559e352",x="{runtime.tools.linuxuploader.path}/adb shell /tmp/arduino-connector.sh",y="980997e659cddc492d201ba85ab01dfac5cef2c412e2a968ee72a52de8f720dac860bf7c7f66fd4696a8a269929433df6b50f2f0adfd14e4d7c372cfd3dd5c82a3542422e6abb1b63fea2ca3f0c2a3fab5258dfa0baec737ed49ec6e4b7c1f412f6fe5c4a5ff404038fccea22f45b591ddf51c018f4a44f7d02a1849f6c878775439f7712beb7c8984c9dc7d1537764a5c9ea655568f809cedc4eebd4edac87e07b8efbeaa2ef0d88f3233b477e2219b14d53a39389debf0cb946a25875cf908b6a9cd63367299326e672a000bcde897abd26290732b0d35907862e6024c185efa98304160cea64533ffb2fb42563432926c7c896668c47d2dd103a5327e108a";return f.perform("req_downloadtool",{tool:"linuxuploader",tool_version:"1.5.1",package:"arduino",replacementStrategy:"keep"},function(a){m.isWin()&&"Installing drivers"===a&&d.show("generic",{title:j("translate")("INSTALLING_DRIVERS"),text:j("translate")("WINDOWS_INSTALLING_DRIVERS_WARNING")+'<div class="windows-install-drivers-screen"><img src="assetz/images/getting_started/windows_installing_drivers.png" alt="windows asking to install drivers"></div>'})}).then(function(){var c=function(){return h.port=a.values.port,q(h,k,n,"env.sh",i).then(function(a){if(a.length<5)return b.reject("no device found")})};return c().catch(function(){return l(c,3e3)}).catch(function(){return l(c,3e3)}).catch(function(){return l(c,3e3)})}).then(function(){return q(h,o,p,"env.sh",i)}).then(function(){return q(h,t,u,"arduino-connector.sh",r())}).then(function(){return q(h,v,w,"arduino-connector.sh",r())}).then(function(){return q(h,x,y,"arduino-connector.sh",r())})})}function p(a){return b(function(b,c){h.subscribe(a,"/register",function(a){console.debug("received",a),b(a)},function(a){c(a)})})}function q(a,c,d,e,g){return b(function(b,h){var j={commandline:c,signature:d,files:[{name:e,data:i.btoa(i.unescape(i.encodeURIComponent(g)))}],options:{verbose:!0}},k=[],l=function(a){return k.push(a),console.debug(a),a.err?h(a.err):a.done?b(k):void 0};f.upload(a,j,l)})}function r(){return'#!/bin/bash -e \n  source /tmp/env.sh \n  has() {\n    type "$1" > /dev/null 2>&1\n    return $?\n  }\n  \n  download() {\n    if has "wget"; then\n      wget -nc $1\n    elif has "curl"; then\n      curl -SOL $1\n    else\n      echo "Error: you need curl or wget to proceed" >&2;\n      exit 20\n    fi\n  }\n  \n  # Replicate env variables in uppercase format\n  export ID=$id\n  export TOKEN=$token\n  export HTTP_PROXY=$http_proxy\n  export HTTPS_PROXY=$https_proxy\n  export ALL_PROXY=$all_proxy\n  \n  echo printenv\n  echo ---------\n  \n  cd $HOME\n  echo home folder\n  echo ---------\n  \n  echo remove old files\n  echo ---------\n  rm -f arduino-connector* certificate*\n  \n  echo uninstall previous installations of connector\n  echo ---------\n  if [ "$password" == "" ]\n  then\n    sudo systemctl stop ArduinoConnector || true\n  else\n    echo $password | sudo -kS systemctl stop ArduinoConnector || true\n  fi\n  \n  if [ "$password" == "" ]\n  then\n    sudo rm -f /etc/systemd/system/ArduinoConnector.service\n  else\n    echo $password | sudo -kS rm -f /etc/systemd/system/ArduinoConnector.service\n  fi\n  \n  echo download connector\n  echo ---------\n  download https://downloads.arduino.cc/tools/arduino-connector\n  chmod +x arduino-connector\n  \n  echo install connector\n  echo ---------\n  if [ "$password" == "" ]\n  then\n    sudo -E ./arduino-connector -register -install\n  else\n    echo $password | sudo -kS -E ./arduino-connector -register -install > arduino-connector.log 2>&1\n  fi\n  \n  if [ "$password" == "" ]\n  then\n    sudo chown $USER arduino-connector.cfg\n  else\n    echo $password | sudo -kS chown $USER arduino-connector.cfg\n  fi\n  \n  \n  echo start connector service\n  echo ---------\n  if [ "$password" == "" ]\n  then\n    sudo systemctl start ArduinoConnector\n  else\n    echo $password | sudo -kS systemctl start ArduinoConnector\n  fi'}a.steps={current:0,sub:0},a.values={ipAddress:"",username:"",password:"",passwordConfirm:"",id:"",name:"",sshPort:22,port:""},a.goToStep=function(b){var c=b.split(".");a.steps.current=parseInt(c[0],10),a.steps.sub=parseInt(c[1],10)},f.connect(),f.onPortsUpdate(function(b){for(var c=0;c<b.length;c++)"0x8087"===b[c].VendorID&&"0x101e"===b[c].ProductID.toLowerCase()&&(a.values.port=b[c].Name)}),a.upload=function(){a.goToStep("2.0");var c;g.create().then(function(b){c=b,a.values.id=b.id}).then(function(){return b.all([p(c.id),o(c)])}).then(function(){a.goToStep("3.0")}).catch(function(b){console.error(b),"insufficient permissions for device"===b?n().then(function(){a.goToStep("1.0")}):a.goToStep("2.2")})};var s=function(a){a.httpProxy&&(a.httpProxy=a.httpProxy.replace("http://","")),a.httpsProxy&&(a.httpsProxy=a.httpsProxy.replace("https://","")),a.allProxy&&(a.allProxy=a.allProxy.replace("socks5://",""))};a.checkPlugin=function(){return f.disconnected()?(e.set("gateway-up2",!0),void a.goToGettingStarted()):void a.goToStep("1.0")},a.updateThing=function(b,c){g.update(b,c).then(function(){e.set("up2-name",c),a.goToStep("3.1")}).catch(function(b){console.debug(b),a.goToStep("2.2")})},e.get("plugin-installed")&&(e.remove("plugin-installed"),a.goToStep("1.0")),a.correctName=function(){a.values.name=a.values.name.replace(/[^a-zA-Z0-9_.@-]/g,"_")},a.proxyConfig=function(b){a.proxyModalOpen=!0,d.show("proxyConfig",{values:a.values,callback:function(c){a.proxyModalOpen=!1,a.values=c,b&&a.openB(),d.hide()},undo:function(){a.proxyModalOpen=!1,d.hide()}})}}]),ideapp.controller("setupDoneCtrl",["$scope","httpsok","$window",function(a,b,c){a.certificateInstalled=b}]),ideapp.controller("devicesCtrl",["$scope","devices","Thing","modal","skin","$stateParams","PageTitle","$timeout",function(a,b,c,d,e,f,g,h){g.setTitle("Arduino Devices"),a.deviceQuery="",a.checkOnlineDevices=!1,e.set("light");var i=function(){a.devices.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0})};h(function(){a.checkOnlineDevices=!0},8e3);var j=function(b){var c=a.$watch(function(){return b.status},function(d){d&&d.sketches&&(a.openDeviceSketchesModal(b),c())})};b.list().then(function(d){a.devices=[];for(var e=0;e<d.length;e++){var g=new c(d[e].id,b.client);g.name=d[e].name,g.id=d[e].id,a.devices.push(g),f.deviceID===g.id&&j(g)}i()}),a.countOnlineDevices=function(){var b=_.find(a.devices,{online:!0});return b};var k;a.selectedCount=0,a.toggleDeviceSelection=function(b,c){if("checkbox"!==b.target.type)if(b.shiftKey===!1)c.selected=!c.selected,c.selected?a.selectedCount++:a.selectedCount--;else if(_.isUndefined(k))c.selected=!0,k=_.findIndex(a.devices,function(a){return a.id===c.id});else for(var d=_.findIndex(a.devices,function(a){return a.id===c.id}),e=k;e<=d;e++)a.devices[e].selected=!0,a.selectedCount++},a.countSketches=function(a){if(!a||!a.status||!a.status.sketches)return 0;for(var b=Object.keys(a.status.sketches),c=0,d=0;d<b.length;d++)"RUNNING"===a.status.sketches[b[d]].status&&c++;return c},a.deselectAll=function(){for(var b=0;b<a.devices.length;b++)a.devices[b].selected=!1;a.selectedCount=0};var l=function(c){b.delete(c).then(function(){_.remove(a.devices,{id:c}),a.selectedCount--},function(a){console.log(a)})};a.delete=function(){for(var b=0;b<a.devices.length;b++){var c=a.devices[b];c.selected&&l(c.id)}},a.containsString=function(b){return!(a.deviceQuery.length>1)||b.name.indexOf(a.deviceQuery)!==-1},a.openDeviceSketchesModal=function(a){if(a.status){var b=Object.keys(a.status.sketches);return 0===b.length?void d.show("deviceNoSketches",{device:a}):void d.show("deviceSketches",{device:a})}},a.noSkeches=function(a){var b=Object.keys(a.status.sketches);return!a.status||0===b.length},a.orderBy=function(b){switch(b){case"status":a.devices.sort(function(a,b){return!a.online&&b.online?1:a.online&&!b.online?-1:0});break;case"sketches":a.devices.sort(function(b,c){return a.countSketches(b)<a.countSketches(c)?1:a.countSketches(b)>a.countSketches(c)?-1:0});break;default:i()}}}]),ideapp.controller("homeCtrl",["$scope","$http","editor","views","settings","notifications","modal","toggler","$sce","$location","AuthService",function(a,b,c,d,e,f,g,h,i,j,k){a.toggler=h,a.showFeedBox=!1,a.expanded=d.isDashboard(),a.toggleHome=function(){a.expanded?a.closeHome():a.openHome()},a.rndNum=Math.floor(5*Math.random()+1);var l="https://cdn.arduino.cc/video/0"+a.rndNum;a.videoSourceOgv=i.trustAsResourceUrl(l+".ogv"),a.videoSourceMp4=i.trustAsResourceUrl(l+".mp4"),a.videoSourcesPoster=i.trustAsResourceUrl(l+".jpg"),a.newsFeed=[],b.jsonp(e.newsFeedUrl).then(function(b){b.data&&(b=b.data),a.showFeedBox=!0,a.newsFeed=b.posts}).catch(function(){a.showFeedBox=!1}),a.openHome=function(){a.expanded=!0,angular.element("#back").hasClass("ng-hide")&&angular.element("#back").removeClass("ng-hide");var b=angular.element("#back").height()-angular.element("#home").height();angular.element("#home").animate({top:"0"},{duration:600,easing:"easeInOutExpo",start:function(){angular.element("#back").removeClass("hidden").addClass("visible"),angular.element("#closeArea").removeClass("hidden").addClass("visible").attr("style","height:"+b+"px")}})},a.closeHome=function(){var b=600;angular.element("#back").attr("ng-hide")&&angular.element("#back").removeAttr("ng-hide");var c=angular.element("#home").height();angular.element("#home").animate({top:-c},{duration:b,easing:"easeInOutExpo",complete:function(){angular.element("#back").addClass("hidden"),angular.element("#closeArea").addClass("hidden")}}),a.expanded=!1,a.justConfigured=!1},a.closeHomeWithoutAnimation=function(){angular.element("#back").attr("ng-hide")&&angular.element("#back").removeAttr("ng-hide"),angular.element("#back").addClass("hidden"),angular.element("#closeArea").addClass("hidden"),a.expanded=!1},a.hideHomeTool=function(){return d.isDashboard()},a.getBackClass=function(){return d.isDashboard()?"backSolid":"backUnsolid"},a.getHamClass=function(){var b=a.expanded?"hamBack":"hamNoBack",c=d.hasTealBackground()&&"editor.public"!==d.getCurrentRoute()?" lateral-sidebars":"";return b+c},a.gotoPage=function(b){a.closeHome(),d.getCurrentRoute().indexOf(b)!==-1&&"editor.public"!==d.getCurrentRoute()||d.setRoute(b)},a.login=function(){k.login()},a.logout=function(){k.logout()},a.$on("$stateChangeSuccess",function(b,c){"home"===c.name||"logged.home"===c.name?a.openHome():a.closeHome()})}]),ideapp.controller("messagesCtrl",["$scope","messages",function(a,b){a.messages=b,a.remove=function(b){var c=a.messages.items,d=c.indexOf(b);c.splice(d,1)}}]),ideapp.controller("connLostCtrl",["$scope","messages","deviceInfo",function(a,b,c){a.messages=b,a.mobile=c.isMobile(),a.remove=function(b){var c=a.messages.items,d=c.indexOf(b);c.splice(d,1)}}]),ideapp.controller("modalCtrl",["$scope","modal",function(a,b){a.alert=b.alert,a.onKeyPress=function(a){return 27===a.keyCode&&b.close(),a.stopPropagation(),!1},a.closeModal=function(){a.alert.params.callback_close(),b.close()}}]),ideapp.controller("modalHelpCtrl",["$scope","modal","Os",function(a,b,c){a.params=b.alert.params,a.isMac=c.isMac(),a.isWin=!c.isMac(),a.submit=function(){b.hide()}}]),ideapp.controller("modalInfoCtrl",["$scope","modal","$filter",function(a,b,c){a.params=b.alert.params,a.size=function(a){for(var b=0,c=0;c<a.files.length;c++)b+=a.files[c].size?a.files[c].size:0;return b/1024},a.isExample="example"===a.params.item.type,a.submit=function(){b.hide()},a.getTitle=function(){var b=a.params.item.type;return"sketch"!==b&&"folder"!==b&&(b="file"),c("translate")(b.toUpperCase()+"_INFO")}}]),ideapp.controller("modalRenameCtrl",["$scope","$rootScope","$timeout","$filter","modal",function(a,b,c,d,e){a.params=e.alert.params;var f=[],g=[],h=a.params.parent.files;a.saveAs=a.params.saveAs,h&&h.forEach(function(a){"folder"===a.type?f.push(a.name):g.push(a.name)}),c(function(){b.$emit("triggerFocus")},100),a.submit=function(){a.params.callback(a.params)},a.correctName=function(){a.params.name&&("sketch"===a.params.item.type?a.params.name=a.params.name.replace(/\W/g,"_"):"folder"===a.params.item.type?a.params.name=a.params.name.replace(/[^\w\s]/g,"_"):a.params.name=a.params.name.replace(/[^\w.]/g,"_"))},a.checkType=function(b){if(!b)return!1;var c;a.params.message=null,c="folder"===a.params.item.type?f:g;var e=b,h=c.indexOf(e);if(h>=0&&c[h]===e)return a.params.message=d("translate")("WARNING_DUPLICATED_NAME"),!1;if("sketch"===a.params.item.type){var i=b.indexOf(" ")===-1;return a.params.message=i?null:d("translate")("WARNING_NO_SPACE_ALLOWED"),i}return!0}}]),ideapp.controller("modalTargetCtrl",["$scope","boards","modal","_","builderAPI","$filter",function(a,b,c,d,e,f){a.boards=c.alert.params.hardwarePorts||[],a.chromeOsOnlyCompileBoards=c.alert.params.chromeOsOnlyCompile||[],a.usingChromeApp=a.chromeOsOnlyCompileBoards.length>0,a.showPorts=!0,a.boardQuery="";var g=!1;if(c.alert.params&&c.alert.params.port_selected){g=!0;var h=d.findWhere(b.connected,function(a){return a.val.com_name===c.alert.params.port_selected});h&&(a.currentSelectedPort=h.val)}a.ports=b.connected.sort(function(a,b){return a.val.com_name<b.val.com_name?-1:a.val.com_name>b.val.com_name?1:0});var i=function(a){return!(a.private&&a.private===!0)&&"cloud"!==a.val.type};a.ports=f("filter")(a.ports,i),a.selectBoardError=!1,a.selectThisBoard=function(b){a.currentSelectedBoard=a.currentSelectedBoard===b?null:b,b.build.length>1&&(a.flavour=b.default_flavour),a.currentSelectedBoard&&(a.selectBoardError=!1),d.findWhere(a.chromeOsOnlyCompileBoards,b)?a.showPorts=!1:a.showPorts=!0},a.selectThisPort=function(b){a.currentSelectedPort?a.currentSelectedPort=a.currentSelectedPort.com_name===b.com_name?null:b:a.currentSelectedPort=b,a.currentSelectedBoard||(a.selectBoardError=!0),a.currentSelectedPort||(a.selectBoardError=!1)},a.selectFlavour=function(b){a.flavour=b},a.getActiveBoardClass=function(b){return b===a.currentSelectedBoard?"selected":""},a.getActivePortClass=function(b){return b===a.currentSelectedPort?"selected":""},a.closeModal=function(){a.alert.visibility=!1,a.alert.view=null,a.currentSelectedBoard=null,a.currentSelectedPort=null},a.getInvalidStatus=function(){return!a.currentSelectedBoard},a.confirmSettings=function(){var d={val:a.currentSelectedBoard};d.val.com_name=a.currentSelectedPort?a.currentSelectedPort.com_name:null;var f={fqbn:a.currentSelectedBoard.fqbn.split(":cpu")[0]};e.do("boards_v2#show",{params:f}).then(function(e){d.val.arch=e.data.architecture,d.val.upload=e.data.upload;for(var f=0;f<d.val.upload.length;f++)d.val.upload[f].package=e.data.package;if(c.alert.params.vid||c.alert.params.pid||!d.val.com_name?(d.val.vid=c.alert.params.vid,d.val.pid=c.alert.params.pid):b.replaceBoard(d.val.com_name,d.val),d.val.build.length>1)for(var h in d.val.build)d.val.build[h].flavour===a.flavour&&(d.val.fqbn=d.val.build[h].fqbn);d.val.flavour=a.flavour||"default",d.val.unknown=g,b.select(d.val,!1),a.closeModal()})},a.buildFlavourLabel=function(a){var b=a.indexOf("MHz");return a=a.replace("atmega","ATmega"),b!==-1&&(a=a.slice(0,b+3)+" "+a.slice(b+3,a.length)),a},a.boardsComparator=function(a){if(a.name.startsWith("Arduino/Genuino")){var b="A"+a.name;return b}return a.name},a.containsString=function(b){return!(a.boardQuery.length>1)||b.name.toLowerCase().indexOf(a.boardQuery.toLowerCase())!==-1}}]),ideapp.controller("tryReconnectCtrl",["$scope","$filter","modal","deviceInfo",function(a,b,c,d){a.htmlTexts={text1:b("translate")("TRY_RECONNECT_MODAL_INTRODUCTION"),text2:b("translate")("TRY_RECONNECT_MODAL_LAST")};var e=d.browser.getBrowser();"firefox"===e&&(a.htmlTexts.text1=b("translate")("TRY_RECONNECT_MODAL_INTRODUCTION_FIREFOX"))}]),ideapp.controller("modalUsedSpaceCtrl",["$scope","modal","CreateUserService","$filter",function(a,b,c,d){a.params=b.alert.params;var e=c.userStats();a.spaceUsedPerc=e.spaceUsedPercMin,a.libSpaceUsedPerc=e.libSpaceUsedPerc,a.sketchesSpaceUsedPerc=e.sketchesSpaceUsedPerc,a.limitMB=e.limitMB,a.spaceUsedMB=e.spaceUsedMB,a.totalSketchesNumber=e.limitSketches,a.sketchesNumber=e.sketches,a.libsNumber=e.libraries,a.submit=function(){b.hide()}}]),ideapp.controller("modalWaitCtrl",["$scope","modal","$timeout","$rootScope",function(a,b,c,d){function e(){var b=a.values.progress;b<60?b=b+15+5*Math.random():b+=b<85?5*Math.random():2*Math.random(),a.values.progress=Math.min(100,Math.floor(b)),f=c(e,500+3e3*Math.random())}b.alert.close_delay=1e3,a.params=b.alert.params,a.values={},a.values.progress=0;var f;e(),d.$on("modalClosing",function(){a.values.progress=100,c.cancel(f)})}]),ideapp.controller("modalWarningCtrl",["$scope","$timeout","localStorageService","modal",function(a,b,c,d){if(a.params=d.alert.params,a.params.button||(a.params.button="OK"),a.params.skip){var e=c.get(a.params.skip);e="true"===e,a.params.doSkip=e}a.submit=function(){c.set(a.params.skip,a.params.doSkip),a.params.callback(a.params)},a.getTypeClass=function(){return a.params.type||""}}]),ideapp.controller("modalWhereCtrl",["$scope","$filter","modal","editor",function(a,b,c,d){a.params=c.alert.params,a.tree=a.params.tree,a.tree.shown=!0,a.tree.type="folder";var e=a.params.parent;a.selectThisTarget=function(b){a.params.target=a.params.target===b?null:b},a.toggleThisTarget=function(b){a.ifRoot(b)===!1&&(b.shown=!b.shown)},a.getTargetClass=function(b){var c=b===a.params.target?"selected":"";return c},a.getTargetStatus=function(a){return e.length?_.findWhere(e,{files:a.files}):e.files===a.files},a.filterByType=function(b){var c="folder"===b.type&&"libraries"!==b.name&&a.params.item!==b;return c},a.getInvalidStatus=function(){return!a.params.target},a.getItemName=function(c){return a.ifRoot(c)?b("translate")("SKETCHBOOK"):c.name},a.ifRoot=function(a){return a?"__root"===a.name:null},a.toggleChildren=function(a){return a.open},a.submit=function(){a.params.callback(a.params)},a.getLiClass=function(b){if(b){var c="folder";return c=b.shown?c+" parent_li":c,c=b===a.params.target?c+" selected":c}return""}}]),ideapp.controller("modalBoardPassword",["$scope","modal","$translate",function(a,b,c){a.params=b.alert.params,a.error=!1,a.password,a.submit=function(b){a.params.callback(a.password)},a.closeModal=function(){a.params.undo()}}]),ideapp.controller("modalDevicePassword",["$scope","modal","Os",function(a,b,c){a.params=b.alert.params,a.passError=b.alert.params.passError,a.sshError=b.alert.params.sshError,a.basicActive=!0,a.data=a.params.values,a.sshPathPlaceholder="~/.ssh/id_rsa";var d=c.getName();"Windows"===d&&(a.sshPathPlaceholder="HOME\\.ssh\\id_rsa");var e=function(a){return a=a.replace(" ","")};a.cleanUpHttpProxyField=function(){a.data.httpProxy=e(a.data.httpProxy)},a.cleanUpHttpsProxyField=function(){a.data.httpsProxy=e(a.data.httpsProxy)},a.cleanUpSocks5ProxyField=function(){a.data.allProxy=e(a.data.allProxy)},a.checkUsername=function(){a.sshError=!1,a.data.username&&""!==a.data.username||(a.errorSSH=!0)},a.resetSSHerror=function(){a.data.username&&(a.errorSSH=!1)},a.submit=function(){a.params.callback(a.data)},a.closeModal=function(){a.params.undo()},a.toggleTab=function(){a.basicActive=!a.basicActive,a.advancedActive=!a.advancedActive}}]),ideapp.controller("modalDeviceSketches",["$scope","modal",function(a,b){a.deviceName=b.alert.params.device.name,a.sketches=b.alert.params.device.status.sketches,a.uid=b.alert.params.device.id.split(":")[0],a.toggleStatus=function(a){var c;"STOPPED"===a.status?c="STOP":"RUNNING"===a.status&&(c="START"),b.alert.params.device.action(a.id,c).catch(function(a){console.error(a)})},a.submit=function(){b.hide()}}]),ideapp.controller("modalDeviceNoSketches",["$scope","modal","$window","$state",function(a,b,c,d){a.deviceName=b.alert.params.device.name,a.submit=function(){c.location=d.href("editor",{})},a.closeModal=function(){b.hide()}}]),ideapp.controller("modalImportResultCtrl",["$scope","$filter","modal",function(a,b,c){a.params=c.alert.params;for(var d in a.params.body.errors){var e=a.params.body.errors[d];e.statusText&&"Conflict"===e.statusText&&(e.human=b("translate")("M_SKETCH_IMPORT_ERROR_CONFLICT")),e.statusText&&"Precondition Failed"===e.statusText&&(e.human=e.data.detail=b("translate")("M_SKETCH_IMPORT_TOO_LARGE"))}a.submit=function(){c.hide(),a.params.callback(a.params)}}]),ideapp.controller("modalShareCtrl",["$scope","modal","$location","messages","Os","$window","$state",function(a,b,c,d,e,f,g){a.params=b.alert.params;var h=a.params.item;if("example"===h.type)if(_.contains(h.types,"custom"))a.sketchUrl=g.href("example.custom",{libraryID:h.libraryID,exampleName:h.name},{absolute:!0});else{var i=h.path,j=i.replace(/\//g,"\\");if(_.contains(h.types,"library")){var k=i.split("/")[0].replace(/[\s.]/g,"-").toLowerCase();a.sketchUrl=g.href("example.library",{libraryName:k,examplePath:j,exampleName:h.name},{absolute:!0})}else _.contains(h.types,"builtin")&&(a.sketchUrl=g.href("example.builtin",{examplePath:j,exampleName:h.name},{absolute:!0}))}else{var l=c.absUrl();g.params.id!==h.id&&(l=l.replace(g.params.id,h.id)),a.sketchUrl=l+"/preview"}a.iOS=!1,e.isiOS()&&(a.iOS=!0),a.copyLink=function(){d.add("COPIED_PREVIEW_LINK",{},d.SUCCESS)},a.copyLinkError=function(){d.add("COPIED_PREVIEW_LINK_SAFARI",{},d.SUCCESS)},a.openPreview=function(){f.open(a.sketchUrl,"_blank")},a.submit=function(){b.hide()}}]),ideapp.controller("modalAddToMySketchbookCtrl",["$scope","$filter","modal","AuthService","views",function(a,b,c,d,e){a.params=c.alert.params,a.submit=function(){c.hide(),d.login()},a.goToEditor=function(){c.hide(),e.setRoute("editor")}}]),ideapp.controller("modalLibraryNameCtrl",["$scope","modal",function(a,b){a.params=b.alert.params,a.submit=function(){a.params.callback(),b.hide()}}]),ideapp.controller("modalLibraryManagerCtrl",["$scope","modal","libraries","$filter","messages","$timeout","boards",function(a,b,c,d,e,f,g){a.params=b.alert.params,a.treeFilter=angular.copy(a.params.search),a.libraries=[],a.tooltips={starTooltip:{main:"tooltip.favorite_lib"},unstarTooltip:{main:"tooltip.unfavorite_lib"}},a.showAddedMessage=!1,a.showRemovedMessage=!1;var h={label:d("translate")("LIBRARY_CATEGORY_ALL"),value:"All"},i=[],j=[],k={name:"FILTER_LIBRARIES_FOR_OPTION_2"},l=[k],m=[h,{label:d("translate")("LIBRARY_CATEGORY_COMMUNICATION"),value:"Communication"},{label:d("translate")("LIBRARY_CATEGORY_DATA_PROCESSING"),value:"Data Processing"},{label:d("translate")("LIBRARY_CATEGORY_DATA_STORAGE"),value:"Data Storage"},{label:d("translate")("LIBRARY_CATEGORY_DEVICE_CONTROL"),value:"Device Control"},{label:d("translate")("LIBRARY_CATEGORY_DISPLAY"),value:"Display"},{label:d("translate")("LIBRARY_CATEGORY_OTHER"),value:"Other"},{label:d("translate")("LIBRARY_CATEGORY_SENSORS"),value:"Sensors"},{label:d("translate")("LIBRARY_CATEGORY_IO"),value:"Signal Input/Output"},{label:d("translate")("LIBRARY_CATEGORY_TIMING"),
value:"Timing"},{label:d("translate")("LIBRARY_CATEGORY_UNCATEGORIZED"),value:"Uncategorized"}];c.libraryManager.list.length?f(function(){a.libraries=c.libraryManager.list},50):c.fetchContributedList().then(function(){a.libraries=c.libraryManager.list}),a.submit=function(){b.hide()},a.countFound=function(){return _.where(a.libraries,a.byTextSearch).length},a.countFiltered=function(){var b=_.where(a.libraries,a.byCategory);return b=_.where(b,a.byArch),_.where(b,a.byTextSearch).length},a.categorySelect={label:d("characters")(h.label,13),items:_(m).map(function(a){return{label:a.label,selected:function(){return h===a},action:function(){return h=a,!0}}}).value()},g.archBoardList.sort(function(a,b){var c=g.getBoardLabelForArchFilter(a).toLowerCase(),d=g.getBoardLabelForArchFilter(b).toLowerCase();return c<d?-1:c>d?1:0}),a.hardwareSelect={label:g.getBoardLabelForArchFilter(k),items:_(l.concat(g.archBoardList)).map(function(a){return{label:g.getBoardLabelForArchFilter(a),selected:function(){return k.name===a.name},action:function(){var b="";if(a.fqbn){var c=a.fqbn.split(/[:_]+/);c&&c.length>=2&&(b=c[1])}return k={name:a.name,arch:b},!0}}}).value()},a.byTextSearch=function(b){var c=a.treeFilter,e=!0;if(c&&c.length){var f=b.name.toLowerCase(),g=d("removeATags")(d("filterLinks")(b.sentence.toLowerCase()));angular.forEach(c,function(a){if(a.name){var b=a.name.toLowerCase();f.indexOf(b)===-1&&g.indexOf(b)===-1&&(e=!1)}})}return e},a.byArch=function(a){return"FILTER_LIBRARIES_FOR_OPTION_2"===k.name||(a.architectures.indexOf("*")!==-1||a.architectures.indexOf(k.arch)!==-1)},a.byCategory=function(a){return"All"===h.value||a.category===h.value},a.addLibrary=function(b){i.push(b.id),a.params.addCallback(),c.addContributed(b).then(function(){e.add("M_LIBRARY_ADDED",{name:b.name},e.SUCCESS),a.showRemovedMessage=!1,a.showAddedMessage=!0,f(function(){a.showAddedMessage=!1},1e4),i.splice(i.indexOf(b.id),1)},function(a){e.add("M_LIBRARY_ADD_ERROR",{name:b.name},e.ERROR),i.splice(i.indexOf(b.id),1)})},a.removeLibrary=function(b){a.showAddedMessage=!1,a.showRemovedMessage=!0,j.push(b.id),a.params.removeCallback(b).then(function(){f(function(){a.showRemovedMessage=!1},1e4),j.splice(j.indexOf(b.id),1)},function(a){e.add("M_LIBRARY_REMOVE_ERROR",{},e.ERROR),j.splice(j.indexOf(b.id),1)})},a.installed=function(a){var b=_.findWhere(c.data.contributed,{id:a.id});return!(!b&&i.indexOf(a.id)===-1)||!(!b||j.indexOf(a.id)!==-1)&&void 0}}]),ideapp.controller("modalSupportedBoardsCtrl",["$scope","modal","$filter","boards","storeLink",function(a,b,c,d,e){var f=b.alert.params.library;a.boardsList=angular.copy(d.archBoardList);var g=c("translate")("ARCHITECTURE",{arch_name:c("libArchFilter")(f.architectures)});a.translateVars={lib_name:f.name,arch_name:g},a.boardsList.forEach(function(a){f.architectures.indexOf("*")===-1&&f.architectures.indexOf(a.architecture)===-1&&(a.hidden=!0),a.simpleName=d.getBoardLabelForArchFilter(a)}),_.remove(a.boardsList,{hidden:!0}),a.getLink=function(a){return e.get(a.fqbn)},a.submit=function(){b.hide()}}]),ideapp.controller("modalGenericCtrl",["$scope","modal",function(a,b){a.params=b.alert.params,a.close=function(){"function"==typeof a.params.callback&&a.params.callback(),b.hide()}}]),ideapp.controller("modalProxyConfig",["$scope","modal",function(a,b){a.params=b.alert.params,a.data=a.params.values;var c=function(a){return a=a.replace(" ","")};a.cleanUpHttpProxyField=function(){a.data.httpProxy=c(a.data.httpProxy)},a.cleanUpHttpsProxyField=function(){a.data.httpsProxy=c(a.data.httpsProxy)},a.cleanUpSocks5ProxyField=function(){a.data.allProxy=c(a.data.allProxy)},a.submit=function(){a.params.callback(a.data)},a.closeModal=function(){a.params.undo()}}]),ideapp.controller("modalFreeTrialExpiredCtrl",["$scope","$window","modal","config",function(a,b,c,d){a.params=c.alert.params,a.purchase=function(){var a="https://chrome.google.com/webstore/detail/"+d.chromeExtensionIds[0];b.location.href=a},a.close=function(){c.hide()}}]),ideapp.controller("nobrowserCtrl",["$scope","deviceInfo",function(a,b){a.browser={browser:b.browser.getBrowser()}}]),function(){"use strict";var a=angular.module("ideapp");a.controller("notificationsCtrl",["$scope","modal","$filter","editor","localStorageService","boards",function(a,b,c,d,e,f){a.forumnotif=c("translate")("FORUM_NOTIFICATION"),e.remove("notificationread"),a.getFullBellClass=function(){var a=e.get("notificationread-updated");return!a},a.setAsRead=function(){e.set("notificationread-updated",!0)},a.openShareModal=function(){b.show("share",{title:c("translate")("SHARE_SKETCH_TITLE"),item:d.currentProject})},a.showBoards=function(){b.show("target",{hardwarePorts:f.hardwarePorts})}}]),a.directive("openLibManager",["toggler",function(a){return{link:function(b,c){c.on("click",function(){a.open("librariesSidebar"),angular.element("#library-manager").click()})}}}])}(),ideapp.controller("publicSketchCtrl",["$rootScope","$scope","editor","sketches","boards","modal","$filter","user","$state","$location","$window","boardMetadata","storeLink","skin","sanity",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.fullHeightScroll=!0,n.set("light");var p=c.currentProject,q=l.get();if(b.currentProject=p,b.previewPage=!0,p.tutorials&&p.tutorials.length&&(b.tutorial=p.tutorials[0]),c.currentProject.currentFile.readonly=!0,_.each(c.currentProject.files,function(a){a.readonly=!0}),b.tooltips={import:{main:"EXPORT_SKETCH"}},b.sketchURL=j.absUrl().replace("?embed",""),b.goToEditor=function(){k.open(b.sketchURL,"_blank")},b.selectFile=function(a){c.setCurrentFile(a,p)},b.exportSketch=function(){d.exportMultiple([p],p.name).then(function(){}).catch(function(){f.show("warning",{title:"",body:g("translate")("M_EXPORT_ERROR",{export_file_name:p.name}),type:"alert",cancel:!1,callback:function(){f.hide()}})})},b.cloneSketch=function(){if(h&&"0001-01-01T00:00:00Z"!==h.activated&&!h.Error){b.adding=!0;var a=angular.copy(p);a.owner=h.uid,d.fetch(h.uid).then(function(){d.copy(a,d.tree).then(function(){b.adding=!1}).catch(function(c){c.status&&412===c.status?f.show("usedSpace",{}):c.status&&409===c.status?f.show("warning",{title:g("translate")("ERROR_WHILE_IMPORT_SKETCH"),body:g("translate")("M_SKETCH_IMPORT_ERROR_CONFLICT"),type:"alert",cancel:!1,callback:function(){f.hide()}}):f.show("warning",{title:"",body:g("translate")("M_SKETCH_ERROR",{sketch_name:a.name}),type:"alert",cancel:!1,callback:function(){f.hide()}}),b.adding=!1})})}else{var c=!1;h&&("0001-01-01T00:00:00Z"===h.activated||h.Error)&&(c=!0),f.show("addToMySketchbook",{noAccess:c})}},b.openInEditor=function(){if(h)return i.go("editor.user.sketch.file",{uid:h.uid,id:p.id})},b.generateSecrets=function(){var a=_.findWhere(c.currentProject.files,{name:"arduino_secrets.h"});if(!_.findWhere(c.currentProject.files,{type:"secret"})&&(q&&q.secrets&&0!==q.secrets.length||a)){var b=o.defaultSecret();b.unsaved=!1,p.files.push(b),a&&(l.writeSecrets(),c.currentProject.files=_.reject(c.currentProject.files,{name:"arduino_secrets.h"}),c.currentProject.ino.content=c.currentProject.ino.content.replace(/#include\s+"arduino_secrets.h"\s*\n*/,""))}},d.load(b.currentProject).then(function(){for(var a=0,c=0;c<p.files.length;c++)a+=p.files[c].size?p.files[c].size:0;b.size=a/1024}),q){var r;q.cpu&&q.cpu.name&&(r=e.getBoardName(q.cpu)),r&&(b.board=r.name,b.boardLink=m.get(q.cpu.fqbn))}h&&p.owner===h.uid&&(b.isMine=!0),b.$on("$destroy",function(){f.hide()})}]),function(){"use strict";var a=angular.module("ideapp");a.controller("redeemCtrl",["$scope","$filter","LoginError","createAPI","modal","views","user","config","localStorageService","daemon",function(a,b,c,d,e,f,g,h,i,j){a.termsText=b("translate")("TERMS");var k=!1;j.findService("https",8989,100).then(function(){k=!0}),a.decline=function(){e.show("warning",{title:b("translate")("WARNING_MODAL_TITLE"),body:b("translate")("WARNING_MODAL_TEXT"),type:"alert",cancel:!1,callback:function(){e.hide()}})},a.agree=function(){d.do("users#edit",{params:{id:g.username}},{email:g.email,activate_now:!0}).then(function(a){if("OK"===a.statusText){var b=i.get("gateway-up2");if(b)return i.remove("gateway-up2"),void f.setRoute(f.GETTING_STARTED_UP2);if(k)return void f.setRoute(f.EDITOR);h.intelInstance?f.setRoute(f.GETTING_STARTED):f.setRoute(f.GETTING_STARTED_PLUGIN)}else c.setMessage(a.statusText)},function(a){c.setMessage(a.data)})}}])}(),function(){"use strict";var a=angular.module("ideapp");a.controller("waiterCtrl",["$scope","notifications",function(a,b){}])}(),ideapp.controller("chromeappWlCtrl",["$scope","config","$window",function(a,b,c){var d="https://chrome.google.com/webstore/detail/"+b.chromeExtensionIds[0];a.goToChromeApp=function(){c.location=d}}]);